
## 描述
Route Aggregation：將多個路由根據共同所擁有的序號來合併一個新路由，並連同更新在相關的路由器

好處是：
1. 有效地減少路由更新的頻率  
2. 減少不必要的網路流量  
3. 減少路由表所佔據的記憶體使用量

### 簡單例子
假設每名郵差都能轉交給負責區域的郵差，而一開始第一個郵差會接收到五封信，地址分別為：
- 臺北市中正區重慶南路21號
- 臺北市中正區湖口街34號
- 臺北市中山區植福路18號
- 臺北市內湖區麗山街30號
- 臺北市內湖區碧山路11號

這時你可以按照地區來將郵件分發給負責該地區的郵差來負責發送，如最前面兩封信交由中正區的郵差、第三封信交由中山區的郵差、第四、五封信交由內湖區的郵差。每個地區的郵差收到信就會按照所負責的區域來快速找到對應地址來發送信件

在這裡會以IP比喻為地址，而路由器比喻為郵差，身為路由器的郵差則是根據路由表來查詢IP要到哪裡找到它們，在這裡可以指定哪些地址可委託哪些負責該地區的郵差來處理或者哪些地址正是自己要處理的
```
地址1 郵差1
地址2 自己
地址3 郵差2
```
這裡的 Aggregation則是將這些信件的地址合併成新地址以及按照新地址的地區來找到哪個負責該地區的郵差
```
新地址	郵差N
```


### 正式案例1
在這裡會由路由器X的路由表來負責管理和維護以下兩個網域，每當這兩個網域出現變動時，都會更動到路由器X的路由表
```
172.16.32.0/24
172.16.128.0/24
```

而若沒有採用Route Aggregation的話，勢必也要透過更新路由器Y的路由表來告知以下網域該如何找，其路由表會是如下，這樣子每當路由器Y接收到要發送至以下兩個網域的封包時，
```
172.16.32.x
172.16.128.x
```
都可以透過路由表將封包轉送給路由器X
```
// 路由器Y的路由表
172.16.32.0/24	路由器X
172.16.128.0/24 路由器X
```

![](https://www.netadmin.com.tw/upload/news/NP151109000215110910565404.png)

但每當路由器X要管理的網域出現變更，如新增網域或者移除網域的話，勢必也要更動著路由器Y的路由表。為此，網域一改，相關的所有路由器都要一同更改


可若是採用Route Aggregation的話，首先其技術會先試著看以下兩個網域的共同序號是什麼，在這裡我們以|來區隔出該IP的所在網域。
```
// 172.16.32.0/24
172.16.0001 0000|0000 0000
// 172.16.128.0/24
172.16.1000 0000|0000 0000
```

最後結果為結果為如下
```
172.16
```

而為了包含以下網域的IP，
```
172.16.32.0/24	
172.16.128.0/24 
```

所以會將結果延伸成能夠包含其網域的IP之CIDR格式：
```
172.16.0.0/16
```
 
 將這樣結果更新至路由器Y的路由表的話，
 ```
 172.16.0.0/16 路由器X
 ```
只要每一次收到的封包要送至以上網域的話，都能夠因為相符於上者而轉送至路由器X，再由路由器X轉送至正確的網域

```
172.16.32.x
172.16.128.x
```

這樣子的結果，無論路由器X的網域變更還能夠維持在172.16.0.0/16網域下，不管是新增新網域還是移除網域，都不必連同更新路由器Y。

### 正式案例2
在這裡會是路由器F負責維護和管理172.16.128.0/20，而路由器E則是維護和管理
```
172.16.32.64/26
172.16.32.128/26
```
最後的路由器H則是172.16.64.0/20
![](https://www.netadmin.com.tw/upload/news/NP151109000215110910572104.png)

而路由器G就負責維護管理自己與路由器F、路由器E、路由器H之間的路由表，最後在連同更新路由器的路由表。

在這裡若要採用Route Aggregation的話，首先會先以路由器E所負責的網域找到共同點
```
172.16.32.64/26
172.16.32.128/26
```
其結果為172.16.32
```
172.16.32.01|00 0000
172.16.32.10|00 0000
```
在這裡為了能夠滿足CIDR格式，而整理成
```
172.16.32.0/24
```

現在目前結果是路由器G的路由表會是
```
172.16.128.0/20 路由器F
172.16.32.0/24 路由器E
172.16.64.0/20 路由器H
```
但這樣路由表還得連同更新至路由器Z，讓他能通過G來找到對應的路由器，這時為了簡化路由器G所要給予路由器Z的路由更新，會對這三個網域找到的共同點
```
172.16.1000| 0000.0000 0000
172.16.0010| 0000.0000 0000
172.16.0100| 0000.0000 0000
```
其結果會是172.16，接著再轉換成
```
172.16.0.0/16
```

並且將這結果更新至路由器Z的路由表，這樣只要是原本就隸屬於上述三個網域的IP皆能透過路由器G轉接給另一個路由器進行封包分發
```
172.16.0.0/16 路由器G
```
## 複習

#🧠 CIDR 的 Route Aggregation 是什麼? 好處是什麼 ->->-> `將多個路由根據共同所擁有的序號來合併一個新路由，並連同更新在相關的路由器`
<!--SR:!2022-08-30,63,250-->

#🧠 CIDR 的 Route Aggregation 好處是什麼->->-> `減少不必要路由表更新、簡化路由表、減少路由表所佔據的記憶體使用量、減少不必要的網路流量`
<!--SR:!2022-08-26,60,250-->


#🧠 試著用CIDR 的Route Aggregation來簡化路由器Y的路由表設計 ![](https://www.netadmin.com.tw/upload/news/NP151109000215110910565404.png) ->->-> `先從路由器X所管理的網域找到共同序號，結果會是172.16，而這裡為了能夠更方便讓路由器好辨識，而轉成172.16.0.0/16，並更新至路由器Y的路由表，而路由器X的路由表就繼續維護那兩個網域`
<!--SR:!2022-08-17,55,250-->


#🧠 試著用CIDR 的Route Aggregation來簡化路由器Z的路由表設計![](https://www.netadmin.com.tw/upload/news/NP151109000215110910572104.png) ->->-> `先從路由器E所管理的網域找到共同序號，結果會是172.16.32/24，所以路由器G的路由表對於路由器E會是172.16.32/24，接著為了簡化路由器Z的路由表設計，在這裡其路由器Z涉及到所有網域，所以會以剛剛的聚合結果以及其餘網域找到共同點，最後會是172.16.0.0/16，並更新至路由器Z，讓它能夠去對應到路由器G`
<!--SR:!2022-12-05,120,250-->


---
Status: #🌱 
Tags:
[[Network]]
Links:
References:
[[@hukaizhiWuLeiBieQuGeLuYouCIDRJiShuYiXuQiuShanYongYouXianIPWeiZhiWangGuanRen]]
