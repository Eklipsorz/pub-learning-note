## 描述

引用[[@manbucoding2022NianRedisZuiXinMianShiTiDi8PianRedisHuanCunWenTiWx624642a80743cDeJiShuBoKe]]所描述的Cache Avalanche：
> 缓存雪崩是指大量的缓存key无法在Redis缓存中进行处理，紧接着，短时间大量请求直接打到数据库层，导致数据库层的压力激增, 可能瞬间就会导致数据库宕机

重點：
- Cache Avalanche 是指由緩存帶來的大量請求，而這些請求會因為大量緩存中的key失效而導致請求導向至處於硬碟的資料庫系統
- 大量請求同時向資料庫發送，會使資料庫負載激增，甚至會使該資料庫當機。


### Cache Avalanche 命名緣由
Cache 在這裡會是緩存，Avalanche 本身會是指雪崩，但在這裡雪崩是指大量請求，合併起來就是由緩存帶來的雪崩或者由緩存帶來的大量請求

### Cache Avalanche 起因
> 第一个原因是：缓存中有大量数据同时过期，比如说一些APP首页缓存数据，都设置了当天有效， 凌晨过期， 在第二天流量高峰时, 大量用户访问的请求， 没有换成从数据库中读取数据。如果应用的并发请求量很大，那么数据库的压力也突然变得很大，可能会造成缓存雪崩。
> 另外一个原因是Redis宕机, 

重點：
- 大致分為緩存本身是否正常用：
	- 緩存本身不能用的話，也就是即為當機，那麼就會因為策略而直接將請求轉向處於硬碟的資料庫
	- 緩存本身是可用的話，那麼很有可能就是緩存上有大量資料在同時間因為過期而失效，進而讓緩存沒有那些資料來滿足客戶端，客戶端只好找資料庫來存取資料

### 緩存大量資料同時過期：解決方案
分別引用
[[@manbucoding2022NianRedisZuiXinMianShiTiDi8PianRedisHuanCunWenTiWx624642a80743cDeJiShuBoKe]]
[[@liuRedisKuaiQuXueBengJiChuan2021]]
這兩個文獻所描述的方案
> 这种类似的问题解决思路也基本简单, 打散过期时间, 比如设置过期时间为 24小时之后 + 随机N分钟。
> 因為是同個時間點，所有的cache key大規模失效，因此可以在設定 cache 時，給予每個cache key **隨機的過期時間**，或者 **不設定過期時間** 。每個cache key 過期時間的設定，其核心理念在你想要更新資料的頻率。

重點：
- 解決緩存大量資料同時過期的核心主要有兩個：
	- 將緩存中的key過期時間打散，別太集中於同一個時間段，具體解法為設定每個在緩存的資料所擁有的過期時間是隨機
	- 不對緩存的key設定過期時間

### 緩存本身當機：解決方案

> 这个就需要分析Redis宕机的原因了， 是因为磁盘满了还是内存满了, 根据情况进行处理，或者升配置什么的。
> 如果是内存满了, 也需要考虑是不是缓存过期回收策略的问题。

重點：
- 解決緩存本身當機的核心主要是：
	- 了解當機原因是否因為系統資源不太能應付請求，如擔任緩存的主機是否硬碟滿了、是否記憶體滿了，具體解法就是提升配置、考慮如何有效回收系統資源、添置更多主機和負載平衡機制
	- 了解當機原因是否因為被人惡意破壞，比如處在的網路環境容易被人惡意攻擊，那麼具體解法會是將擔任緩存的主機設定類似於VPC的環境下或者設定防火牆

## 複習
#🧠 Cache Avalanche 命名緣由是什麼？ ->->-> `Cache 在這裡會是緩存，Avalanche 本身會是指雪崩，但在這裡雪崩是指大量請求，合併起來就是由緩存帶來的雪崩或者由緩存帶來的大量請求`
<!--SR:!2022-06-12,6,250-->

#🧠  Cache Avalanche 是什麼樣的問題？->->-> `是指由緩存帶來的大量請求，而這些請求會因為大量緩存中的key失效而導致請求導向至處於硬碟的資料庫系統，大量請求同時向資料庫發送，會使資料庫負載激增，甚至會使該資料庫當機。`
<!--SR:!2022-06-16,10,250-->

#🧠 Cache Avalanche 起因有哪些(提示：請考慮redis可用的情況下和不可用的情況下)->->-> `緩存本身不能用的話，也就是即為當機，那麼就會因為策略而直接將請求轉向處於硬碟的資料庫；緩存本身是可用的話，那麼很有可能就是緩存上有大量key在同時間因為過期而失效，進而讓緩存沒有那些資料來滿足客戶端，客戶端只好找資料庫來存取資料`
<!--SR:!2022-06-15,10,250-->


#🧠  緩存中的大量key同時過期：解決方案是什麼？ (提示：請考慮redis可用的情況下和不可用的情況下)->->-> `解決緩存中的大量key同時過期的核心主要有兩個： 將key的過期時間打散，別太集中於同一個時間段，具體解法為設定每個在緩存的資料所擁有的過期時間是隨機、不設定過期時間`
<!--SR:!2022-06-15,10,250-->

#🧠 緩存本身當機：解決方案是什麼？(提示：網路環境和本身) ->->-> `解決緩存本身當機的核心主要是： 了解當機原因是否因為系統資源不太能應付請求，如擔任緩存的主機是否硬碟滿了、是否記憶體滿了，具體解法就是提升配置、考慮如何有效回收系統資源、添置更多主機和負載平衡機制、了解當機原因是否因為被人惡意破壞，比如處在的網路環境容易被人惡意攻擊，那麼具體解法會是將擔任緩存的主機設定類似於VPC的環境下或者設定防火牆`
<!--SR:!2022-06-16,10,250-->

---
Status: #🌱 
Tags:
[[Redis] - [[Caching]]
Links:
[[Cache Penetration 是指請求因索取的東西原本就不存在資料庫而直接被導向至處於硬碟的資料庫]]
[[Hotspot Invalid 是指由於某個熱門的資料在緩存失效而導致大量索求該資料的請求直接被轉向至資料庫]]
References:
[[@manbucoding2022NianRedisZuiXinMianShiTiDi8PianRedisHuanCunWenTiWx624642a80743cDeJiShuBoKe]]
[[@liuRedisKuaiQuXueBengJiChuan2021]]