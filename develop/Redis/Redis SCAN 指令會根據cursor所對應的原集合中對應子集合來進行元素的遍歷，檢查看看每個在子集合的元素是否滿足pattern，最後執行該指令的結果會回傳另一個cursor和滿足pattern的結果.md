




## æè¿°

> WhileÂ `SCAN`Â does not provide guarantees about the number of elements returned at every iteration, it is possible to empirically adjust the behavior ofÂ `SCAN`Â using theÂ **COUNT**Â option. Basically with COUNT the user specified theÂ _amount of work that should be done at every call in order to retrieve elements from the collection_. This isÂ **just a hint**Â for the implementation, however generally speaking this is what you could expect most of the times from the implementation.

é‡é»ï¼š
- Redis Scan Cursor æŒ‡ä»¤å¦‚ä¸‹ï¼Œæ¯ç•¶è¢«åŸ·è¡Œæ™‚ï¼Œå°±æœƒå¾åŸé›†åˆ(KEYé›†åˆ)ä¸­æŒ‘é¸cursorå°æ‡‰çš„ç´¢å¼•å€¼ä¾†å–å¾—COUNTå€‹å…ƒç´ ç•¶ä½œå­é›†åˆï¼Œç„¶å¾Œå°å­é›†åˆçš„æ¯å€‹å…ƒç´ é€²è¡Œéæ­·ï¼Œç„¶å¾Œé€å€‹æŸ¥çœ‹å…ƒç´ æ˜¯å¦æ»¿è¶³patternï¼Œè‹¥æ»¿è¶³çš„è©±ï¼Œæœ¬æ¬¡è¿­ä»£å°±æœƒç´€éŒ„å…¶å…ƒç´ ï¼Œè‹¥æ²’æ»¿è¶³çš„è©±ï¼Œå°±æœƒè·³éï¼Œç›´åˆ°éæ­·å®Œç•¢ä¹‹å¾Œã€‚

```
SCAN <cursor> MATCH <pattern> COUNT <count>
```

- å…·é«”æœƒå›å‚³å…©å€‹å…ƒç´ åˆ†åˆ¥ç‚ºï¼š
	-  cursorï¼šå¦ä¸€å€‹cursorï¼Œä½†å…·é«”æœƒå°æ‡‰çš„ç´¢å¼•å€¼æœƒæ˜¯ åŸé›†åˆä¸­çš„ç•¶å‰cursor å°æ‡‰çš„ç´¢å¼•å€¼ + COUNT
	-  ç•¶å‰ç›®å‰å­é›†åˆçš„éæ­·æ‰€æ»¿è¶³patternçš„å…ƒç´ æœ‰å“ªäº›ï¼Œä»¥é™£åˆ—ä¾†è¡¨ç¤º

> SCAN, SSCAN, HSCAN and ZSCAN return a two elements multi-bulk reply, where the first element is a string representing an unsigned 64 bit number (the cursor), and the second element is a multi-bulk with an array of elements.

- è‹¥cursor å°æ‡‰çš„ç´¢å¼•å€¼ç®—æ³•æ˜¯ä¾æ“šç‰¹å®šç®—æ³•è€Œç®—å‡ºä¾†çš„
- cursor å…·é«”ä¾†èªªæœƒæ˜¯æŒ‡
	- ç¶“ç”±ç‰¹å®šç®—æ³•è¨ˆç®—å‡ºä¾†çš„ç´¢å¼•å€¼ï¼Œå…¶ç´¢å¼•å€¼æœƒæ˜¯æŒ‡åŸé›†åˆä¸­çš„ç´¢å¼•
	- å°æ‡‰å­é›†åˆçš„éæ­·å’Œå…¶éæ­·çµæœ

[[@bondarenkoAnswerRedisHow2015]] 
- è‹¥cursor ç‚º0çš„è©±ï¼Œé‚£éº¼å°æ‡‰çš„ç´¢å¼•å€¼å³ç‚ºåŸé›†åˆçš„ç´¢å¼•ä»¥åŠå°ç¬¬ä¸€å€‹å­é›†åˆé€²è¡Œéæ­·å’Œå…¶çµæœ
### ç¯„ä¾‹
å‡è¨­keyé›†åˆå¦‚ä¸‹ï¼Œä¸¦å‡è¨­æ¯æ¬¡è¿­ä»£åªå–ä¸€å€‹keyï¼ŒSCANå¯ä»¥åˆ‡å‰²å‡ºä¾†çš„è¿­ä»£æœ‰äº”æ¬¡ï¼Œæ¯å€‹è¿­ä»£æ‹¿çš„keyéƒ½çš†ç‚ºä¸åŒï¼Œè¿­ä»£1æœƒæ‹¿åˆ°key1ï¼Œè¿­ä»£2æœƒæ‹¿åˆ°key2ï¼Œè¿­ä»£3æœƒæ‹¿åˆ°key3ï¼Œè¿­ä»£4æœƒæ‹¿åˆ°key4ï¼Œè¿­ä»£5æœƒæ‹¿åˆ°key5ï¼Œ
```
key1
key2
key3
key4
key5
```

æ¯å€‹è¿­ä»£éƒ½æœƒå¾patternä¾†æ¯”å°æ‹¿åˆ°çš„keyæ˜¯å¦ç›¸ç¬¦ï¼Œçµæœè¿­ä»£3æ‹¿åˆ°çš„keyç›¸ç¬¦ï¼Œé‚£éº¼æ¯å€‹è¿­ä»£çš„çµæœæœƒæ˜¯
```
// ä»»å‹™1
empty
// ä»»å‹™2
empty
// ä»»å‹™3
key3
// ä»»å‹™4
empty
// ä»»å‹™5
empty
```


## è¤‡ç¿’

#ğŸ§   ç•¶Redis ä¼ºæœå™¨åŸ·è¡Œ SCAN cursor æŒ‡ä»¤æ™‚ï¼Œæœƒå¦‚ä½•åŸ·è¡Œï¼Ÿ->->-> `æ¯ç•¶è¢«åŸ·è¡Œæ™‚ï¼Œå°±æœƒå¾åŸé›†åˆ(KEYé›†åˆ)ä¸­æŒ‘é¸cursorå°æ‡‰çš„ç´¢å¼•å€¼ä¾†å–å¾—COUNTå€‹å…ƒç´ ç•¶ä½œå­é›†åˆï¼Œç„¶å¾Œå°å­é›†åˆçš„æ¯å€‹å…ƒç´ é€²è¡Œéæ­·ï¼Œç„¶å¾Œé€å€‹æŸ¥çœ‹å…ƒç´ æ˜¯å¦æ»¿è¶³patternï¼Œè‹¥æ»¿è¶³çš„è©±ï¼Œæœ¬æ¬¡è¿­ä»£å°±æœƒç´€éŒ„å…¶å…ƒç´ ï¼Œè‹¥æ²’æ»¿è¶³çš„è©±ï¼Œå°±æœƒè·³éï¼Œç›´åˆ°éæ­·å®Œç•¢ä¹‹å¾Œã€‚`

#ğŸ§  ç•¶Redis ä¼ºæœå™¨åŸ·è¡Œ SCAN cursor æŒ‡ä»¤å¾Œçš„å›æ‡‰çµæœæœƒæ˜¯ä»€éº¼ï¼Ÿ ->->-> `å…·é«”æœƒå›å‚³å…©å€‹å…ƒç´ åˆ†åˆ¥ç‚ºï¼š -  cursorï¼šå¦ä¸€å€‹cursorï¼Œä½†å…·é«”æœƒå°æ‡‰çš„ç´¢å¼•å€¼æœƒæ˜¯ åŸé›†åˆä¸­çš„ç•¶å‰cursor å°æ‡‰çš„ç´¢å¼•å€¼ + COUNT -  ç•¶å‰ç›®å‰å­é›†åˆçš„éæ­·æ‰€æ»¿è¶³patternçš„å…ƒç´ æœ‰å“ªäº›ï¼Œä»¥é™£åˆ—ä¾†è¡¨ç¤º`

#ğŸ§  Redis SCAN cursor çš„ cursoræœƒæ˜¯æŒ‡ä»€éº¼ï¼Ÿ->->-> `- cursor å…·é«”ä¾†èªªæœƒæ˜¯æŒ‡ - ç¶“ç”±ç‰¹å®šç®—æ³•è¨ˆç®—å‡ºä¾†çš„ç´¢å¼•å€¼ï¼Œå…¶ç´¢å¼•å€¼æœƒæ˜¯æŒ‡åŸé›†åˆä¸­çš„ç´¢å¼• - å°æ‡‰å­é›†åˆçš„éæ­·å’Œå…¶éæ­·çµæœ`

#ğŸ§  Redis SCAN cursor çš„ cursor æ˜¯0ï¼Œé‚£éº¼å°æ‡‰ç´¢å¼•å€¼ä»¥åŠçµæœç‚ºä½•ï¼Ÿ->->-> ` è‹¥cursor ç‚º0çš„è©±ï¼Œé‚£éº¼å°æ‡‰çš„ç´¢å¼•å€¼å³ç‚ºåŸé›†åˆçš„ç´¢å¼•ä»¥åŠå°ç¬¬ä¸€å€‹å­é›†åˆé€²è¡Œéæ­·å’Œå…¶çµæœ`


#ğŸ§  Redis SCAN cursor çš„ cursor æ˜¯2ï¼Œé‚£éº¼ å°æ‡‰ç´¢å¼•å€¼ä»¥åŠçµæœç‚ºä½•ï¼Ÿ ->->-> `cursor 2æœƒç¶“ç”±ç®—æ³•è€Œç®—å‡ºç‰¹å®šçš„ç´¢å¼•å€¼ï¼Œè€Œé€éç´¢å¼•å€¼ä¾†å¾åŸé›†åˆä¸­çš„ç´¢å¼•å€¼ä½ç½®é–‹å§‹å–å‡ºCOUNTå€‹å…ƒç´ ä¾†ç•¶ä½œå­é›†åˆä¾†éæ­·ï¼Œä¸¦æŸ¥çœ‹å“ªäº›å…ƒç´ æ»¿è¶³patternï¼Œå“ªäº›æ²’æœ‰ï¼Œæœ€å¾Œå›å‚³ä¸‹ä¸€å€‹cursorå’Œç•¶å‰cursoræ‰€æ»¿è¶³patternçš„å…ƒç´ æœ‰å“ªäº›ï¼Œä¸‹ä¸€å€‹cursoræœƒæ˜¯ä»¥æ¥çºŒè‘—ç›®å‰éæ­·çš„å­é›†åˆä¹‹å¾Œç‚ºä¸»çš„å­é›†åˆ`

#ğŸ§  Redis SCAN æ¯å€‹è¿­ä»£æœƒå¦‚ä½•å¾é›†åˆå–å‡ºè³‡æ–™ï¼Ÿå¦‚ä½•è™•ç†ï¼Ÿçµæœæœƒæ˜¯ä»€éº¼ï¼Ÿèˆ‰ä¸€å€‹ä¾‹å­ï¼Œä»¥äº”å€‹Keyä½œç‚ºé›†åˆä»¥åŠæ¯ä¸€æ¬¡è¿­ä»£åªå–ä¸€å€‹keyç‚ºä¾‹ ->->-> `å‡è¨­keyé›†åˆå¦‚ä¸‹ï¼Œä¸¦å‡è¨­æ¯æ¬¡è¿­ä»£åªå–ä¸€å€‹keyï¼ŒSCANå¯ä»¥åˆ‡å‰²å‡ºä¾†çš„è¿­ä»£æœ‰äº”æ¬¡ï¼Œæ¯å€‹è¿­ä»£æ‹¿çš„keyéƒ½çš†ç‚ºä¸åŒï¼Œè¿­ä»£1æœƒæ‹¿åˆ°key1ï¼Œè¿­ä»£2æœƒæ‹¿åˆ°key2ï¼Œè¿­ä»£3æœƒæ‹¿åˆ°key3ï¼Œè¿­ä»£4æœƒæ‹¿åˆ°key4ï¼Œè¿­ä»£5æœƒæ‹¿åˆ°key5ï¼Œæ¯å€‹è¿­ä»£éƒ½æœƒå¾patternä¾†æ¯”å°æ‹¿åˆ°çš„keyæ˜¯å¦ç›¸ç¬¦ï¼Œçµæœè¿­ä»£3æ‹¿åˆ°çš„keyç›¸ç¬¦ï¼Œé‚£éº¼æ¯å€‹è¿­ä»£çš„çµæœæœƒæ˜¯`


#ğŸ§   Redis SCAN COUNTåƒæ•¸æ˜¯åšä»€éº¼ç”¨ ->->-> `åƒæ•¸æ˜¯ç”¨ä¾†æŒ‡å®šæ¯ä¸€æ¬¡å‘¼å«å¾key é›†åˆç²å–çš„keyæ•¸é‡ï¼Œä¹Ÿå°±æ˜¯æ¯å€‹å‘¼å«æ‰€è¦è² è²¬æ¯”å°çš„keyæ•¸é‡`
<!--SR:!2022-07-22,28,250-->

---
Status: #ğŸŒ± 
Tags:
[[Redis]] - [[Database]]
Links:
[[Redis Scan æ˜¯æŒ‰ä¾æ“šæ•¸é‡ä¾†å°è³‡æ–™åº«çš„è³‡æ–™ä¾†åˆ†é ä¸¦ä¸”æä¾›é–‹ç™¼è€…ä»¥æŒ‡å®šcursorä¾†å°å‘å°æ‡‰çš„è³‡æ–™ç¾¤çµ„]]
References:
[[@redisSCAN]]
[[@bondarenkoAnswerRedisHow2015]]