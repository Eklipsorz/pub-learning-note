
## 描述
> 資料指標是在資料庫產生結果集時，由資料庫引擎所產生的一個指標，用來指示目前正在存取的結果集的位置，經由這個指標，可以得到結果集中的資料列，並且可以依照需求來移動，但由於指標會佔用伺服器的資源，並且在指標開啟期間會啟用共享鎖定(Shared Lock)，在多人使用的系統中容易造成死結的問題，因此目前大部份的應用程式都是使用僅前移型指標 (Forward-Only Cursor)。


> 僅前移型指標 (Forward-Only Cursor) 是一旦將指標往前移時，其走過的指標之前的結果集就會被捨棄，因此應用程式不能再往後移動指標，但也因此讓伺服器只需要記住指標在結果集中目前的位置即可，這讓它消耗的資源只有指標而已，是最省資源的一種指標，在實務中被廣泛使用，像 ADO.NET 的 DataReader 就只限定只能使用 Forward-Only Cursor。

重點：
- 當使用database cursor時，有可能會使用Shared Lock來將已經分群組的資料集合固定下來，不讓人修改
- 在第一種敘述的情況下，會在多人使用的系統中造成deadlock
```
假如有兩個執行緒A、B，執行緒A正在使用共享鎖來讀取R2，並且同時想寫入R1，而執行緒B正在使用共享鎖來讀取R1，並且同時想寫入R2
```
- 解法就是使用Forward-Only Cursor，該方法是一旦將導向任意一個cursor後，走過的指標將會被捨棄，因此不能夠往回移動，這樣就只需要對目前cursor對應的內容進行shared lock
[[@ZhiBiaoZiLiaoKu2021]]
> 僅前移型指標 (Forward-Only Cursor) 是一旦將指標往前移時，其走過的指標之前的結果集就會被捨棄，因此應用程式不能再往後移動指標，但也因此讓伺服器只需要記住指標在結果集中目前的位置即可，這讓它消耗的資源只有指標而已，是最省資源的一種指標，在實務中被廣泛使用，像 ADO.NET 的 DataReader 就只限定只能使用 Forward-Only Cursor。

## 複習
#🧠 database cursor 上的每個cursor對應的資料集合會不會有可能在過程中被人修改、增加元素、移除元素 ->->-> `有可能，這使得預期要存取到的資料會不如預期`

#🧠 database cursor 如何解決在定義cursor的過程中所發生的不一致問題 (提示：鎖)->->-> `使用Shared Lock來將已經分群組的資料集合固定下來，不讓人修改`

#🧠 database cursor 若使用鎖來解決不一致問題，那麼在多人使用的系統中會造成什麼樣的問題？用兩個執行緒A、B和兩個資源R1、R2來描述 ->->-> `會在多人使用的系統中造成deadlock，假如有兩個執行緒A、B，執行緒A正在使用共享鎖來讀取R2，並且同時想寫入R1，而執行緒B正在使用共享鎖來讀取R1，並且同時想寫入R2`

#🧠  database cursor 面對deadlock的情況，還能使用何種方式來改善(提示：我們往前走吧) ->->-> `解法就是使用Forward-Only Cursor，該方法是一旦將導向任意一個cursor後，走過的指標將會被捨棄，因此不能夠往回移動，這樣就只需要對目前cursor對應的內容進行shared lock`

---
Status: #🌱 
Tags:
[[Databse]] - [[Redis]] - [[Database Cursor]]
Links:
References:
[[@ZhiBiaoZiLiaoKu2021]]
