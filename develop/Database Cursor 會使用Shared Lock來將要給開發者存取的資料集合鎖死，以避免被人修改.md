
## æè¿°
> è³‡æ–™æŒ‡æ¨™æ˜¯åœ¨è³‡æ–™åº«ç”¢ç”Ÿçµæœé›†æ™‚ï¼Œç”±è³‡æ–™åº«å¼•æ“æ‰€ç”¢ç”Ÿçš„ä¸€å€‹æŒ‡æ¨™ï¼Œç”¨ä¾†æŒ‡ç¤ºç›®å‰æ­£åœ¨å­˜å–çš„çµæœé›†çš„ä½ç½®ï¼Œç¶“ç”±é€™å€‹æŒ‡æ¨™ï¼Œå¯ä»¥å¾—åˆ°çµæœé›†ä¸­çš„è³‡æ–™åˆ—ï¼Œä¸¦ä¸”å¯ä»¥ä¾ç…§éœ€æ±‚ä¾†ç§»å‹•ï¼Œä½†ç”±æ–¼æŒ‡æ¨™æœƒä½”ç”¨ä¼ºæœå™¨çš„è³‡æºï¼Œä¸¦ä¸”åœ¨æŒ‡æ¨™é–‹å•ŸæœŸé–“æœƒå•Ÿç”¨å…±äº«é–å®š(Shared Lock)ï¼Œåœ¨å¤šäººä½¿ç”¨çš„ç³»çµ±ä¸­å®¹æ˜“é€ æˆæ­»çµçš„å•é¡Œï¼Œå› æ­¤ç›®å‰å¤§éƒ¨ä»½çš„æ‡‰ç”¨ç¨‹å¼éƒ½æ˜¯ä½¿ç”¨åƒ…å‰ç§»å‹æŒ‡æ¨™ (Forward-Only Cursor)ã€‚


> åƒ…å‰ç§»å‹æŒ‡æ¨™ (Forward-Only Cursor) æ˜¯ä¸€æ—¦å°‡æŒ‡æ¨™å¾€å‰ç§»æ™‚ï¼Œå…¶èµ°éçš„æŒ‡æ¨™ä¹‹å‰çš„çµæœé›†å°±æœƒè¢«æ¨æ£„ï¼Œå› æ­¤æ‡‰ç”¨ç¨‹å¼ä¸èƒ½å†å¾€å¾Œç§»å‹•æŒ‡æ¨™ï¼Œä½†ä¹Ÿå› æ­¤è®“ä¼ºæœå™¨åªéœ€è¦è¨˜ä½æŒ‡æ¨™åœ¨çµæœé›†ä¸­ç›®å‰çš„ä½ç½®å³å¯ï¼Œé€™è®“å®ƒæ¶ˆè€—çš„è³‡æºåªæœ‰æŒ‡æ¨™è€Œå·²ï¼Œæ˜¯æœ€çœè³‡æºçš„ä¸€ç¨®æŒ‡æ¨™ï¼Œåœ¨å¯¦å‹™ä¸­è¢«å»£æ³›ä½¿ç”¨ï¼Œåƒ ADO.NET çš„ DataReader å°±åªé™å®šåªèƒ½ä½¿ç”¨ Forward-Only Cursorã€‚

é‡é»ï¼š
- ç•¶ä½¿ç”¨database cursoræ™‚ï¼Œæœ‰å¯èƒ½æœƒä½¿ç”¨Shared Lockä¾†å°‡å·²ç¶“åˆ†ç¾¤çµ„çš„è³‡æ–™é›†åˆå›ºå®šä¸‹ä¾†ï¼Œä¸è®“äººä¿®æ”¹
- åœ¨ç¬¬ä¸€ç¨®æ•˜è¿°çš„æƒ…æ³ä¸‹ï¼Œæœƒåœ¨å¤šäººä½¿ç”¨çš„ç³»çµ±ä¸­é€ æˆdeadlock
```
å‡å¦‚æœ‰å…©å€‹åŸ·è¡Œç·’Aã€Bï¼ŒåŸ·è¡Œç·’Aæ­£åœ¨ä½¿ç”¨å…±äº«é–ä¾†è®€å–R2ï¼Œä¸¦ä¸”åŒæ™‚æƒ³å¯«å…¥R1ï¼Œè€ŒåŸ·è¡Œç·’Bæ­£åœ¨ä½¿ç”¨å…±äº«é–ä¾†è®€å–R1ï¼Œä¸¦ä¸”åŒæ™‚æƒ³å¯«å…¥R2
```
- è§£æ³•å°±æ˜¯ä½¿ç”¨Forward-Only Cursorï¼Œè©²æ–¹æ³•æ˜¯ä¸€æ—¦å°‡å°å‘ä»»æ„ä¸€å€‹cursorå¾Œï¼Œèµ°éçš„æŒ‡æ¨™å°‡æœƒè¢«æ¨æ£„ï¼Œå› æ­¤ä¸èƒ½å¤ å¾€å›ç§»å‹•ï¼Œé€™æ¨£å°±åªéœ€è¦å°ç›®å‰cursorå°æ‡‰çš„å…§å®¹é€²è¡Œshared lock
[[@ZhiBiaoZiLiaoKu2021]]
> åƒ…å‰ç§»å‹æŒ‡æ¨™ (Forward-Only Cursor) æ˜¯ä¸€æ—¦å°‡æŒ‡æ¨™å¾€å‰ç§»æ™‚ï¼Œå…¶èµ°éçš„æŒ‡æ¨™ä¹‹å‰çš„çµæœé›†å°±æœƒè¢«æ¨æ£„ï¼Œå› æ­¤æ‡‰ç”¨ç¨‹å¼ä¸èƒ½å†å¾€å¾Œç§»å‹•æŒ‡æ¨™ï¼Œä½†ä¹Ÿå› æ­¤è®“ä¼ºæœå™¨åªéœ€è¦è¨˜ä½æŒ‡æ¨™åœ¨çµæœé›†ä¸­ç›®å‰çš„ä½ç½®å³å¯ï¼Œé€™è®“å®ƒæ¶ˆè€—çš„è³‡æºåªæœ‰æŒ‡æ¨™è€Œå·²ï¼Œæ˜¯æœ€çœè³‡æºçš„ä¸€ç¨®æŒ‡æ¨™ï¼Œåœ¨å¯¦å‹™ä¸­è¢«å»£æ³›ä½¿ç”¨ï¼Œåƒ ADO.NET çš„ DataReader å°±åªé™å®šåªèƒ½ä½¿ç”¨ Forward-Only Cursorã€‚

## è¤‡ç¿’
#ğŸ§  database cursor ä¸Šçš„æ¯å€‹cursorå°æ‡‰çš„è³‡æ–™é›†åˆæœƒä¸æœƒæœ‰å¯èƒ½åœ¨éç¨‹ä¸­è¢«äººä¿®æ”¹ã€å¢åŠ å…ƒç´ ã€ç§»é™¤å…ƒç´  ->->-> `æœ‰å¯èƒ½ï¼Œé€™ä½¿å¾—é æœŸè¦å­˜å–åˆ°çš„è³‡æ–™æœƒä¸å¦‚é æœŸ`

#ğŸ§  database cursor å¦‚ä½•è§£æ±ºåœ¨å®šç¾©cursorçš„éç¨‹ä¸­æ‰€ç™¼ç”Ÿçš„ä¸ä¸€è‡´å•é¡Œ (æç¤ºï¼šé–)->->-> `ä½¿ç”¨Shared Lockä¾†å°‡å·²ç¶“åˆ†ç¾¤çµ„çš„è³‡æ–™é›†åˆå›ºå®šä¸‹ä¾†ï¼Œä¸è®“äººä¿®æ”¹`

#ğŸ§  database cursor è‹¥ä½¿ç”¨é–ä¾†è§£æ±ºä¸ä¸€è‡´å•é¡Œï¼Œé‚£éº¼åœ¨å¤šäººä½¿ç”¨çš„ç³»çµ±ä¸­æœƒé€ æˆä»€éº¼æ¨£çš„å•é¡Œï¼Ÿç”¨å…©å€‹åŸ·è¡Œç·’Aã€Bå’Œå…©å€‹è³‡æºR1ã€R2ä¾†æè¿° ->->-> `æœƒåœ¨å¤šäººä½¿ç”¨çš„ç³»çµ±ä¸­é€ æˆdeadlockï¼Œå‡å¦‚æœ‰å…©å€‹åŸ·è¡Œç·’Aã€Bï¼ŒåŸ·è¡Œç·’Aæ­£åœ¨ä½¿ç”¨å…±äº«é–ä¾†è®€å–R2ï¼Œä¸¦ä¸”åŒæ™‚æƒ³å¯«å…¥R1ï¼Œè€ŒåŸ·è¡Œç·’Bæ­£åœ¨ä½¿ç”¨å…±äº«é–ä¾†è®€å–R1ï¼Œä¸¦ä¸”åŒæ™‚æƒ³å¯«å…¥R2`

#ğŸ§   database cursor é¢å°deadlockçš„æƒ…æ³ï¼Œé‚„èƒ½ä½¿ç”¨ä½•ç¨®æ–¹å¼ä¾†æ”¹å–„(æç¤ºï¼šæˆ‘å€‘å¾€å‰èµ°å§) ->->-> `è§£æ³•å°±æ˜¯ä½¿ç”¨Forward-Only Cursorï¼Œè©²æ–¹æ³•æ˜¯ä¸€æ—¦å°‡å°å‘ä»»æ„ä¸€å€‹cursorå¾Œï¼Œèµ°éçš„æŒ‡æ¨™å°‡æœƒè¢«æ¨æ£„ï¼Œå› æ­¤ä¸èƒ½å¤ å¾€å›ç§»å‹•ï¼Œé€™æ¨£å°±åªéœ€è¦å°ç›®å‰cursorå°æ‡‰çš„å…§å®¹é€²è¡Œshared lock`

---
Status: #ğŸŒ± 
Tags:
[[Databse]] - [[Redis]] - [[Database Cursor]]
Links:
References:
[[@ZhiBiaoZiLiaoKu2021]]
