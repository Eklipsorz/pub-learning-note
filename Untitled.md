


## æè¿°
[[@chengmomorganSetStateZheGeAPISheJiDaoDiZenMeYang]]
> ## å¤šæ¬¡setStateå‡½æ•°è°ƒç”¨äº§ç”Ÿçš„æ•ˆæœä¼šåˆå¹¶

> æ¯”å¦‚ä¸‹é¢çš„ä»£ç ã€‚

```text
function updateName() {
  this.setState({FirstName: 'Morgan'});
  this.setState({LastName: 'Cheng'});
}
```

> è¿ç»­è°ƒç”¨äº†ä¸¤æ¬¡this.setStateï¼Œä½†æ˜¯åªä¼šå¼•å‘ä¸€æ¬¡æ›´æ–°ç”Ÿå‘½å‘¨æœŸï¼Œä¸æ˜¯ä¸¤æ¬¡ï¼Œå› ä¸ºReactä¼šå°†å¤šä¸ªthis.setStateäº§ç”Ÿçš„ä¿®æ”¹æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œç¼“ä¸€ç¼“ï¼Œæ”’åœ¨ä¸€èµ·ï¼Œè§‰å¾—å·®ä¸å¤šäº†å†å¼•å‘ä¸€æ¬¡æ›´æ–°è¿‡ç¨‹ã€‚


> åœ¨æ¯æ¬¡æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œä¼šæŠŠç§¯æ”’çš„setStateç»“æœåˆå¹¶ï¼Œåšä¸€ä¸ªmergeçš„åŠ¨ä½œï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç ç›¸å½“äºè¿™æ ·ã€‚

```text
function updateName() {
  this.setState({FirstName: 'Morgan', LastName: 'Cheng'});
}
```

> å¦‚æœæ¯ä¸€ä¸ªthis.setStateéƒ½å¼•å‘ä¸€ä¸ªæ›´æ–°è¿‡ç¨‹çš„è¯ï¼Œé‚£å°±å¤ªæµªè´¹äº†ï¼
> 
> å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œä¹Ÿå¯ä»¥æ”¾å¿ƒå¤šæ¬¡è°ƒç”¨this.setStateï¼Œæ¯ä¸€æ¬¡åªè¦å…³æ³¨å½“å‰ä¿®æ”¹çš„é‚£ä¸€ä¸ªå­—æ®µå°±è¡Œï¼Œåæ­£å…¶ä»–å­—æ®µä¼šåˆå¹¶ä¿ç•™ï¼Œä¸¢ä¸æ‰ã€‚  
> 
> æ‰€ä»¥ï¼Œåˆå¹¶å¤šæ¬¡this.setStateè°ƒç”¨æ›´æ”¹çš„çŠ¶æ€è¿™ä¸ªAPIè®¾è®¡å†³å®šä¹Ÿä¸é”™ã€‚
> 
> **æ€»ç»“ä¸€ä¸‹ï¼ŒsetStateæœ€æ‹›éª‚çš„å°±æ˜¯ä¸ä¼šç«‹å³ä¿®æ”¹this.stateã€‚**
> 
> å¦‚æœæœ‰å¯èƒ½çš„è¯ï¼Œæ€ä¹ˆæ”¹è¿›è¿™ä¸ªAPIå‘¢ï¼Ÿ
>
>é¦–å…ˆsetStateè‚¯å®šè¿˜æ˜¯ä¸èƒ½ç«‹åˆ»æ›´æ–°this.stateï¼Œä¸ç„¶Reactæ•´ä¸ªæ¦‚å¿µå°±è¢«æ¨ç¿»äº†ï¼Œæ‰€ä»¥èƒ½åšçš„åªæ˜¯ç”¨ä¸€ä¸ªæ›´æ¸…æ¥šçš„æ–¹å¼è¡¨è¾¾ï¼Œè®©å¼€å‘è€…ä¸ä¼šè¯¯ä»¥ä¸ºthis.stateä¼šè¢«this.setStateç«‹å³æ›´æ–°ï¼Œå¥½åƒä¹Ÿæ²¡æœ‰ç‰¹åˆ«å¥½çš„æ”¹è¿›æ–¹æ³•ã€‚
>
>ä¸è¿‡ï¼Œæœ€è¿‘ä¸€ä¸ªthis.setStateå‡½æ•°çš„éšè—åŠŸèƒ½è¿›å…¥äº†å¤§å®¶çš„è§†é‡ï¼Œé‚£å°±æ˜¯ï¼š**åŸæ¥this.setStateå¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°å•Šï¼**

é‡é»ï¼š
- setState æ¯ä¸€æ¬¡å‘¼å«æ™‚ï¼Œæœƒç”Ÿæˆä»¥ä¸‹æŒ‡å®šä»»å‹™å…§å®¹çš„éåŒæ­¥ä»»å‹™ä¸¦æ”¾é€²ä½‡åˆ—ï¼Œå…¶ä½‡åˆ—æœƒçµ¦ç³»çµ±ä¸­çš„éåŒæ­¥ä»»å‹™Xä¾†è² è²¬è™•ç†æ¸²æŸ“
	- æ›´æ–°æŒ‡å®šç‹€æ…‹å€¼
- ç•¶æ²’æœ‰å†åº¦æ¥æ”¶setStateæ™‚ï¼ŒéåŒæ­¥ä»»å‹™Xé–‹å§‹è™•ç†ä½‡åˆ—è£¡çš„éåŒæ­¥ä»»å‹™ï¼Œæœƒå…ˆå°‡ä½‡åˆ—è£¡çš„ä»»å‹™å€‘æ‰€è¦æ±‚çš„ç‹€æ…‹ä¿®æ”¹åˆä½µï¼Œé€™æœƒä½¿å¾—å¤šå€‹ä»»å‹™åˆä½µæˆä¸€å€‹ä»»å‹™ï¼Œå…¶ä»»å‹™è¦æ±‚æŒ‡å®šçš„ç‹€æ…‹å€¼æœƒæ˜¯å¤šå€‹ä»»å‹™æ‰€æŒ‡å®šçš„ç‹€æ…‹æ‰€åˆä½µçš„æ¨£å­ï¼Œæœ€å¾Œå°±ä»¥é‚£å€‹ä»»å‹™ä¾†è§¸ç™¼updatingçš„ç”Ÿå‘½é€±æœŸ


### å¯¦éš›å¯¦ç¾ 1 - å°‡ç‹€æ…‹æ›´æ–°ä»»å‹™æ”¾ç½®ä½‡åˆ—

- setState **æ¯ä¸€æ¬¡å‘¼å«æ™‚ï¼Œæœƒç”ŸæˆéåŒæ­¥ä»»å‹™ä¸¦æ”¾é€²ä½‡åˆ—ï¼Œå…¶ä½‡åˆ—æœƒçµ¦ç³»çµ±ä¸­çš„éåŒæ­¥ä»»å‹™Xä¾†è² è²¬è™•ç†æ¸²æŸ“** 
- å¯¦éš›å¯¦ç¾ç‚ºï¼šæ¯ç•¶åŸ·è¡Œåˆ°setStateå°±å…ˆæŒ‰ä¸‹é¢ä¾†åš
	- è‹¥ç‹€æ…‹æ˜¯ä»¥å–®ä¸€å€¼ä¾†å„²å­˜çš„è©±ï¼Œå°±ç›´æ¥æ‹¿ç›®å‰ä»»å‹™çš„ç‹€æ…‹å»è¦†è“‹å…ˆå‰ä»»å‹™æ‰€è¨˜éŒ„çš„ç‹€æ…‹
	- è‹¥ç‹€æ…‹æ˜¯ä»¥å¤šå±¬æ€§çš„ç‰©ä»¶ä¾†å„²å­˜çš„è©±ï¼š
		- ä¸€é–‹å§‹æœƒå®šç¾©çµæœç‰©ä»¶ç‚ºç©ºç‰©ä»¶
		- æ‹¿ç›®å‰ä»»å‹™çš„ç‹€æ…‹-ç‰©ä»¶å±¬æ€§å»è¿½åŠ /è¦†è“‹è‡³çµæœç‰©ä»¶ä¸Šç›®å‰çš„å±¬æ€§å€åˆ†

### å¯¦éš›å¯¦ç¾ 2 - è™•ç†ä½‡åˆ—çš„ä»»å‹™

**ç•¶éåŒæ­¥ä»»å‹™Xé–‹å§‹è™•ç†ä½‡åˆ—è£¡çš„éåŒæ­¥ä»»å‹™ï¼Œæœƒå…ˆå°‡ä½‡åˆ—è£¡çš„ä»»å‹™å€‘æ‰€è¦æ±‚çš„ç‹€æ…‹ä¿®æ”¹åˆä½µï¼Œé€™æœƒä½¿å¾—å¤šå€‹ä»»å‹™åˆä½µæˆä¸€å€‹ä»»å‹™ï¼Œå…¶ä»»å‹™è¦æ±‚æŒ‡å®šçš„ç‹€æ…‹å€¼æœƒæ˜¯å¤šå€‹ä»»å‹™æ‰€æŒ‡å®šçš„ç‹€æ…‹æ‰€åˆä½µçš„æ¨£å­ï¼Œæœ€å¾Œå°±ä»¥é‚£å€‹ä»»å‹™ä¾†è§¸ç™¼updatingçš„ç”Ÿå‘½é€±æœŸ** 

- å¯¦éš›å¯¦ç¾ç‚ºï¼šç•¶ç›®å‰å¯ä»¥åˆä½µçš„æŒ‡ä»¤éƒ½å®Œæˆåˆä½µæ™‚ï¼Œå°±åŸ·è¡Œ
	- ä»¥ç›®å‰çµæœç‹€æ…‹ä¾†è§¸ç™¼å¯¦éš›ç‹€æ…‹æ›´æ–° & æ¸²æŸ“ã€‚



### æ¡ˆä¾‹ 1
å‡å¦‚ç³»çµ±åŸ·è¡Œä»¥ä¸‹setStateï¼Œè€Œç‹€æ…‹æœƒæ˜¯ä»¥ç‰©ä»¶ä¾†è¡¨ç¤º
```
	function updateName() {
	  this.setState({FirstName: 'Morgan'});
	  this.setState({LastName: 'Cheng'});
	}
```

åŸ·è¡Œç¬¬ä¸€å€‹this.setStateæŒ‡ä»¤ä»»å‹™ï¼Œæœƒå…ˆå°‡çµæœç‰©ä»¶è¨­å®šç‚ºç©ºç‰©ä»¶ï¼Œä¸¦å°‡è©²ä»»å‹™è¦æ±‚æ›´æ”¹çš„ç‹€æ…‹å€¼è¿½åŠ è‡³ç©ºç‰©ä»¶ï¼Œåšå®Œå°±åšç¬¬äºŒå€‹
```
// è¿½åŠ å‰
{}
// è¿½åŠ å¾Œ
{ FirstName: 'Morgan' }
```

åŸ·è¡Œç¬¬äºŒå€‹this.setStateæŒ‡ä»¤ä»»å‹™ï¼Œæœƒå…ˆå°‡ä»»å‹™è¦æ±‚æ›´æ”¹çš„ç‹€æ…‹è¿½åŠ /è¦†è“‹è‡³ç©ºç‰©ä»¶ï¼Œåšå®Œå°±çœ‹æœ‰æ²’æœ‰ç¬¬ä¸‰å€‹
```
// è¿½åŠ å‰ 
{ FirstName: 'Morgan' }
// è¿½åŠ å¾Œ
{ FirstName: 'Morgan', LastName: 'Cheng' }
```

åšå®Œç™¼ç¾æ²’äº†ï¼Œå°±ç›´æ¥è®“è² è²¬è™•ç†ä½‡åˆ—çš„éåŒæ­¥ä»»å‹™Xä¾†å°å¤¾å¸¶è‘—ç‰¹å®šç‹€æ…‹å€¼çš„åˆä½µå¾Œä»»å‹™é€²è¡Œç‹€æ…‹æ›´æ–°&æ¸²æŸ“

### æ¡ˆä¾‹ 2

å‡å¦‚ç³»çµ±åŸ·è¡Œä»¥ä¸‹setStateï¼Œè€Œç‹€æ…‹æœƒæ˜¯ä»¥å–®ä¸€å€¼ä¾†è¡¨ç¤º
```
	function updateName() {
	  // count = 1
	  this.setState(count + 1);
	  this.setState(count + 2);
	  this.setState(count + 3);
	}
```


åŸ·è¡Œç¬¬ä¸€å€‹this.setStateæŒ‡ä»¤ä»»å‹™ï¼Œæœƒå…ˆå°‡çµæœç‰©ä»¶è¨­å®šç‚º 1
```
// è¿½åŠ å‰
undefined
// è¿½åŠ å¾Œ
1
```
åŸ·è¡Œç¬¬äºŒå€‹this.setStateæŒ‡ä»¤ä»»å‹™ï¼Œæœƒå…ˆå°‡çµæœç‰©ä»¶è¨­å®šç‚º 2
```
// è¿½åŠ å‰
1
// è¿½åŠ å¾Œ
2
```

åŸ·è¡Œç¬¬ä¸‰å€‹this.setStateæŒ‡ä»¤ä»»å‹™ï¼Œæœƒå…ˆå°‡çµæœç‰©ä»¶è¨­å®šç‚º 3
```
// è¿½åŠ å‰
2
// è¿½åŠ å¾Œ
3
```

åšå®Œç™¼ç¾æ²’äº†ï¼Œå°±ç›´æ¥è² è²¬è™•ç†ä½‡åˆ—çš„éåŒæ­¥ä»»å‹™Xä¾†å°å¤¾å¸¶è‘—ç‰¹å®šç‹€æ…‹å€¼çš„åˆä½µå¾Œä»»å‹™é€²è¡Œç‹€æ…‹æ›´æ–°&æ¸²æŸ“


## è¤‡ç¿’

#ğŸ§  Reactï¼šsetState æ¯ä¸€æ¬¡å‘¼å«æ™‚ï¼Œæ¦‚å¿µæœƒå¦‚ä½•åŸ·è¡Œ ->->-> `æœƒç”Ÿæˆä»¥ä¸‹æŒ‡å®šä»»å‹™å…§å®¹çš„éåŒæ­¥ä»»å‹™ä¸¦æ”¾é€²ä½‡åˆ—ï¼Œå…¶ä½‡åˆ—æœƒçµ¦ç³»çµ±ä¸­çš„éåŒæ­¥ä»»å‹™Xä¾†è² è²¬è™•ç†æ¸²æŸ“ï¼ŒæŒ‡å®šä»»å‹™å…§å®¹ç‚ºæ›´æ–°æŒ‡å®šç‹€æ…‹å€¼ï¼Œç•¶æ²’æœ‰å†åº¦æ¥æ”¶setStateæ™‚ï¼ŒéåŒæ­¥ä»»å‹™Xé–‹å§‹è™•ç†ä½‡åˆ—è£¡çš„éåŒæ­¥ä»»å‹™ï¼Œæœƒå…ˆå°‡ä½‡åˆ—è£¡çš„ä»»å‹™å€‘æ‰€è¦æ±‚çš„ç‹€æ…‹ä¿®æ”¹åˆä½µï¼Œé€™æœƒä½¿å¾—å¤šå€‹ä»»å‹™åˆä½µæˆä¸€å€‹ä»»å‹™ï¼Œå…¶ä»»å‹™è¦æ±‚æŒ‡å®šçš„ç‹€æ…‹å€¼æœƒæ˜¯å¤šå€‹ä»»å‹™æ‰€æŒ‡å®šçš„ç‹€æ…‹æ‰€åˆä½µçš„æ¨£å­ï¼Œæœ€å¾Œå°±ä»¥é‚£å€‹ä»»å‹™ä¾†è§¸ç™¼updatingçš„ç”Ÿå‘½é€±æœŸ`

#ğŸ§  Reactï¼š setState **æ¯ä¸€æ¬¡å‘¼å«æ™‚ï¼Œæœƒç”ŸæˆéåŒæ­¥ä»»å‹™ä¸¦æ”¾é€²ä½‡åˆ—ï¼Œå…¶ä½‡åˆ—æœƒçµ¦ç³»çµ±ä¸­çš„éåŒæ­¥ä»»å‹™Xä¾†è² è²¬è™•ç†æ¸²æŸ“** ï¼Œè‹¥ç‹€æ…‹çš†ç‚ºå–®ä¸€å€¼çš„è©±ï¼Œå…¶å¯¦éš›å¯¦ç¾ç‚ºä½•ï¼Ÿ->->-> `è‹¥ç‹€æ…‹æ˜¯ä»¥å–®ä¸€å€¼ä¾†å„²å­˜çš„è©±ï¼Œå°±ç›´æ¥æ‹¿ç›®å‰ä»»å‹™çš„ç‹€æ…‹å»è¦†è“‹å…ˆå‰ä»»å‹™æ‰€è¨˜éŒ„çš„ç‹€æ…‹`


#ğŸ§  Reactï¼š setState **æ¯ä¸€æ¬¡å‘¼å«æ™‚ï¼Œæœƒç”ŸæˆéåŒæ­¥ä»»å‹™ä¸¦æ”¾é€²ä½‡åˆ—ï¼Œå…¶ä½‡åˆ—æœƒçµ¦ç³»çµ±ä¸­çš„éåŒæ­¥ä»»å‹™Xä¾†è² è²¬è™•ç†æ¸²æŸ“** ï¼Œè‹¥ç‹€æ…‹çš†ç‚ºç‰©ä»¶çš„è©±ï¼Œå…¶å¯¦éš›å¯¦ç¾ç‚ºä½•ï¼Ÿ ->->-> `ä¸€é–‹å§‹æœƒå®šç¾©çµæœç‰©ä»¶ç‚ºç©ºç‰©ä»¶ã€æ‹¿ç›®å‰ä»»å‹™çš„ç‹€æ…‹-ç‰©ä»¶å±¬æ€§å»è¿½åŠ /è¦†è“‹è‡³çµæœç‰©ä»¶ä¸Šç›®å‰çš„å±¬æ€§å€åˆ†`

#ğŸ§  Reactï¼šè«‹å•setState æ¯ä¸€æ¬¡å‘¼å«æ™‚æœƒç«‹åˆ»æ›´æ–°stateå—ï¼Ÿ ç‚ºä½•ï¼Ÿ->->-> `ä¸¦ä¸æœƒï¼Œå…·é«”è¦ç­‰æ‰€æœ‰ç‹€æ…‹æ›´æ–°æŒ‡ä»¤ä»¥batchingå½¢å¼åŸ·è¡Œå®Œç•¢å¾Œä¸¦ä¸”è§¸ç™¼updatingç”Ÿå‘½é€±æœŸå‡½å¼æ‰æœƒåŸ·è¡Œæ›´æ–°`

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

---
Status: #ğŸŒ± 
Tags:
[[React]] - [[JavaScript]]
Links:
[[React batching æ˜¯å°‡Nå€‹ç‹€æ…‹æ›´æ–°æŒ‡ä»¤åˆä½µæˆä¸€å€‹æŒ‡ä»¤ä¸¦åªå¼•ç™¼ä¸€æ¬¡ç•«é¢æ¸²æŸ“]]
References:
[[@gaearonAutomaticBatchingFewer]]
[[@chengmomorganSetStateZheGeAPISheJiDaoDiZenMeYang]]