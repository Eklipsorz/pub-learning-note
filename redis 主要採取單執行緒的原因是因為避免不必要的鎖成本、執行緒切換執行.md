## æè¿°
[[@axinRedisWeiShiMoShiDanZhiXingXuGaoBingFaXiangYingKuaiQiTa]]æ‰€æè¿°
> 1.redisæ˜¯åŸºæ–¼è¨˜æ†¶é«”çš„ï¼Œè¨˜æ†¶é«”çš„è®€å¯«é€Ÿåº¦éå¸¸å¿«(ç´”è¨˜æ†¶é«”); è³‡æ–™å­˜åœ¨è¨˜æ†¶é«”ä¸­ï¼Œè³‡æ–™çµæ§‹ç”¨HashMapï¼ŒHashMapçš„å„ªå‹¢å°±æ˜¯æŸ¥è©¢å’Œæ“ä½œçš„æ™‚é–“è¤‡é›œåº¦éƒ½æ˜¯O(1)ã€‚

> 2.redisæ˜¯å–®åŸ·è¡Œç·’çš„ï¼Œçœå»äº†å¾ˆå¤šä¸Šä¸‹æ–‡åˆ‡æ›åŸ·è¡Œç·’çš„æ™‚é–“(é¿å…åŸ·è¡Œç·’åˆ‡æ›å’Œç«¶æ…‹æ¶ˆè€—)ã€‚


é‡é»ï¼š
- redis æ˜¯ä»¥è¨˜æ†¶é«”ç‚ºä¸»çš„NoSQLï¼Œæ¯ç­†è³‡æ–™æœƒç”¨Key-value pairsä¾†æ§‹æˆï¼Œç‚ºæ­¤æœƒä½¿ç”¨HashMap ä¾†å¯¦ç¾ï¼Œé€²è€Œè®“å­˜å–å°æ‡‰å–®ä¸€pairçš„æ™‚é–“æˆæœ¬ç‚ºO(1)
- redis æ¡ç”¨å–®åŸ·è¡Œç·’ä½œç‚ºä¸»è¦è™•ç†(åŸ·è¡ŒæŒ‡ä»¤ã€redisæœ¬èº«å…§éƒ¨è™•ç†)çš„ä¸»å› æ˜¯ï¼š
	- ä¸å¿…è¦ä¸Šé–æˆæœ¬
	- å¤šåŸ·è¡Œç·’ä¸‹åˆ‡æ›åŸ·è¡Œæˆæœ¬ï¼š[[åŸ·è¡Œç·’åˆ‡æ›(Thread switch) æ˜¯æŒ‡Nå€‹åŸ·è¡Œç·’å¯¦éš›ç„¡æ³•å¾ç’°å¢ƒåŒæ™‚æ‹¿åˆ°Nå€‹å¯¦é«”æ ¸å¿ƒåŸ·è¡Œæ™‚ï¼Œå°±æœƒè¼ªæµç²å–æ ¸å¿ƒä¾†åŸ·è¡Œ]]
	- æ¸›å°‘ race conditionçš„ç™¼ç”Ÿ(è€ƒé‡valueæœƒæœ‰æ›´è¤‡é›œçš„å‹åˆ¥ï¼Œæ¯”å¦‚hashã€set)


### å®˜æ–¹ç­”æ¡ˆ

> ## 2.1.å®˜æ–¹ç­”æ¡ˆ

> å› ç‚ºRedisæ˜¯åŸºæ–¼è¨˜æ†¶é«”çš„æ“ä½œï¼ŒCPUä¸æ˜¯Redisçš„ç“¶é ¸ï¼ŒRedisçš„ç“¶é ¸æœ€æœ‰å¯èƒ½æ˜¯æ©Ÿå™¨è¨˜æ†¶é«”çš„å¤§å°æˆ–è€…ç¶²è·¯é »å¯¬ã€‚æ—¢ç„¶å–®åŸ·è¡Œç·’å®¹æ˜“å¯¦ç¾ï¼Œè€Œä¸”CPUä¸æœƒæˆç‚ºç“¶é ¸ï¼Œé‚£å°±é †ç†æˆç« åœ°æ¡ç”¨å–®åŸ·è¡Œç·’çš„æ–¹æ¡ˆäº†ã€‚

> ## 2.2.æ•ˆèƒ½æŒ‡æ¨™

> é—œæ–¼redisçš„æ•ˆèƒ½ï¼Œå®˜æ–¹ç¶²ç«™ä¹Ÿæœ‰ï¼Œæ™®é€šç­†è¨˜æœ¬è¼•é¬†è™•ç†æ¯ç§’å¹¾åè¬çš„è«‹æ±‚ã€‚

> ## 2.3.è©³ç´°åŸå› 

> 1)ä¸éœ€è¦å„ç¨®é–çš„æ•ˆèƒ½æ¶ˆè€—

> Redisçš„è³‡æ–™çµæ§‹ä¸¦ä¸å…¨æ˜¯ç°¡å–®çš„Key-Valueï¼Œé‚„æœ‰listï¼Œhashç­‰è¤‡é›œçš„çµæ§‹ï¼Œé€™äº›çµæ§‹æœ‰å¯èƒ½æœƒé€²è¡Œå¾ˆç´°ç²’åº¦çš„æ“ä½œï¼Œæ¯”å¦‚åœ¨å¾ˆé•·çš„åˆ—è¡¨å¾Œé¢æ–°å¢ä¸€å€‹å…ƒç´ ï¼Œåœ¨hashç•¶ä¸­æ–°å¢æˆ–è€…åˆªé™¤ä¸€å€‹ç‰©ä»¶ã€‚é€™äº›æ“ä½œå¯èƒ½å°±éœ€è¦åŠ éå¸¸å¤šçš„é–ï¼Œå°è‡´çš„çµæœæ˜¯åŒæ­¥é–‹éŠ·å¤§å¤§å¢åŠ ã€‚

> ç¸½ä¹‹ï¼Œåœ¨å–®åŸ·è¡Œç·’çš„æƒ…æ³ä¸‹ï¼Œå°±ä¸ç”¨å»è€ƒæ…®å„ç¨®é–çš„å•é¡Œï¼Œä¸å­˜åœ¨åŠ é–ã€é‡‹æ”¾é–æ“ä½œï¼Œæ²’æœ‰å› ç‚ºå¯èƒ½å‡ºç¾æ­»é–è€Œå°è‡´çš„æ•ˆèƒ½æ¶ˆè€—ã€‚

> 2)å–®åŸ·è¡Œç·’å¤šç¨‹åºå¢é›†æ–¹æ¡ˆ

> å–®åŸ·è¡Œç·’çš„å¨åŠ›å¯¦éš›ä¸Šéå¸¸å¼·å¤§ï¼Œå–®æ ¸cpuæ•ˆç‡ä¹Ÿéå¸¸é«˜ï¼Œå¤šåŸ·è¡Œç·’è‡ªç„¶æ˜¯å¯ä»¥æ¯”å–®åŸ·è¡Œç·’æœ‰æ›´é«˜çš„æ•ˆèƒ½ä¸Šé™ï¼Œä½†æ˜¯åœ¨ä»Šå¤©çš„è¨ˆç®—ç’°å¢ƒä¸­ï¼Œå³ä½¿æ˜¯å–®æ©Ÿå¤šåŸ·è¡Œç·’çš„ä¸Šé™ä¹Ÿå¾€å¾€ä¸èƒ½æ»¿è¶³éœ€è¦äº†ï¼Œéœ€è¦é€²ä¸€æ­¥æ‘¸ç´¢çš„æ˜¯å¤šä¼ºæœå™¨å¢é›†åŒ–çš„æ–¹æ¡ˆï¼Œé€™äº›æ–¹æ¡ˆä¸­å¤šåŸ·è¡Œç·’çš„æŠ€è¡“ç…§æ¨£æ˜¯ç”¨ä¸ä¸Šçš„ã€‚

> æ‰€ä»¥â€œå–®åŸ·è¡Œç·’ã€å¤šç¨‹åºçš„å¢é›†â€ä¸å¤±ç‚ºä¸€å€‹æ™‚é«¦çš„è§£æ±ºæ–¹æ¡ˆã€‚

> 3)CPUæ¶ˆè€—

> æ¡ç”¨å–®åŸ·è¡Œç·’ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ›å’Œç«¶çˆ­æ¢ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šç¨‹åºæˆ–è€…å¤šåŸ·è¡Œç·’å°è‡´çš„åˆ‡æ›è€Œæ¶ˆè€— CPUã€‚ä½†æ˜¯å¦‚æœCPUæˆç‚ºRedisç“¶é ¸ï¼Œæˆ–è€…ä¸æƒ³è®“ä¼ºæœå™¨å…¶ä»–CUPæ ¸é–’ç½®ï¼Œé‚£æ€éº¼è¾¦ï¼Ÿå¯ä»¥è€ƒæ…®å¤šèµ·å¹¾å€‹Redisç¨‹åºï¼ŒRedisæ˜¯key-valueè³‡æ–™åº«ï¼Œä¸æ˜¯é—œä¿‚è³‡æ–™åº«ï¼Œè³‡æ–™ä¹‹é–“æ²’æœ‰ç´„æŸã€‚åªè¦å®¢æˆ¶ç«¯åˆ†æ¸…å“ªäº›keyæ”¾åœ¨å“ªå€‹Redisç¨‹åºä¸Šå°±å¯ä»¥äº†ã€‚

é‡é»ï¼š
- Redis å®˜æ–¹èªªæ³•çš„ä¸»å› 
	- ä¸å¿…è¦åŸ·è¡Œç·’åˆ‡æ›
	- æ¸›å°‘race conditionã€ä¸Šé–
- ä¸€èˆ¬è€Œè¨€ï¼Œä¸€å€‹æ‡‰ç”¨ç¨‹å¼ç”¢å‡ºçš„å¤šåŸ·è¡Œç·’ vs å–®åŸ·è¡Œç·’
	-	æ“æœ‰æ›´é«˜çš„æ•ˆèƒ½ä¸Šé™ï¼Œä½†å¯¦éš›ä¸Šä»è¦è€ƒé‡å¯¦éš›èƒ½å¤ åŸ·è¡ŒåŸ·è¡Œç·’ä»»å‹™çš„å¯¦é«”æ ¸å¿ƒæ•¸é‡ä»¥åŠæ¡ç”¨ä½•ç¨®æŠ€è¡“(å¦‚æ˜¯å¦æœƒåˆ‡æ›)ï¼Œæ‰€ä»¥å¯¦éš›ç‹€æ³ï¼Œå¤šåŸ·è¡Œç·’ä¸¦ä¸æœƒå¦‚åŒé æœŸèˆ¬å¾—åˆ°å¾ˆå¥½çš„æ•ˆèƒ½
	-	å¾—è€ƒé‡è‘—å¤šåŸ·è¡Œç·’æ˜¯å¦æœƒç™¼ç”Ÿrace conditionè€Œå¾—èŠ±ä¸ŠCPUæˆæœ¬ä¾†è™•ç†ä¸Šé–å’ŒåŒæ­¥æ©Ÿåˆ¶
- ç”±æ–¼Redisæœ¬èº«æ˜¯å–®åŸ·è¡Œç·’ï¼Œè€Œå¯¦é«”æ©Ÿæœ‰å¤šå€‹æ ¸å¿ƒçš„è©±ï¼Œæ‰€ä»¥æœ€å¤šæœƒæœ‰ä¸€å€‹æ ¸å¿ƒä¾†è² è²¬è™•ç†è©²åŸ·è¡Œç·’ï¼Œå‰©ä¸‹é–’ç½®çš„æ ¸å¿ƒè©²å¦‚ä½•æœ‰æ•ˆæ­é…Redis? 
	- å»ºç«‹Nå€‹Redis æ‡‰ç”¨ç¨‹å¼ï¼Œä¾†ç”¢å‡ºNå€‹åŸ·è¡Œç·’ä¾†åŸ·è¡Œï¼Œè³‡æ–™é–“ç”±æ–¼æ²’ç´„æŸï¼Œæ‰€ä»¥åªéœ€è¦æ¨™è¨˜å“ªäº›keyæ˜¯åœ¨å“ªå€‹Redis æ‡‰ç”¨ç¨‹å¼


## Rediså–®åŸ·è¡Œç·’çš„å„ªåŠ£å‹¢

> 3.1.å–®ç¨‹åºå–®åŸ·è¡Œç·’å„ªå‹¢

> 1. ç¨‹å¼ç¢¼æ›´æ¸…æ™°ï¼Œè™•ç†é‚è¼¯æ›´ç°¡å–®ã€‚  
> 2. ä¸ç”¨å»è€ƒæ…®å„ç¨®é–çš„å•é¡Œï¼Œä¸å­˜åœ¨åŠ é–ã€é‡‹æ”¾é–æ“ä½œï¼Œæ²’æœ‰å› ç‚ºå¯èƒ½å‡ºç¾æ­»é–è€Œå°è‡´çš„æ•ˆèƒ½æ¶ˆè€—ã€‚  
> 3. ä¸å­˜åœ¨â€œå¤šç¨‹åºæˆ–è€…å¤šåŸ·è¡Œç·’å°è‡´çš„åˆ‡æ›â€è€Œæ¶ˆè€—CPUã€‚

> ç¼ºé»ï¼š
> 1. ç„¡æ³•ç™¼æ®å¤šæ ¸CPUæ•ˆèƒ½ï¼Œä¸éå¯ä»¥é€šéåœ¨å–®æ©Ÿé–‹å¤šå€‹Redisä¾‹é …ä¾†å®Œå–„ã€‚

é‡é»ï¼š
- å„ªé»1ï¼šé–‹ç™¼çš„ç¨‹å¼ç¢¼æœƒå› ç‚ºå–®åŸ·è¡Œç·’è€Œè®Šå¾—è¼ƒç‚ºç°¡å–®ï¼Œä¸å¿…è€ƒæ…®é–ã€é‡‹æ”¾ã€é–æ­»å•é¡Œ
- å„ªé»2ï¼šRedisä¸ç”¨èŠ±ä¸Šé¡å¤–çš„æˆæœ¬å»è™•ç†é–ã€é–é‡‹æ”¾ã€é–æ­»ã€åŒæ­¥
- å„ªé»3ï¼šRedis ä¸ç”¨å› ç‚ºå¯¦é«”æ©Ÿçš„å¯¦æ ¸å¿ƒæœ‰é™è€Œè®“å¤šåŸ·è¡Œç·’è¼ªç•ªåˆ†é…çµ¦é–’ç½®çš„æ ¸å¿ƒä¾†è™•ç†
- ç¼ºé»1ï¼šå¯èƒ½ç„¡æ³•ç™¼æ®å¤šæ ¸CPUæ•ˆèƒ½ï¼Œä½†å¯ä»¥åœ¨åŒå€‹å¯¦é«”æ©Ÿä¸Šé–‹å¤šå€‹Rediså¯¦ä¾‹

## è¤‡ç¿’
#ğŸ§  redis çš„key-value pairs æ˜¯ç”¨ä½•ç¨®è³‡æ–™çµæ§‹çµ„æˆï¼Ÿç‚ºä»€éº¼(è€ƒæ…®ç‰¹å®šè³‡æ–™çš„æŸ¥è©¢) ->->-> `redis æ˜¯ä»¥è¨˜æ†¶é«”ç‚ºä¸»çš„NoSQLï¼Œæ¯ç­†è³‡æ–™æœƒç”¨Key-value pairsä¾†æ§‹æˆï¼Œç‚ºæ­¤æœƒä½¿ç”¨HashMap ä¾†å¯¦ç¾ï¼Œé€²è€Œè®“å­˜å–å°æ‡‰å–®ä¸€pairçš„æ™‚é–“æˆæœ¬ç‚ºO(1)`

#ğŸ§  redis æ¡ç”¨å–®åŸ·è¡Œç·’ä½œç‚ºä¸»è¦è™•ç†(åŸ·è¡ŒæŒ‡ä»¤ã€redisæœ¬èº«å…§éƒ¨è™•ç†)çš„ä¸»å› æ˜¯ï¼Ÿ->->-> `ä¸å¿…è¦ä¸Šé–æˆæœ¬ã€å¤šåŸ·è¡Œç·’ä¸‹åˆ‡æ›åŸ·è¡Œæˆæœ¬ã€æ¸›å°‘race conditionçš„ç™¼ç”Ÿ(è€ƒé‡valueæœƒæœ‰æ›´è¤‡é›œçš„å‹åˆ¥ï¼Œæ¯”å¦‚hashã€set)`

#ğŸ§  ä¸€èˆ¬è€Œè¨€ï¼Œä¸€å€‹æ‡‰ç”¨ç¨‹å¼ç”¢å‡ºçš„å¤šåŸ·è¡Œç·’ vs å–®åŸ·è¡Œç·’æœƒæœ‰ä»€éº¼æ¨£çš„é æœŸ(æç¤ºï¼šå¤šä¸€äº›å·¥äºº) ->->-> `æ“æœ‰æ›´é«˜çš„æ•ˆèƒ½ä¸Šé™`


#ğŸ§  ä¸€èˆ¬è€Œè¨€ï¼Œä¸€å€‹æ‡‰ç”¨ç¨‹å¼ç”¢å‡ºçš„å¤šåŸ·è¡Œç·’ vs å–®åŸ·è¡Œç·’æœƒæœ‰å¤šåŸ·è¡Œç·’æ“æœ‰æ›´é«˜çš„æ•ˆèƒ½ä¸Šé™ï¼Œä½†å¯¦éš›ä¸Šè€ƒé‡åˆ°å¯¦é«”CPUçš„è©±ï¼Œæœƒæœ‰ä»€éº¼æ¨£çš„å•é¡Œ(æç¤ºï¼šæˆ‘å€‘æœ‰5å€‹åŸ·è¡Œç·’ï¼Œä½†å¯¦é«”æ ¸å¿ƒåªæœ‰2å€‹ï¼Œè©²å¦‚ä½•åšå•Šï¼Ÿ è«‹èªªæ˜æ˜¯å¦è¼ªæµã€è³‡æ–™åŒæ­¥)->->-> `å¯¦éš›ä¸Šä»è¦è€ƒé‡å¯¦éš›èƒ½å¤ åŸ·è¡ŒåŸ·è¡Œç·’ä»»å‹™çš„å¯¦é«”æ ¸å¿ƒæ•¸é‡ä»¥åŠæ¡ç”¨ä½•ç¨®æŠ€è¡“(å¦‚æ˜¯å¦æœƒåˆ‡æ›)ï¼Œæ‰€ä»¥å¯¦éš›ç‹€æ³ï¼Œå¤šåŸ·è¡Œç·’ä¸¦ä¸æœƒå¦‚åŒé æœŸèˆ¬å¾—åˆ°å¾ˆå¥½çš„æ•ˆèƒ½ã€å¾—è€ƒé‡è‘—å¤šåŸ·è¡Œç·’æ˜¯å¦æœƒç™¼ç”Ÿrace conditionè€Œå¾—èŠ±ä¸ŠCPUæˆæœ¬ä¾†è™•ç†ä¸Šé–å’ŒåŒæ­¥æ©Ÿåˆ¶`

#ğŸ§  ç”±æ–¼Redisæœ¬èº«æ˜¯å–®åŸ·è¡Œç·’ï¼Œè€Œå¯¦é«”æ©Ÿæœ‰å¤šå€‹æ ¸å¿ƒçš„è©±ï¼Œæ‰€ä»¥æœ€å¤šæœƒæœ‰ä¸€å€‹æ ¸å¿ƒä¾†è² è²¬è™•ç†è©²åŸ·è¡Œç·’ï¼Œå‰©ä¸‹é–’ç½®çš„æ ¸å¿ƒè©²å¦‚ä½•æœ‰æ•ˆæ­é…Redis? ->->-> `å»ºç«‹Nå€‹Redis æ‡‰ç”¨ç¨‹å¼ï¼Œä¾†ç”¢å‡ºNå€‹åŸ·è¡Œç·’ä¾†åŸ·è¡Œï¼Œè³‡æ–™é–“ç”±æ–¼æ²’ç´„æŸï¼Œæ‰€ä»¥åªéœ€è¦æ¨™è¨˜å“ªäº›keyæ˜¯åœ¨å“ªå€‹Redis æ‡‰ç”¨ç¨‹å¼`

#ğŸ§  Rediså–®åŸ·è¡Œç·’çš„å„ªå‹¢ç‚ºï¼Ÿ (æç¤ºï¼šé–‹ç™¼æˆæœ¬ï¼ŸåŸ·è¡Œæˆæœ¬ï¼Ÿ è³‡æ–™åŒæ­¥ï¼Ÿ) ->->-> `- å„ªé»1ï¼šé–‹ç™¼çš„ç¨‹å¼ç¢¼æœƒå› ç‚ºå–®åŸ·è¡Œç·’è€Œè®Šå¾—è¼ƒç‚ºç°¡å–®ï¼Œä¸å¿…è€ƒæ…®é–ã€é‡‹æ”¾ã€é–æ­»å•é¡Œ - å„ªé»2ï¼šRedisä¸ç”¨èŠ±ä¸Šé¡å¤–çš„æˆæœ¬å»è™•ç†é–ã€é–é‡‹æ”¾ã€é–æ­»ã€åŒæ­¥ - å„ªé»3ï¼šRedis ä¸ç”¨å› ç‚ºå¯¦é«”æ©Ÿçš„å¯¦æ ¸å¿ƒæœ‰é™è€Œè®“å¤šåŸ·è¡Œç·’è¼ªç•ªåˆ†é…çµ¦é–’ç½®çš„æ ¸å¿ƒä¾†è™•ç†`

#ğŸ§  Rediså–®åŸ·è¡Œç·’çš„åŠ£å‹¢ ->->-> `å¯èƒ½ç„¡æ³•ç™¼æ®å¤šæ ¸CPUæ•ˆèƒ½ï¼Œä½†å¯ä»¥åœ¨åŒå€‹å¯¦é«”æ©Ÿä¸Šé–‹å¤šå€‹Rediså¯¦ä¾‹`

---
Status: #ğŸŒ± 
Tags:
[[Operating System]] - [[Database]]
Links:
[[åŸ·è¡Œç·’åˆ‡æ›(Thread switch) æ˜¯æŒ‡Nå€‹åŸ·è¡Œç·’å¯¦éš›ç„¡æ³•å¾ç’°å¢ƒåŒæ™‚æ‹¿åˆ°Nå€‹å¯¦é«”æ ¸å¿ƒåŸ·è¡Œæ™‚ï¼Œå°±æœƒè¼ªæµç²å–æ ¸å¿ƒä¾†åŸ·è¡Œ]]
References:
[[@axinRedisWeiShiMoShiDanZhiXingXuGaoBingFaXiangYingKuaiQiTa]]