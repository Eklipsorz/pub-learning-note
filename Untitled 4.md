## æè¿°

[[@naihuJavaScriptBianYiJIT]]
[[@linclarkCrashCourseJustintime]]

### JIT å¼•å…¥è‡³ JavaScript

> ## JIT

> JavaScript åˆšå‡ºç°çš„æ—¶å€™ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„è§£é‡Šå‹è¯­è¨€ï¼Œå› æ­¤è¿è¡Œé€Ÿåº¦ææ…¢ï¼Œåæ¥æµè§ˆå™¨å¼•å…¥äº† **JIT compiler**ï¼Œå¤§å¹…æé«˜äº† JavaScript çš„è¿è¡Œé€Ÿåº¦ã€‚

> åŸç†ï¼šThey added a new part to the JavaScript engine, called a monitor (aka a profiler). That monitor watches the code as it runs, and **makes a note of how many times it is run and what types are used**.  

> ç®€å•æ¥è¯´ï¼Œæµè§ˆå™¨åœ¨ JavaScript engine ä¸­åŠ å…¥äº†ä¸€ä¸ª monitorï¼Œç”¨æ¥è§‚å¯Ÿè¿è¡Œçš„ä»£ç ã€‚å¹¶è®°å½•ä¸‹æ¯æ®µä»£ç è¿è¡Œçš„æ¬¡æ•°å’Œä»£ç ä¸­çš„å˜é‡çš„ç±»å‹ã€‚

> é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¿™æ ·åšèƒ½æé«˜è¿è¡Œé€Ÿåº¦ï¼Ÿ  
> åé¢çš„æ‰€æœ‰å†…å®¹éƒ½ä»¥ä¸‹é¢è¿™ä¸ªå‡½æ•°çš„è¿è¡Œä¸ºä¾‹

```js
function arraySum(arr) {
  var sum = 0;
  for (var i = 0; i < arr.length; i++) {
    sum += arr[i];
  }
}
```

é‡é»ï¼š
- JavaScript åœ¨JITä¹‹å‰ï¼Œæ˜¯å°‡åŸå§‹ç¢¼ç·¨è­¯æˆä¸­é–“ç¢¼ï¼Œä¸¦å­˜æ–¼è¨˜æ†¶é«”æˆ–è€…ç·©å­˜ï¼Œæ¥è‘—å†é‚Šè½‰ä¸­é–“ç¢¼ç‚ºæ©Ÿæ¢°ç¢¼é‚ŠåŸ·è¡Œ
[[JavaScript æ˜¯ä¸€å€‹å…·æœ‰ç·¨è­¯ã€ç›´è­¯ç‰¹æ€§çš„ç›´è­¯èªè¨€ï¼ŒåŸ·è¡Œå‰æœƒå…ˆç·¨è­¯ä¸­é–“ç¢¼ç„¶å¾Œé‚Šè§£æé‚ŠåŸ·è¡Œ]]
- JIT ä¾†è‡¨æ™‚ï¼ŒJavaScript æœƒä¾æ“šæ¯å€‹ç¨‹å¼ç¢¼çš„åŸ·è¡Œé »ç‡ä¾†é€²ä¸€æ­¥å°‡åŸ·è¡Œé »ç‡è¼ƒé«˜çš„ç¨‹å¼ç¢¼ç·¨è­¯æˆæ›´ç‚ºæ•ˆç‡çš„ç¨‹å¼ç¢¼ï¼Œä¸»è¦æœƒä½¿ç”¨monitorï¼Œå…¶monitoræœƒè² è²¬ï¼š
	- è§€å¯Ÿæ­£åœ¨åŸ·è¡Œçš„ç¨‹å¼ç¢¼ï¼Œä¸¦å°‡ç‚ºæ¯æ®µç¨‹å¼ç¢¼çš„**è¡Œæ•¸**å’Œ**æ‰€ç”¨åˆ°çš„è³‡æ–™é¡å‹**ä½œç‚ºç´¢å¼•ï¼Œä¸¦ä»¥æ­¤è¨ˆç®—ç¨‹å¼ç¢¼çš„åŸ·è¡Œæ¬¡æ•¸
- åŸ·è¡Œæ¬¡æ•¸è¶…éx1ï¼Œå°±æœƒå°‡å°æ‡‰ç´¢å¼•çš„ä»£ç¢¼è¨­å®šç‚ºwarmï¼›å¦‚æœåŸ·è¡Œæ¬¡æ•¸è¶…éx1ä¸”åˆè¶…éx2ï¼Œå°±æœƒå°‡å°æ‡‰ç´¢å¼•çš„ä»£ç¢¼è¨­å®šhotï¼Œä¾†åˆ†åˆ¥ä½¿ç”¨é »ç‡ä½å’Œé«˜ã€‚
- ä¾æ“šmonitoræ‰€å¾—åˆ°çš„æ¬¡æ•¸ï¼Œæœƒå°‡æ¬¡æ•¸é«˜çš„ç¨‹å¼ç¢¼è©¦è‘—å†ä¸‹ä¸€æ¬¡åŸ·è¡Œå‰å„ªåŒ–æˆæ›´ç‚ºæ•ˆç‡çš„æ©Ÿæ¢°ç¢¼ï¼Œå…·é«”æœƒç”±ï¼š
	- Baseline Compilerï¼šä¾æ“šç´¢å¼•å€¼ä¾†çµ¦å®šå°æ‡‰æ¯æ¬¡è§£æå¾—åˆ°çš„æ©Ÿæ¢°ç¢¼ï¼Œä¸‹æ¬¡åŸ·è¡Œæ™‚ç›´æ¥å¾é€™å–å‡ºæ©Ÿæ¢°ç¢¼åŸ·è¡Œï¼Œä¸ç”¨å†è§£æ
	- Optimizing Compilerï¼šä¾æ“šç´¢å¼•å€¼ä¾†çµ¦å®šå°æ‡‰æ¯æ¬¡è§£æå¾—åˆ°çš„æ©Ÿæ¢°ç¢¼ï¼Œä¸‹æ¬¡åŸ·è¡Œæ™‚ç›´æ¥å¾é€™å–å‡ºæ©Ÿæ¢°ç¢¼åŸ·è¡Œï¼Œä¸ç”¨å†è§£æï¼Œä½†é€™è£¡çš„æ©Ÿæ¢°ç¢¼æœƒæ¯”Baseline Compilerä¾†å¾—æœ‰æ•ˆç‡

### Interpreter 

> ## 1st step - Interpreter

> ä¸€å¼€å§‹åªæ˜¯ç®€å•çš„ä½¿ç”¨è§£é‡Šå™¨æ‰§è¡Œï¼Œå½“æŸä¸€è¡Œä»£ç è¢«æ‰§è¡Œäº†å‡ æ¬¡ï¼Œè¿™è¡Œä»£ç ä¼šè¢«æ‰“ä¸Š **Warm** çš„æ ‡ç­¾ï¼›å½“æŸä¸€è¡Œä»£ç è¢«æ‰§è¡Œäº†å¾ˆå¤šæ¬¡ï¼Œè¿™è¡Œä»£ç ä¼šè¢«æ‰“ä¸Š **Hot** çš„æ ‡ç­¾

![](https://pic2.zhimg.com/80/v2-235cefb3de1873276264e6597d3d0819_720w.jpg)


é‡é»ï¼šç•¶JavaScriptè¢«ç·¨è­¯æˆByteCodeæ™‚ï¼Œæ­¤æ™‚æ˜¯å‰›åŸ·è¡Œçš„éšæ®µï¼Œ
- ç”±æ–¼æ¯æ®µç¨‹å¼ç¢¼éƒ½æ˜¯å‰›åŸ·è¡Œï¼Œæ‰€ä»¥ä¸€é–‹å§‹éƒ½æœƒæŒ‰ç…§è§£é‡‹å™¨é‚Šå°‡BytecCode è½‰æ›æˆæ©Ÿæ¢°ç¢¼ é‚ŠåŸ·è¡Œ
- æ¯æ®µç¨‹å¼ç¢¼éƒ½æœƒåœ¨åŸ·è¡Œæ™‚éƒ½æ ¹æ“šè¡Œæ•¸ã€åŸå§‹ç¢¼è³‡æ–™é¡å‹ä¾†ç•¶ç´¢å¼•åœ¨monitoré‚£é‚Šæ›´æ–°å°æ‡‰çš„åŸ·è¡Œæ¬¡æ•¸ï¼š
	- å¦‚æœç´¢å¼•åœ¨monitoræ˜¯ä¸å­˜åœ¨çš„è©±ï¼Œå°±å»ºç«‹ç´¢å¼•ä»¥åŠå°æ‡‰çš„åŸ·è¡Œæ¬¡æ•¸ç‚º1
	- å¦‚æœç´¢å¼•åœ¨monitoræ˜¯å­˜åœ¨çš„è©±ï¼Œå°±ä»¥å°æ‡‰ç´¢å¼•ä¾†å¢åŠ å°æ‡‰åŸ·è¡Œæ¬¡æ•¸ï¼Œå¦‚count = count + 1

![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1658511913/blog/javascript/compile/JIT/first-count-example_mbzuwv.png)

### Baseline Compiler

> ## 2nd step - Baseline compiler

> è¢«æ‰“ä¸Š **Warm** æ ‡ç­¾çš„ä»£ç ä¼šè¢«ä¼ ç»™ **Baseline Compiler** ç¼–è¯‘ä¸”å‚¨å­˜ï¼ŒåŒæ—¶æŒ‰ç…§**è¡Œæ•° (Line number)** å’Œ**å˜é‡ç±»å‹ (Variable type)** è¢«ç´¢å¼•ï¼ˆä¸ºä»€ä¹ˆä¼šå¼•å…¥å˜é‡ç±»å‹åšç´¢å¼•å¾ˆé‡è¦ï¼Œåé¢ä¼šè®²ï¼‰

> å½“å‘ç°æ‰§è¡Œçš„ä»£ç å‘½ä¸­ç´¢å¼•ï¼Œä¼šç›´æ¥å–å‡ºç¼–è¯‘åçš„ä»£ç æ‰§è¡Œï¼Œä»è€Œä¸éœ€è¦é‡å¤ç¼–è¯‘å·²ç»ç¼–è¯‘è¿‡çš„ä»£ç 


![](https://pic1.zhimg.com/80/v2-de48ac228fa2e580ee301097df649dfc_720w.jpg)

é‡é»ï¼šä½¿ç”¨æ¬¡æ•¸è¶…éx1å°±ç‚ºwarmï¼Œä½¿ç”¨æ¬¡æ•¸è¶…éx1ä¸”è¶…éx2å°±ç‚ºhot
- ä½¿ç”¨æ¬¡æ•¸æ¬¡æ•¸è¶…éx1ä½†ä¸¦ä¸è¶…éx2 çš„ ç´¢å¼•æ‰€å°æ‡‰çš„ç¨‹å¼ç¢¼æœƒæ”¾åœ¨Baseline Compiler ä¸¦ç·¨è­¯æˆæ©Ÿæ¢°ç¢¼ï¼Œä¸¦å°‡æ©Ÿæ¢°ç¢¼æ”¾å°æ‡‰ç´¢å¼•çš„æ©Ÿæ¢°ç¢¼æ¬„ä½
- ä¸‹ä¸€æ¬¡åŸ·è¡Œæ™‚ï¼Œè‹¥ç™¼ç¾å‘½ä¸­åŒæ¨£çš„ç´¢å¼•ï¼Œå°±ä»¥è©²å°æ‡‰çš„æ©Ÿæ¢°ç¢¼åŸ·è¡Œï¼Œè€Œä¸éœ€è¦é‡æ–°ç·¨è­¯

![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1658511913/blog/javascript/compile/JIT/baseline-compiler-example_ofixlw.png)


### Optimizing compiler

> ## 3rd step - Optimizing compiler

> è¢«æ‰“ä¸Š **Hot** æ ‡ç­¾çš„ä»£ç ä¼šè¢«ä¼ ç»™ **Optimizing compiler**ï¼Œè¿™é‡Œä¼šå¯¹è¿™éƒ¨åˆ†å¸¦ç åšæ›´ä¼˜åŒ–çš„ç¼–è¯‘ã€‚æ€ä¹ˆæ ·åšæ›´ä¼˜åŒ–çš„ç¼–è¯‘å‘¢ï¼Ÿå…³é”®ç‚¹å°±åœ¨è¿™é‡Œï¼Œæ²¡æœ‰åˆ«çš„åŠæ³•ï¼Œåªèƒ½ç”¨æ¦‚ç‡æ¨¡å‹åšä¸€äº›åˆç†çš„ **â€å‡è®¾ (Assumptions)â€œ**ã€‚

![](https://pic1.zhimg.com/80/v2-ee45b1a7a7c68f1a4ba46c5a376ba18c_720w.jpg)

> æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢çš„å¾ªç¯ä¸­çš„ä»£ç  `sum += arr[i]`ï¼Œå°½ç®¡è¿™é‡Œåªæ˜¯ç®€å•çš„ `+` è¿ç®—å’Œèµ‹å€¼ï¼Œä½†æ˜¯å› ä¸º JavaScript çš„**åŠ¨æ€ç±»å‹ (Dynamic typing)**ï¼Œå¯¹åº”çš„ç¼–è¯‘ç»“æœæœ‰å¾ˆå¤šç§å¯èƒ½ï¼ˆè¿™ä¸ªè§’åº¦èƒ½å¾ˆæ˜æ˜¾çš„æš´éœ²åŠ¨æ€ç±»å‹çš„ç¼ºç‚¹ï¼‰

> æ¯”å¦‚

> -   sum æ˜¯ Intï¼Œarr æ˜¯ Arrayï¼Œi æ˜¯ Intï¼Œè¿™é‡Œçš„ `+` å°±æ˜¯åŠ æ³•è¿ç®—ï¼Œå¯¹åº”å…¶ä¸­ä¸€ç§ç¼–è¯‘ç»“æœ
> -   sum æ˜¯ stringï¼Œarr æ˜¯ Arrayï¼Œi æ˜¯ Intï¼Œè¿™é‡Œçš„ `+` å°±æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¹¶ä¸”éœ€è¦æŠŠ i è½¬æ¢ä¸º string ç±»å‹
> -   ...

> ä¸‹é¢çš„å›¾å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¹ˆç®€å•çš„ä¸€è¡Œä»£ç å¯¹åº”æœ‰ 2^4 = 16 ç§å¯èƒ½çš„ç¼–è¯‘ç»“æœ


![](https://pic1.zhimg.com/80/v2-b59e89cbf144adcc2b938db84a4fc9d8_720w.jpg)

> å‰é¢ç¬¬äºŒæ­¥çš„ Baseline compiler åšçš„å°±æ˜¯è¿™ä»¶äº‹ï¼Œæ‰€ä»¥ä¸Šé¢è¯´ç¼–è¯‘åçš„ä»£ç éœ€è¦ä½¿ç”¨ **line number** å’Œ **variable type** ä¸€èµ·åšç´¢å¼•ï¼Œå› ä¸ºä¸åŒçš„ variable type å¯¹åº”ä¸åŒçš„ç¼–è¯‘ç»“æœã€‚

> å¦‚æœä»£ç æ˜¯ **"Warm"** çš„ï¼ŒJIT çš„ä»»åŠ¡ä¹Ÿå°±åˆ°æ­¤ä¸ºæ­¢ï¼Œåé¢æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œéœ€è¦å…ˆåˆ¤æ–­ç±»å‹ï¼Œå†ä½¿ç”¨å¯¹åº”ç±»å‹çš„ç¼–è¯‘ç»“æœå°±å¥½ã€‚

![](https://pic4.zhimg.com/80/v2-04b4d6fb3b1e55b30f04a208d206e74f_720w.jpg)


> ä½†æ˜¯ä¸Šé¢æˆ‘ä»¬è¯´ï¼Œå½“ä»£ç å˜æˆ **"hot"** çš„æ—¶å€™ï¼Œä¼šåšæ›´å¤šçš„ä¼˜åŒ–ã€‚è¿™é‡Œçš„ä¼˜åŒ–å…¶å®æŒ‡çš„å°±æ˜¯ JIT ç›´æ¥å‡è®¾ä¸€ä¸ªå‰æï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥å‡è®¾ sum æ˜¯ Intï¼Œi ä¹Ÿæ˜¯ Intï¼Œarr æ˜¯ Arrayï¼Œäºæ˜¯å°±åªç”¨ä¸€ç§ç¼–è¯‘ç»“æœå°±å¥½äº†ã€‚


![](https://pic2.zhimg.com/80/v2-37d5258e27e301f78c3c5a3e439e4edd_720w.jpg)


> å®é™…ä¸Šï¼Œåœ¨æ‰§è¡Œå‰ä¼šåšç±»å‹æ£€æŸ¥ï¼Œçœ‹æ˜¯å‡è®¾æ˜¯å¦æˆç«‹ï¼Œå¦‚æœä¸æˆç«‹æ‰§è¡Œå°±ä¼šè¢«æ‰“å› interpreter æˆ–è€… baseline compiler çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªæ“ä½œå«åš "åä¼˜åŒ– (deoptimization)"ã€‚

> å¯ä»¥çœ‹å‡ºï¼Œåªè¦å‡è®¾çš„æˆåŠŸç‡è¶³å¤Ÿé«˜ï¼Œé‚£ä¹ˆä»£ç çš„æ‰§è¡Œé€Ÿåº¦å°±ä¼šå¿«ã€‚ä½†æ˜¯å¦‚æœå‡è®¾çš„æˆåŠŸç‡å¾ˆä½ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æ¯”æ²¡æœ‰ä»»ä½•ä¼˜åŒ–çš„æ—¶å€™è¿˜è¦æ…¢ï¼ˆå› ä¸ºè¦ç»å† optimize => deoptimize çš„è¿‡ç¨‹ï¼‰

![](https://pic3.zhimg.com/80/v2-3d59f5542434ae6d07e4223fb7e32fce_720w.jpg)


é‡é»ï¼šä½¿ç”¨æ¬¡æ•¸è¶…éx1å°±ç‚ºwarmï¼Œä½¿ç”¨æ¬¡æ•¸è¶…éx1ä¸”è¶…éx2å°±ç‚ºhot
- Optimizing compiler æ¡ç”¨çš„æ˜¯ **å‡è¨­ç‰¹å®šè¡Œæ•¸å’Œå¸¸å‡ºç¾çš„å‹åˆ¥ç‚ºä¸»è¦å‰æï¼Œä¸¦ç‚ºç‰¹å®šè¡Œæ•¸å’Œå‹åˆ¥æ‰€å°æ‡‰çš„åŸå§‹ç¢¼ç·¨è­¯å‡ºæ›´æœ‰æ•ˆèƒ½çš„æ©Ÿæ¢°ç¢¼**ï¼Œä¸¦ä¾æ“šå‡è¨­æˆç«‹æ¦‚ç‡ä¾†æ±ºå®šå…¶æ©Ÿæ¢°ç¢¼çš„å»ç•™ï¼Œè‹¥å¤ªä½å°±æœƒå»é™¤ï¼›è‹¥é©ç•¶å°±æœƒä¿ç•™
- ä½¿ç”¨æ¬¡æ•¸è¶…éx2çš„ç´¢å¼•ï¼Œä¸¦å‡è¨­è©²ç´¢å¼•çš„å‹åˆ¥å°æ‡‰å‹åˆ¥ä½œç‚ºæŒ‡å®šè¡Œæ•¸æœƒæ˜¯ä¸€ç›´å‡ºç¾çš„å‹åˆ¥ï¼Œä¸¦ä¸”ä»¥ç´¢å¼•å…§çš„è¡Œæ•¸ä½œç‚º Optimizing compilerçš„ç´¢å¼•ï¼Œè€Œå‰æå°±æ˜¯ç›®å‰ç´¢å¼•å…§çš„å‹åˆ¥ï¼Œæ¥è‘—å°‡å°æ‡‰çš„ByteCodeå’Œç›®å‰åŸ·è¡Œç‹€æ³ä¾†ç·¨è­¯æˆæ›´ç‚ºæœ‰æ•ˆç‡çš„æ©Ÿæ¢°ç¢¼ï¼Œè‡³å°‘æ¯”Baseline Compilerä¾†å¾—æœ‰æ•ˆç‡ï¼Œæœ€å¾Œæ©Ÿæ¢°ç¢¼æœƒæ˜¯ç”±è¡Œæ•¸ä¾†ç•¶ç´¢å¼•ï¼Œå‹åˆ¥æœƒæ˜¯é©—è­‰æ˜¯å¦ç¹¼çºŒä½¿ç”¨çš„æ¨™æº– (line-> type, code)
- ç•¶èƒ½åœ¨Optimizing compilerç´€éŒ„é€éè¡Œæ•¸æ‰¾åˆ°ç´€éŒ„æ™‚ï¼Œä¸¦ç›®å‰ç´¢å¼•ä¸‹çš„å‹åˆ¥èˆ‡æ¶è¨­çš„å‹åˆ¥ä¸€æ¨£çš„è©±ï¼Œå°±ä»¥ç´¢å¼•å°æ‡‰çš„æ©Ÿæ¢°ç¢¼ä¾†åŸ·è¡Œï¼›è‹¥å‹åˆ¥ä¸ä¸€æ¨£çš„è©±ï¼Œå°±ä»¥**baseline compilerèƒ½å¤ æŒ‘åˆ°çš„ç´¢å¼•ç‚ºä¸»ä¾†æŒ‘å°æ‡‰æ©Ÿæ¢°ç¢¼** æˆ–è€… **ç„¡æ³•åœ¨baseline compileræ‰¾åˆ°çš„è©±ï¼Œå‰‡æ¥è‘—å°‡å°æ‡‰bytecodeä¸Ÿé€²é‚Šè½‰æ›machine codeé‚ŠåŸ·è¡Œçš„å…ƒä»¶**ï¼Œä¸¦è¨ˆæ•¸éŒ¯èª¤æ¬¡æ•¸
- ç•¶é•åå‡è¨­è¶…éä¸€å®šæ¬¡æ•¸æ™‚ï¼Œå°±æ¨æ£„ç›®å‰ç´¢å¼•å°æ‡‰çš„æ©Ÿæ¢°ç¢¼
- æ•ˆèƒ½éƒ¨åˆ†ï¼š
	- è‹¥å‡è¨­æˆåŠŸç‡å¾ˆé«˜ï¼Œæ•ˆèƒ½æœƒéå¸¸å¥½
	- è‹¥å‡è¨­å¤±æ•—ç‡å¾ˆä½ï¼Œæ•ˆèƒ½æœƒæ¯”æ²’æœ‰Optimizing compilerä¾†å¾—æ…¢ï¼Œå› çˆ²å¾—ç¶“éå„ªåŒ–ï¼Œç„¶å¾Œå†è½‰ç‚ºåå„ªåŒ–çš„éç¨‹

è¿™é‡Œå°±å¼•ç”³å‡ºä¸¤ä¸ªé—®é¢˜ï¼Œ

1.  å¦‚ä½•åšåˆç†çš„å‡è®¾ï¼Ÿ
2.  å‡è®¾å¤±è´¥ç‡å¾ˆé«˜çš„æ—¶å€™æ€ä¹ˆå¤„ç†ï¼Ÿ

è¿™é‡Œä½œè€…éƒ½æœ‰åšè§£ç­”ï¼Œä½†æ˜¯æˆ‘è§‰å¾—è¿™ä¸æ˜¯é‡ç‚¹æˆ‘å°±ç›´æ¥æŠŠå›ç­” copy è¿‡æ¥å¥½äº†

> Answer 1: The optimizing compiler **uses the information the monitor has gathered by watching code execution to make these judgments**. If something has been true for all previous passes through a loop, it assumes it will continue to be true.  
>   
> Answer 2: Most browsers have **added limits to break out of these optimization/deoptimization cycles** when they happen. If the JIT has made more than, say, 10 attempts at optimizing and keeps having to throw it out, it will just stop trying

#### æª¢æŸ¥ç´€éŒ„çš„å„ªå…ˆæ¬Š
1. è‹¥optimizing compilerä¸Šæœ‰ä»»ä½•ç´€éŒ„çš„è©±ï¼š
	æ¯æ¬¡åŸ·è¡Œæ™‚å°±å»é€éç›®å‰åŸ·è¡Œè¡Œæ•¸ä¾†åœ¨optimizing compilerç´€éŒ„ä¸Šè©¦è‘—æ‰¾åˆ°ç›¸å°æ‡‰çš„ç´€éŒ„ -> è‹¥æ‰¾ä¸åˆ°å°±çœ‹çœ‹ç›®å‰åŸ·è¡Œè¡Œæ•¸å’Œè³‡æ–™å‹åˆ¥æ‰€æ§‹æˆçš„ç´¢å¼•æ˜¯å¦è¢«æ¨™è¨˜warm -> åœ¨æ²’æœ‰å°±å»é‚Šè§£æé‚ŠåŸ·è¡Œ


2. è‹¥optimizing compilerä¸Šæ²’æœ‰ä»»ä½•ç´€éŒ„çš„è©±ï¼š
	æ¯ä¸€æ¬¡å°±é€éç›®å‰è¡Œæ•¸å’Œè³‡æ–™å‹åˆ¥æ‰€æ§‹æˆçš„ç´¢å¼•çœ‹æ˜¯å¦æ¨™è¨˜warm -> åœ¨æ²’æœ‰å°±å»é‚Šè§£æé‚ŠåŸ·è¡Œ

### æ•´é«”æµç¨‹

è‹¥ä½¿ç”¨æ¬¡æ•¸æ²’è¶…éx1å°±ï¼š
bytecode -> interepeter (é‚Šç·¨è­¯é‚ŠåŸ·è¡Œ) -> ç´€éŒ„å°æ‡‰ç´¢å¼•(line, type)çš„åŸ·è¡Œæ¬¡æ•¸

è‹¥ä½¿ç”¨æ¬¡æ•¸è¶…éx1å°±ä¸”æ²’è¶…éx2
- æœªä½¿ç”¨baseline ç”Ÿæˆæ©Ÿæ¢°ç¢¼
bytecode -> ç¶“ébaseline compilerç·¨è­¯æˆæ©Ÿæ¢°ç¢¼ -> æ ¹æ“šç´¢å¼•å°‡æ©Ÿæ¢°ç¢¼ç´€éŒ„è‡³å°æ‡‰ç´€éŒ„ä¸Šçš„æ¬„ä½ -> ä»¥æ©Ÿæ¢°ç¢¼åŸ·è¡Œ  ->  ç´€éŒ„å°æ‡‰ç´¢å¼•(line, type)çš„åŸ·è¡Œæ¬¡æ•¸

- å·²ç”¨baseline ç”Ÿæˆæ©Ÿæ¢°ç¢¼
bytecode ->  é€éç´¢å¼•å¾monitorç´€éŒ„è¡¨æ ¼ä¸­æ‰¾åˆ°å°æ‡‰æ©Ÿæ¢°ç¢¼ -> ä»¥æ©Ÿæ¢°ç¢¼åŸ·è¡Œ ->  ç´€éŒ„å°æ‡‰ç´¢å¼•(line, type)çš„åŸ·è¡Œæ¬¡æ•¸

è‹¥ä½¿ç”¨æ¬¡æ•¸è¶…éx2
- æœªä½¿ç”¨optimizing compilerç”Ÿæˆæ©Ÿæ¢°ç¢¼
bytecode -> ç¶“éoptimizing compilerä¾†æ ¹æ“šç›®å‰åŸ·è¡Œç‹€æ…‹ä¾†ç·¨è­¯æˆæ›´ç‚ºæœ‰æ•ˆåŸ·è¡Œçš„æ©Ÿæ¢°ç¢¼ ->å°‡ç›®å‰ç´¢å¼•ä¸Šçš„è¡Œæ•¸ç´¢å¼•ï¼Œä¸¦ä»¥å‹åˆ¥ä½œç‚ºæ˜¯å¦èƒ½ä½¿ç”¨çš„å‡è¨­æ¨™æº– -> ä»¥è¡Œæ•¸ä½œç‚ºç´¢å¼•ä¾†å„²å­˜å°æ‡‰çš„æ©Ÿæ¢°ç¢¼ï¼š(line -> (type, code)) -> ä»¥optimizing compilerå°æ‡‰çš„æ©Ÿæ¢°ç¢¼ä¾†åŸ·è¡Œ->  ç´€éŒ„å°æ‡‰ç´¢å¼•(line, type)çš„åŸ·è¡Œæ¬¡æ•¸

- å·²ç”¨optimizing compiler ä¸”å‡è¨­æˆç«‹
bytecode -> é€éç›®å‰ç´¢å¼•çš„è¡Œæ•¸è©¦è‘—èƒ½å¤ åœ¨optimizing compilerä¸­æ‰¾åˆ°å°æ‡‰çš„æ©Ÿæ¢°ç¢¼ -> æ¯”è¼ƒç›®å‰ç´¢å¼•çš„å‹åˆ¥æ˜¯å¦èˆ‡å‡è¨­ä¸€æ¨£ -> è‹¥ä¸€æ¨£çš„è©±ï¼Œå°±ä»¥optimizing compilerå°æ‡‰çš„æ©Ÿæ¢°ç¢¼ä¾†åŸ·è¡Œ ->  ç´€éŒ„å°æ‡‰ç´¢å¼•(line, type)çš„åŸ·è¡Œæ¬¡æ•¸

- å·²ç”¨optmizing compiler ä¸”å‡è¨­éŒ¯èª¤
(è‹¥è¡Œæ•¸å’Œå°æ‡‰çš„å‹åˆ¥æ‰€æ§‹æˆçš„ç´¢å¼•èƒ½å¤ åœ¨monitoræ‰¾åˆ°å°æ‡‰ç´€éŒ„ä¸”è¨˜éŒ„ç‚ºhot)
bytecode -> é€éç›®å‰ç´¢å¼•çš„è¡Œæ•¸è©¦è‘—èƒ½å¤ åœ¨optimizing compilerä¸­æ‰¾åˆ°å°æ‡‰çš„æ©Ÿæ¢°ç¢¼ ->  æ¯”è¼ƒç›®å‰ç´¢å¼•çš„å‹åˆ¥æ˜¯å¦èˆ‡å‡è¨­ä¸€æ¨£ -> è‹¥ä¸ä¸€æ¨£çš„è©±ï¼Œå°±ä»¥baseline compilerçš„æ©Ÿæ¢°ç¢¼ç‚ºä¸»-> ç´€éŒ„éŒ¯èª¤æ¬¡æ•¸ -> ç´€éŒ„å°æ‡‰ç´¢å¼•(line, type)çš„åŸ·è¡Œæ¬¡æ•¸

(è‹¥è¡Œæ•¸å’Œå°æ‡‰çš„å‹åˆ¥æ‰€æ§‹æˆçš„ç´¢å¼•æ²’èƒ½åœ¨monitoræ¨™è¨˜warmæˆ–è€…æ²’åœ¨è£¡é ­ç´€éŒ„çš„è©±)
bytecode -> é€éç›®å‰ç´¢å¼•çš„è¡Œæ•¸è©¦è‘—èƒ½å¤ åœ¨optimizing compilerä¸­æ‰¾åˆ°å°æ‡‰çš„æ©Ÿæ¢°ç¢¼ ->  æ¯”è¼ƒç›®å‰ç´¢å¼•çš„å‹åˆ¥æ˜¯å¦èˆ‡å‡è¨­ä¸€æ¨£ -> è‹¥ä¸ä¸€æ¨£çš„è©±ï¼Œå°±ä»¥å°æ‡‰çš„bytecodeä¸Ÿé€²é‚Šå°‡bytecode è½‰æˆmachine codeé‚ŠåŸ·è¡Œçš„å…ƒä»¶ä¾†åŸ·è¡Œ -> ç´€éŒ„éŒ¯èª¤ -> ç´€éŒ„å°æ‡‰ç´¢å¼•(line, type)çš„åŸ·è¡Œæ¬¡æ•¸

- å·²ç”¨optmizing compiler ä¸”éŒ¯èª¤æ¬¡æ•¸é”æ¨™

(è‹¥è¡Œæ•¸å’Œå°æ‡‰çš„å‹åˆ¥æ‰€æ§‹æˆçš„ç´¢å¼•èƒ½å¤ åœ¨monitoræ‰¾åˆ°å°æ‡‰ç´€éŒ„ä¸”è¨˜éŒ„ç‚ºhot)
bytecode -> é€éç›®å‰ç´¢å¼•çš„è¡Œæ•¸è©¦è‘—èƒ½å¤ åœ¨optimizing compilerä¸­æ‰¾åˆ°å°æ‡‰çš„æ©Ÿæ¢°ç¢¼ ->  æ¯”è¼ƒç›®å‰ç´¢å¼•çš„å‹åˆ¥æ˜¯å¦èˆ‡å‡è¨­ä¸€æ¨£ -> è‹¥ä¸ä¸€æ¨£çš„è©±ï¼Œå°±ä»¥baseline compilerçš„æ©Ÿæ¢°ç¢¼ç‚ºä¸»-> ç´€éŒ„éŒ¯èª¤æ¬¡æ•¸ -> åˆªé™¤å°æ‡‰è¡Œæ•¸çš„optimizing compilerä¹‹æ©Ÿæ¢°ç¢¼ç´€éŒ„ -> ç´€éŒ„å°æ‡‰ç´¢å¼•(line, type)çš„åŸ·è¡Œæ¬¡æ•¸


(è‹¥è¡Œæ•¸å’Œå°æ‡‰çš„å‹åˆ¥æ‰€æ§‹æˆçš„ç´¢å¼•æ²’èƒ½åœ¨monitoræ¨™è¨˜warmæˆ–è€…æ²’åœ¨è£¡é ­ç´€éŒ„çš„è©±)
bytecode -> é€éç›®å‰ç´¢å¼•çš„è¡Œæ•¸è©¦è‘—èƒ½å¤ åœ¨optimizing compilerä¸­æ‰¾åˆ°å°æ‡‰çš„æ©Ÿæ¢°ç¢¼ ->  æ¯”è¼ƒç›®å‰ç´¢å¼•çš„å‹åˆ¥æ˜¯å¦èˆ‡å‡è¨­ä¸€æ¨£ -> è‹¥ä¸ä¸€æ¨£çš„è©±ï¼Œå°±ä»¥å°æ‡‰çš„bytecodeä¸Ÿé€²é‚Šå°‡bytecode è½‰æˆmachine codeé‚ŠåŸ·è¡Œçš„å…ƒä»¶ä¾†åŸ·è¡Œ-> ç´€éŒ„éŒ¯èª¤æ¬¡æ•¸ -> åˆªé™¤å°æ‡‰è¡Œæ•¸çš„optimizing compilerä¹‹æ©Ÿæ¢°ç¢¼ç´€éŒ„ -> ç´€éŒ„å°æ‡‰ç´¢å¼•(line, type)çš„åŸ·è¡Œæ¬¡æ•¸


## è¤‡ç¿’
#ğŸ§  JavaScript åœ¨JITä¹‹å‰ï¼Œæ˜¯å¦‚ä½•ç·¨è­¯å’ŒåŸ·è¡Œ(ä¸ç”¨è¬›å¾—å¤ªä»”ç´°)->->-> `JavaScript åœ¨JITä¹‹å‰ï¼Œæ˜¯å°‡åŸå§‹ç¢¼ç·¨è­¯æˆä¸­é–“ç¢¼ï¼Œä¸¦å­˜æ–¼è¨˜æ†¶é«”æˆ–è€…ç·©å­˜ï¼Œæ¥è‘—å†é‚Šè½‰ä¸­é–“ç¢¼ç‚ºæ©Ÿæ¢°ç¢¼é‚ŠåŸ·è¡Œ`



#ğŸ§  JavaScript åŠ å…¥ JITæ™‚ï¼Œä½¿ç”¨å“ªç¨®è¾¦æ³•ä¾†æ‡‰ç”¨ï¼Ÿ->->-> `JavaScript æœƒä¾æ“šæ¯å€‹ç¨‹å¼ç¢¼çš„åŸ·è¡Œé »ç‡ä¾†é€²ä¸€æ­¥å°‡åŸ·è¡Œé »ç‡è¼ƒé«˜çš„ç¨‹å¼ç¢¼ç·¨è­¯æˆæ›´ç‚ºæ•ˆç‡çš„ç¨‹å¼ç¢¼`


#ğŸ§  JavaScript åŠ å…¥ JITæ™‚ï¼Œæœƒä½¿ç”¨ä»€éº¼ä¾†è§€å¯Ÿæ¯å€‹ç¨‹å¼ç¢¼çš„åŸ·è¡Œé »ç‡ï¼Œå…·é«”æ€éº¼è¨ˆç®—ï¼Ÿ->->-> `monitorï¼Œè§€å¯Ÿæ­£åœ¨åŸ·è¡Œçš„ç¨‹å¼ç¢¼ï¼Œä¸¦å°‡ç‚ºæ¯æ®µç¨‹å¼ç¢¼çš„**è¡Œæ•¸**å’Œ**æ‰€ç”¨åˆ°çš„è³‡æ–™é¡å‹**ä½œç‚ºç´¢å¼•ï¼Œä¸¦ä»¥æ­¤è¨ˆç®—ç¨‹å¼ç¢¼çš„åŸ·è¡Œæ¬¡æ•¸`

#ğŸ§  JavaScript çš„ JITï¼šå¦‚ä½•å€åˆ†å“ªäº›ç¨‹å¼ç¢¼çš„åŸ·è¡Œé »ç‡ç‚ºç¨é«˜ã€é«˜ ->->-> `ç•¶ç¨‹å¼ç¢¼çš„åŸ·è¡Œæ¬¡æ•¸é«˜æ–¼x1æ™‚ï¼Œå°±è¨­å®šç‚ºä»£è¡¨ç¨é«˜çš„warmï¼Œè‹¥åŸ·è¡Œæ¬¡æ•¸é«˜æ–¼x1ä¸”é«˜æ–¼x2çš„è©±ï¼Œå°±å°‡å°æ‡‰çš„ç¨‹å¼ç¢¼è¨­ç‚ºä»£è¡¨é«˜çš„hot`

#ğŸ§  JavaScriptçš„JITï¼šç•¶è¢«æ¨™è¨˜ç‚ºwarmçš„ç¨‹å¼ç¢¼ï¼Œæœƒå¦‚ä½•åšå„ªåŒ–ï¼Ÿ èª°è² è²¬å„ªåŒ–->->-> `å°‡å°æ‡‰çš„ByteCodeæ”¾ç½®Baseline Compilerï¼Œç”±å®ƒç·¨è­¯æˆå¹³æ™‚åœ¨interpreterç·¨è­¯çš„æ©Ÿæ¢°ç¢¼ç‰ˆæœ¬ä¸¦æ–¼monitorä¸Šçš„ç´€éŒ„ä¸­æ‰¾åˆ°å°æ‡‰ç´¢å¼•ï¼Œæ¥è‘—å°‡æ©Ÿæ¢°ç¢¼æ”¾ç½®å°æ‡‰ç´¢å¼•çš„ç¨‹å¼ç¢¼æ¬„ä½ï¼Œç•¶ä¸‹ä¸€æ¬¡é‡åˆ°åŒæ¨£ç´¢å¼•çš„ByteCodeï¼Œå°±ç›´æ¥ç´€éŒ„å°æ‡‰çš„æ©Ÿæ¢°ç¢¼å–å‡ºä¸¦åŸ·è¡Œï¼Œä¸ç”¨é‡æ–°ç·¨è­¯å’ŒåŸ·è¡Œ`

#ğŸ§  JavaScriptçš„JITï¼šç•¶è¢«æ¨™è¨˜ç‚ºhotçš„ç¨‹å¼ç¢¼ï¼Œæœƒå¦‚ä½•åšå„ªåŒ–ï¼Ÿ èª°è² è²¬å„ªåŒ– ->->-> `å°‡å°æ‡‰çš„bytecodeæ”¾ç½®optimizing compilerï¼Œç”±å®ƒä»¥ç›®å‰åŸ·è¡Œè¡Œæ•¸ä½œç‚ºç´¢å¼•ï¼Œä¸¦ä»¥ç›®å‰è™•ç†çš„åŸå§‹ç¢¼å‹åˆ¥ä½œç‚ºä½¿ç”¨å„ªåŒ–ç‰ˆæœ¬æ©Ÿæ¢°ç¢¼çš„æ†‘è­‰ï¼Œæ¥è‘—å°‡å°æ‡‰bytecodeä»¥åŠæ ¹æ“šåŸ·è¡Œè³‡è¨Šç·¨è­¯ç‚ºæ›´ç‚ºæœ‰æ•ˆç‡çš„æ©Ÿæ¢°ç¢¼ç‰ˆæœ¬ä¸¦æ”¾ç½®å°æ‡‰ç´¢å¼•çš„æ©Ÿæ¢°ç¢¼ï¼Œå¦‚(line)->(type, code)ï¼Œç•¶ä¸‹ä¸€æ¬¡åŸ·è¡ŒåŒæ¨£è¡Œæ•¸ï¼Œå°±æœƒæª¢æŸ¥å…¶å‹åˆ¥æ˜¯å¦å’Œoptimizing compilerä¸€æ¨£ï¼Œè‹¥ä¸€æ¨£å°±åŸ·è¡Œå°æ‡‰çš„æ©Ÿæ¢°ç¢¼`

#ğŸ§  æ•´é«”ä¾†èªªï¼Œåœ¨JITç‰ˆæœ¬çš„JavaScriptä¸­ï¼Œmonitorå…·é«”æœƒä»¥ä»€éº¼åšç‚ºè³‡æ–™ä¸Šç´€éŒ„çš„ç´¢å¼•->->-> `ç›®å‰ç¨‹å¼ç¢¼çš„è¡Œæ•¸å’Œç›®å‰è¡Œæ•¸åŸå§‹ç¢¼ç¨‹å¼ç¢¼æ‰€æ“æœ‰çš„å‹åˆ¥`

#ğŸ§  æ•´é«”ä¾†èªªï¼Œåœ¨JITç‰ˆæœ¬çš„JavaScriptä¸­ï¼Œmonitorå…·é«”æœƒä»¥ç›®å‰ç¨‹å¼ç¢¼çš„è¡Œæ•¸å’Œç›®å‰è¡Œæ•¸åŸå§‹ç¢¼ç¨‹å¼ç¢¼æ‰€æ“æœ‰çš„å‹åˆ¥åšç‚ºè³‡æ–™ä¸Šç´€éŒ„çš„ç´¢å¼•ï¼Œé‚£éº¼å‹åˆ¥æœƒæ˜¯æŒ‡ä»€éº¼ï¼Ÿ ->->-> `å°æ‡‰åŸå§‹ç¢¼ä¸Šçš„è®Šæ•¸å‹åˆ¥`

#ğŸ§  æ•´é«”ä¾†èªªï¼Œåœ¨JITç‰ˆæœ¬çš„JavaScriptä¸­ï¼Œoptimizing compilerå…·é«”æœƒä»¥ä»€éº¼åšç‚ºè³‡æ–™ä¸Šç´€éŒ„çš„ç´¢å¼•ï¼Ÿ ä»¥ä»€éº¼æ¨™æº–ä½œç‚ºå¯ä½¿ç”¨å°æ‡‰æ©Ÿæ¢°ç¢¼çš„è¨±å¯->->-> `æœƒä»¥è¡Œæ•¸ä½œç‚ºç´¢å¼•ï¼Œä¸¦ä»¥è¨­å®šçš„å‰ææ¨™æº–ä¾†ç•¶ä½œæ¨™æº–ï¼Œå…·é«”æœƒæ˜¯èµ·åˆè©²è¡Œæ•¸è¢«ç·¨è­¯æ™‚çš„(åŸå§‹ç¢¼)è®Šæ•¸è³‡æ–™å‹åˆ¥ç‚ºæ¨™æº–ï¼Œçœ‹æ¯æ¬¡åŒä¸€è¡Œçš„è³‡æ–™å‹åˆ¥æ˜¯å¦å’Œå…ˆå‰ä¸€æ¨£ï¼Œè‹¥ä¸€æ¨£å°±æ ¸å¯ã€‚`

#ğŸ§  JITç‰ˆæœ¬çš„JavaScriptï¼šä»¥ä»€éº¼æ¨™ç±¤ä½œç‚ºæ”¾é€²baseline compiler çš„è™•ç†æ¨™æº– ->->-> `æ“æœ‰warmæ¨™ç±¤çš„ç´¢å¼•`

#ğŸ§  JITç‰ˆæœ¬çš„JavaScriptï¼šä»¥ä»€éº¼æ¨™ç±¤ä½œç‚ºæ”¾é€²optiziming compiler çš„è™•ç†æ¨™æº– ->->-> `æ“æœ‰hotæ¨™ç±¤çš„ç´¢å¼•`

#ğŸ§  JITç‰ˆæœ¬çš„JavaScriptï¼šç•¶JavaScriptè¢«ç·¨è­¯æˆByteCodeæ™‚ï¼Œä¸”æ­¤æ™‚ç‚ºå‰›åŸ·è¡Œçš„éšæ®µï¼Œé‚£éº¼JavaScriptæœƒå¦‚ä½•åŸ·è¡ŒByteCode? ->->-> `ç”±æ–¼æ¯æ®µç¨‹å¼ç¢¼éƒ½æ˜¯å‰›åŸ·è¡Œï¼Œæ‰€ä»¥ä¸€é–‹å§‹éƒ½æœƒæŒ‰ç…§è§£é‡‹å™¨é‚Šå°‡BytecCode è½‰æ›æˆæ©Ÿæ¢°ç¢¼ é‚ŠåŸ·è¡Œï¼Œæ¯æ®µç¨‹å¼ç¢¼éƒ½æœƒåœ¨åŸ·è¡Œæ™‚éƒ½æ ¹æ“šè¡Œæ•¸ã€è³‡æ–™é¡å‹ä¾†ç•¶ç´¢å¼•åœ¨monitoré‚£é‚Šæ›´æ–°å°æ‡‰çš„åŸ·è¡Œæ¬¡æ•¸`

#ğŸ§  JITç‰ˆæœ¬çš„JavaScriptï¼šç•¶JavaScriptè¢«ç·¨è­¯æˆByteCodeä¸¦åŸ·è¡Œæ™‚ï¼Œæœƒå¦‚ä½•monitorè¨ˆæ•¸åŸ·è¡Œæ¬¡æ•¸ï¼Ÿ ->->-> `å¦‚æœç´¢å¼•åœ¨monitoræ˜¯ä¸å­˜åœ¨çš„è©±ï¼Œå°±å»ºç«‹ç´¢å¼•ä»¥åŠå°æ‡‰çš„åŸ·è¡Œæ¬¡æ•¸ç‚º1ã€å¦‚æœç´¢å¼•åœ¨monitoræ˜¯å­˜åœ¨çš„è©±ï¼Œå°±ä»¥å°æ‡‰ç´¢å¼•ä¾†å¢åŠ å°æ‡‰åŸ·è¡Œæ¬¡æ•¸ï¼Œå¦‚count = count + 1`


#ğŸ§  JITç‰ˆæœ¬çš„JavaScriptï¼šè©¦èªªæ˜ä»¥ä¸‹ç´€éŒ„æ˜¯å¦‚ä½•ç”¢ç”Ÿçš„![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1658511913/blog/javascript/compile/JIT/first-count-example_mbzuwv.png)->->-> `scopeæ˜¯æŒ‡è™•æ–¼å“ªä¸€å€‹scopeï¼Œå¦‚ç‰¹å®šfunctionæˆ–è€…globalï¼Œlineæ˜¯æŒ‡scopeä¸‹çš„ç¬¬å¹¾è¡Œï¼Œtypeæ˜¯è©²è¡Œæ•¸çš„ç¨‹å¼ç¢¼æ˜¯ç”¨å“ªäº›å‹åˆ¥ï¼Œcountæ˜¯å°æ‡‰ç¨‹å¼ç¢¼è¢«åŸ·è¡Œäº†å¤šå°‘æ¬¡ï¼Œåœ¨é€™è£æ˜¯åœ¨arraySumå‡½å¼ä¸‹åŸ·è¡Œå®ƒçš„å…§å®¹ä¸¦å¾åŸ·è¡Œéç¨‹ç²å–å‡ºä¾†çš„è³‡æ–™`

#ğŸ§  JITç‰ˆæœ¬çš„JavaScriptï¼šå‡è¨­è¶…éx1ä¸”ä¸è¶…éx2å°±ç‚ºwarmï¼Œé‚£éº¼å‡ä½¿æŸç´¢å¼•çš„ç¨‹å¼ç¢¼çš„åŸ·è¡Œæ¬¡æ•¸å‰›å¥½ç¬¦åˆï¼Œè«‹å•æœƒå¦‚ä½•åŸ·è¡Œå°æ‡‰ç¨‹å¼ç¢¼ï¼Ÿ è‹¥ä¸‹æ¬¡ç›¸åŒç´¢å¼•æœƒå¦‚ä½•åŸ·è¡Œï¼Ÿ ->->-> ` æœƒå°‡å°æ‡‰çš„bytecodeç·¨è­¯æˆæ©Ÿæ¢°ç¢¼ä¸¦è·Ÿç´¢å¼•ä¾†å°‡æ©Ÿæ¢°ç¢¼æ”¾ç½®monitorç´€éŒ„ä¸Šï¼Œæ¥è‘—ç›´æ¥ä»¥è©²æ©Ÿæ¢°ç¢¼åŸ·è¡Œï¼Œæœªä¾†ç¢°ä¸Šç›¸åŒçš„ç´¢å¼•å°±æœƒä»¥monitorèƒ½å¤ å°æ‡‰åˆ°çš„æ©Ÿæ¢°ç¢¼ä¾†åŸ·è¡Œï¼Œä¸ç”¨é‡æ–°ç·¨è­¯ä¸¦ä¸”åŸ·è¡Œ`

#ğŸ§  JITç‰ˆæœ¬çš„JavaScriptï¼šå‡è¨­ç›®å‰optimizing compilerä¸Šæ²’ä»»ä½•ç´€éŒ„ï¼Œä½†monitoræœ‰ç´€éŒ„ä¸”æœ‰warmï¼Œè«‹å•æ¯ä¸€æ¬¡ç¨‹å¼ç¢¼çš„åŸ·è¡Œæœƒå¦‚ä½•é€²è¡Œï¼Ÿï¼ˆè€ƒæ…®ç‚ºwarmå’Œä¸ç‚ºwarmçš„æƒ…æ³ä¸‹) ->->-> `æ¯ä¸€æ¬¡åŸ·è¡Œå°±æœƒä»¥ç›®å‰åŸ·è¡Œè¡Œæ•¸å’Œå‹åˆ¥ä¾†æ§‹æˆç´¢å¼•ä¾†å¾monitoræ‰¾åˆ°å°æ‡‰ç´€éŒ„ï¼Œçœ‹æ˜¯å¦ç‚ºwarmï¼Œè‹¥warmçš„è©±ï¼Œå°±å–å‡ºå°æ‡‰çš„æ©Ÿæ¢°ç¢¼åŸ·è¡Œï¼Œè‹¥ä¸æ˜¯çš„è©±ï¼Œå°±äº¤çµ¦interpreteré‚Šè½‰åŒ–æ©Ÿæ¢°ç¢¼é‚ŠåŸ·è¡Œ`

#ğŸ§  JITç‰ˆæœ¬çš„JavaScriptï¼šè©¦èªªæ˜è¢«æ¨™è¨˜ç‚ºwarmçš„åŸå§‹ç¢¼ç™¼ç”Ÿäº†ä»€éº¼ï¼Ÿ![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1658511913/blog/javascript/compile/JIT/baseline-compiler-example_ofixlw.png)->->-> `åœ¨é€™è£¡ç”±æ–¼arraySumå‡½å¼çš„ç”±(è¡Œæ•¸, å‹åˆ¥)æ‰€æ§‹æˆçš„ç´¢å¼•ä¹‹åŸ·è¡Œæ¬¡æ•¸é”æ¨™ï¼Œæ‰€ä»¥å°±å°‡å°æ‡‰çš„bytecodeæ”¾åˆ°baseline compilerç·¨è­¯æˆæ©Ÿæ¢°ç¢¼ï¼Œç„¶å¾Œæ ¹æ“šç´¢å¼•ä¾†å°‡æ©Ÿæ¢°ç¢¼æ›´æ–°è‡³monitorä¸Šçš„ç´€éŒ„ï¼Œå°±å¦‚åŒæœ€å³é‚Šçš„codeï¼Œä¸‹æ¬¡ç¢°ä¸Šç›¸åŒçš„ç´¢å¼•å°±ä»¥monitorä¸Šçš„ç´€éŒ„ä¾†æ‰¾åˆ°å°æ‡‰çš„æ©Ÿæ¢°ç¢¼åŸ·è¡Œ`

#ğŸ§  JITç‰ˆæœ¬çš„JavaScriptï¼šå‡è¨­è¶…éx2å°±ç‚ºhotï¼Œé‚£éº¼å‡ä½¿æŸç´¢å¼•çš„ç¨‹å¼ç¢¼çš„åŸ·è¡Œæ¬¡æ•¸å‰›å¥½ç¬¦åˆï¼Œè«‹å•æœƒå¦‚ä½•åŸ·è¡Œå°æ‡‰ç¨‹å¼ç¢¼ï¼Ÿ è‹¥ä¸‹æ¬¡ç›¸åŒç´¢å¼•(optimizing compiler)çš„è©±ï¼Œæœƒå¦‚ä½•è™•ç†ï¼Ÿ ->->-> `æœƒä»¥ç›®å‰ç´¢å¼•ä¸‹çš„è¡Œæ•¸ä½œç‚ºoptimizing compilerçš„ç´€éŒ„ç´¢å¼•ï¼Œä¸¦ç”¨ç›®å‰ç´¢å¼•ä¸‹çš„å‹åˆ¥ä½œç‚ºå‰ææˆ–è€…å‡è¨­ï¼Œæ¥è‘—å†å°‡ç´¢å¼•å°æ‡‰çš„bytecodeå’Œç›®å‰åŸ·è¡Œæƒ…æ³ç·¨è­¯æˆæ›´ç‚ºæœ‰æ•ˆç‡çš„æ©Ÿæ¢°ç¢¼ä¸¦ä¾æ“šè¡Œæ•¸ä¾†å°‡æ©Ÿæ¢°ç¢¼æ”¾ç½®optimizing compilerçš„å°æ‡‰ç´€éŒ„ä¸Šï¼Œæœ€å¾Œä»¥æ©Ÿæ¢°ç¢¼åŸ·è¡Œï¼Œä¸‹æ¬¡ç•¶åŸ·è¡Œçš„ç¨‹å¼ç¢¼è¡Œæ•¸æ˜¯èƒ½å¤ åœ¨optimizing compilerç´€éŒ„èƒ½å¤ æ‰¾åˆ°ï¼Œå°±æœƒæ¯”å°å…¶å‹åˆ¥æ˜¯å¦å’Œå‰æä¸€æ¨£ï¼Œè‹¥ä¸€æ¨£å¾optimizing compilerå–å‡ºå°æ‡‰è¡Œæ•¸çš„æ©Ÿæ¢°ç¢¼ä¾†åŸ·è¡Œ`

#ğŸ§  JITç‰ˆæœ¬çš„JavaScriptï¼šå‡è¨­ç›®å‰optimizing compilerä¸Šæœ‰ä»»ä½•ç´€éŒ„ï¼Œè«‹å•æ¯ä¸€æ¬¡ç¨‹å¼ç¢¼çš„åŸ·è¡Œæœƒå¦‚ä½•é€²è¡Œï¼Ÿï¼ˆè€ƒæ…®ç‚ºwarmå’Œä¸ç‚ºwarmçš„æƒ…æ³ä¸‹) ->->-> `æ¯æ¬¡åŸ·è¡Œå°±å»æœƒåˆ©ç”¨ç›®å‰åŸ·è¡Œè¡Œæ•¸ä¾†å»`

---
Status: #ğŸŒ± 
Tags:
[[JavaScript]]
Links:
References:
[[@naihuJavaScriptBianYiJIT]]
[[@linclarkCrashCourseJustintime]]
[[@JSYinQingYiJSZhongDeJITYuJiBenZhiXingLuoJi]]