## æè¿°


### å•é¡ŒèƒŒæ™¯

[[debouncing åœ¨é›»è…¦é–‹ç™¼å¯¦è¸çš„æ‰‹æ®µï¼Œåœ¨é€£çºŒç™¼é€äº‹ä»¶è§¸ç™¼çš„å ´æ™¯ä¸‹ï¼Œä»¥ç¢ºä¿èƒ½å–å¾—æœ€å¾Œçš„äº‹ä»¶è§¸ç™¼è³‡è¨Šçš„å½¢å¼ä¾†é™ä½è«‹æ±‚æ–¹å’Œè™•ç†æ–¹ä¹‹é–“çš„å›æ‡‰é€Ÿåº¦ã€‚]]

> åœ¨é€£çºŒç™¼é€äº‹ä»¶è§¸ç™¼çš„å ´æ™¯ä¸‹ï¼Œè™•ç†æ–¹å’Œè«‹æ±‚æ–¹ä¹‹é–“çš„å›æ‡‰é€Ÿç‡æœƒæ˜¯è«‹æ±‚æ–¹ä¸€ç™¼é€è«‹æ±‚ï¼Œè™•ç†è€…å°±é¦¬ä¸Šè™•ç†è«‹æ±‚ï¼Œç„¶è€Œå¯¦éš›ä¸Šå»æ˜¯æœ€å¾Œçš„äº‹ä»¶è§¸ç™¼æ‰æ˜¯çœŸæ­£éœ€è¦çš„ï¼Œé€™å°è‡´æ‹¿åˆ°æœ€å¾Œçš„äº‹ä»¶è§¸ç™¼è³‡è¨Šä¹‹å‰ï¼Œæ˜¯æœ‰å¤§é‡ä¸å¿…è¦çš„æµªè²»éƒ½åœ¨å‰é¢çš„äº‹ä»¶è§¸ç™¼è™•ç†ä¸Š


#### useEffectæ˜¯å¦æœƒé‡åˆ°bounceå•é¡Œï¼Ÿ
æœƒï¼Œå…·é«”æ˜¯å› ç‚ºuseEffect æ‰€è¨»å†Šçš„effect é¢å°æ¥æ”¶åˆ°çš„è«‹æ±‚éƒ½æ˜¯ä¸€å€‹è«‹æ±‚è¢«æ¥æ”¶åˆ°å°±é¦¬ä¸Šè¢«è™•ç†ï¼Œæ‰€ä»¥æœƒæœ‰æœ‰Nå€‹è«‹æ±‚ï¼Œå°±æœƒæœ‰Nå€‹å›æ‡‰ã€‚


é‚£éº¼è‹¥é‡ä¸Šé€£çºŒç™¼é€äº‹ä»¶è§¸ç™¼çš„å ´æ™¯ä¸‹æ˜¯è¦å–å¾—æœ€å¾Œä¸€å€‹è«‹æ±‚è³‡è¨Šçš„ç›®æ¨™ï¼Œå‹¢å¿…åœ¨å–å¾—æœ€å¾Œä¸€å€‹è«‹æ±‚è³‡è¨Šä¹‹å‰æœƒæœ‰å¤§é‡ä¸å¿…è¦çš„è«‹æ±‚è™•ç†æµªè²»è‘—è³‡æº


### è§£æ±ºç›®æ¨™
ç‚ºäº†èƒ½åœ¨é »ç¹ç™¼é€äº‹ä»¶è§¸ç™¼çš„å ´æ™¯ä¸‹æ˜¯å–å¾—æœ€è¿‘æœ€æ–°å›æ‡‰ ä¸¦ä¸” ç›¡å¯èƒ½æ¸›å°‘åœ¨å–å¾—ä¹‹å‰çš„è«‹æ±‚è™•ç†æˆæœ¬ï¼Œæœƒæ¡ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š
	- æ¯ä¸€æ¬¡äº‹ä»¶è§¸ç™¼çš„è™•ç†æœƒæ˜¯ä»¥
		- æ¸…é™¤ä¸Šä¸€å€‹è™•ç†æ‰€ç”¢ç”Ÿçš„éåŒæ­¥è¨ˆæ™‚ä»»å‹™(timer task)
		- ç”Ÿæˆä¸€å€‹éåŒæ­¥è¨ˆæ™‚ä»»å‹™ (timer task)
	- æ¯ä¸€æ¬¡äº‹ä»¶è§¸ç™¼çš„è™•ç†æœƒæ˜¯ä»¥
		- æ¸…é™¤ä¸Šä¸€å€‹è™•ç†æ‰€ç”¢ç”Ÿçš„éåŒæ­¥ä»»å‹™
		- ç”Ÿæˆä¸€å€‹éåŒæ­¥ä»»å‹™


[[debouncing åœ¨é›»è…¦é–‹ç™¼å¯¦è¸çš„æ‰‹æ®µï¼Œåœ¨é€£çºŒç™¼é€äº‹ä»¶è§¸ç™¼çš„å ´æ™¯ä¸‹ï¼Œä»¥ç¢ºä¿èƒ½å–å¾—æœ€å¾Œçš„äº‹ä»¶è§¸ç™¼è³‡è¨Šçš„å½¢å¼ä¾†é™ä½è«‹æ±‚æ–¹å’Œè™•ç†æ–¹ä¹‹é–“çš„å›æ‡‰é€Ÿåº¦ã€‚]]
#### ä½¿ç”¨setTimeout + cleanup
åœ¨é€™è£¡æ˜¯æ¡å–
	- æ¯ä¸€æ¬¡äº‹ä»¶è§¸ç™¼çš„è™•ç†æœƒæ˜¯ä»¥
		- æ¸…é™¤ä¸Šä¸€å€‹è™•ç†æ‰€ç”¢ç”Ÿçš„éåŒæ­¥è¨ˆæ™‚ä»»å‹™(timer task)
		- ç”Ÿæˆä¸€å€‹éåŒæ­¥è¨ˆæ™‚ä»»å‹™ (timer task)
å¯¦ç¾æ–¹å¼ç‚ºï¼š
- æ¯ä¸€æ¬¡effectè§¸ç™¼å°±æ¸…é™¤ä¸Šä¸€å€‹effectè§¸ç™¼è™•ç†ç”Ÿæˆçš„éåŒæ­¥è¨ˆæ™‚ä»»å‹™(timer task)ï¼šä»¥effect çš„cleanupä¾†å¯¦ç¾ï¼Œå…¶identifieræœƒæ˜¯è¨˜éŒ„ä¸Šä¸€å€‹è™•ç†è€Œç”Ÿæˆçš„è¨ˆæ™‚ä»»å‹™ID
```
return () => {
		clearTimeout(identifier);
}
```
- ç‚ºç•¶å‰effectè§¸ç™¼è™•ç†è€Œç”Ÿæˆä¸€å€‹éåŒæ­¥è¨ˆæ™‚ä»»å‹™ï¼šä»¥setTimeout(callback,500)ä¾†ç”ŸæˆéåŒæ­¥ä»»å‹™ï¼Œä¸¦å›å‚³å…¶ä»»å‹™IDä½œç‚ºcleanupçš„ä¾æ“š
```
    const identifier = setTimeout(() => {
	    // do something
	    setState(....);
    }, 500);
```


æœ€å¾Œæœƒæ˜¯ï¼š

```
 useEffect(() => {
    const identifier = setTimeout(() => {
	    // do something
	    setState(....);
    }, 500);

	return () => {
		clearTimeout(identifier);
	}
	
  }, dependencies);
```


å¦‚æœæˆ‘å€‘æƒ³è¦å»é€éUIçš„äº’å‹•ä¾†é€http è«‹æ±‚ï¼Œè‹¥åŒæ¨£ä»¥æœ€è¿‘çµæœä½œç‚ºæœ€å¾Œçµæœä¾†è™•ç†ï¼Œé‚£éº¼å°±èƒ½ä½¿ç”¨setTimeoutå’Œcleanupä¾†è™•ç†ï¼Œä»¥ç¢ºä¿æœ€å¾Œè«‹æ±‚åªæœƒæ˜¯ä¸€å€‹ä¸”æœƒæ˜¯ä»¥æœ€æ–°æœ€è¿‘çš„çµæœä¾†ç™¼é€



### cleanup function

[[Reactï¼šuseEffect cleanup æŠ€è¡“ä¸»è¦æ˜¯åœæ­¢ç•¶å‰side effectæ‰€ç”¢ç”Ÿçš„éåŒæ­¥ä»»å‹™]]



### clearTimout åŠŸç”¨

[[@mdnClearTimeoutWebAPIs]]
>  The global clearTimeout() method cancels a timeout previously established by calling setTimeout().

> If the parameter provided does not identify a previously established action, this method does nothing. 

```
clearTimeout(timeoutID)
```


é‡é»ï¼š
- clearTimeout å–æ¶ˆé‚„æœªåŸ·è¡Œå®Œæˆçš„setTimeoutä»»å‹™
- clearTimeout(timeoutID) çš„ timeoutID ï¼š
	- timeoutID æ˜¯ timeoutä»»å‹™ID
	- timeoutID å¯ä»¥setTimeouté‚£é‚Šå–å¾—

## è¤‡ç¿’

#ğŸ§  Reactï¼šå¯¦ç¾debouncingçš„æ¦‚å¿µæ˜¯æ¡ç”¨ä»€éº¼ï¼Ÿ ->->-> `æ¯ä¸€æ¬¡äº‹ä»¶è§¸ç™¼çš„è™•ç†æœƒæ˜¯ä»¥ï¼š - æ¸…é™¤ä¸Šä¸€å€‹è™•ç†æ‰€ç”¢ç”Ÿçš„éåŒæ­¥è¨ˆæ™‚ä»»å‹™(timer task) - ç”Ÿæˆä¸€å€‹éåŒæ­¥è¨ˆæ™‚ä»»å‹™ (timer task)ã€‚ æ¯ä¸€æ¬¡äº‹ä»¶è§¸ç™¼çš„è™•ç†æœƒæ˜¯ä»¥ï¼š - æ¸…é™¤ä¸Šä¸€å€‹è™•ç†æ‰€ç”¢ç”Ÿçš„éåŒæ­¥ä»»å‹™ - ç”Ÿæˆä¸€å€‹éåŒæ­¥ä»»å‹™`
`

#ğŸ§   Reactï¼šå¦‚ä½•åœ¨useEffectå¯¦ç¾ä»¥ä¸‹debouncingçš„æ¦‚å¿µï¼šæ¯ä¸€æ¬¡äº‹ä»¶è§¸ç™¼çš„è™•ç†æœƒæ˜¯ä»¥ - æ¸…é™¤ä¸Šä¸€å€‹è™•ç†æ‰€ç”¢ç”Ÿçš„éåŒæ­¥è¨ˆæ™‚ä»»å‹™(timer task) - ç”Ÿæˆä¸€å€‹éåŒæ­¥è¨ˆæ™‚ä»»å‹™ (timer task)->->-> `åœ¨useEffect ä½¿ç”¨setTimemout ä¾†å¤¾é›œside effectåŸæœ¬å¯¦ç¾ä»£ç¢¼ï¼Œç„¶å¾Œç´€éŒ„ç•¶å‰çš„timeoutçš„ä»»å‹™IDï¼Œå®šç¾©è‘—useEffectçš„cleanupä¾†ä¾ç…§timeoueä»»å‹™IDä¾†å–æ¶ˆä»»å‹™ã€‚`

#ğŸ§  Reactï¼šuseEffectæ˜¯å¦æœƒé‡åˆ°bounceå•é¡Œï¼Ÿç‚ºä»€éº¼ ->->-> `æœƒï¼Œå…·é«”æ˜¯å› ç‚ºuseEffect æ‰€è¨»å†Šçš„effect é¢å°æ¥æ”¶åˆ°çš„è«‹æ±‚éƒ½æ˜¯ä¸€å€‹è«‹æ±‚è¢«æ¥æ”¶åˆ°å°±é¦¬ä¸Šè¢«è™•ç†ï¼Œæ‰€ä»¥æœƒæœ‰æœ‰Nå€‹è«‹æ±‚ï¼Œå°±æœƒæœ‰Nå€‹å›æ‡‰ã€‚ é‚£éº¼è‹¥é‡ä¸Šé€£çºŒç™¼é€äº‹ä»¶è§¸ç™¼çš„å ´æ™¯ä¸‹æ˜¯è¦å–å¾—æœ€å¾Œä¸€å€‹è«‹æ±‚è³‡è¨Šçš„ç›®æ¨™ï¼Œå‹¢å¿…åœ¨å–å¾—æœ€å¾Œä¸€å€‹è«‹æ±‚è³‡è¨Šä¹‹å‰æœƒæœ‰å¤§é‡ä¸å¿…è¦çš„è«‹æ±‚è™•ç†æµªè²»è‘—è³‡æº`


#ğŸ§  Reactï¼šå¦‚ä½•åœ¨useEffectçš„debouncing å¯¦ç¾æ˜¯åœ¨useEffect ä½¿ç”¨setTimemout ä¾†å¤¾é›œside effectåŸæœ¬å¯¦ç¾ä»£ç¢¼ï¼Œç„¶å¾Œç´€éŒ„ç•¶å‰çš„timeoutçš„ä»»å‹™IDï¼Œå®šç¾©è‘—useEffectçš„cleanupä¾†ä¾ç…§timeoueä»»å‹™IDä¾†å–æ¶ˆä»»å‹™ï¼Œé‚£éº¼å¯¦éš›å¦‚ä½•åŸ·è¡Œï¼Ÿå¦‚ä½•ç¢ºä¿å°±æ˜¯æœ€å¾Œä¸€å€‹è«‹æ±‚ï¼Ÿ->->-> `é¦–æ¬¡å…ƒä»¶é–‹å§‹mountingå°±ç”ŸæˆsetTimeoutä»»å‹™ï¼Œä¸¦å®šç¾©cleanupä»»å‹™æ˜¯è¦æ¸…é™¤æ‰ç•¶å‰timeoutçš„ä»»å‹™ï¼Œæ¥è‘—è‹¥ä¸‹ä¸€å€‹effectè¢«è§¸ç™¼å°±å…ˆåŸ·è¡Œcleanupä»»å‹™ä¾†æ¸…é™¤ä¸Šä¸€å€‹timeoutéåŒæ­¥ä»»å‹™ï¼Œç„¶å¾Œé‡æ–°ç”Ÿæˆtimeoutä»»å‹™ï¼Œæ¥è‘—å®šç¾©cleanupä¾†æ¸…é™¤é€™æ¬¡ç”Ÿæˆçš„timeoutä»»å‹™ï¼Œå¾Œé¢ä¾æ­¤é¡æ¨ï¼Œç›´åˆ°æ²’è§¸ç™¼ï¼Œä»£è¡¨ç•¶å‰timeoutä»»å‹™æ­£åŸ·è¡Œè‘—æœ€å¾Œä¸€å€‹è«‹æ±‚ã€‚`

#ğŸ§  Reactï¼šåœ¨useEffectçš„debouncing å¯¦ç¾ä¸­ï¼Œæ˜¯å¦‚ä½•å¯¦ç¾æ¯ä¸€æ¬¡effectè§¸ç™¼å°±æ¸…é™¤ä¸Šä¸€å€‹effectè§¸ç™¼è™•ç†ç”Ÿæˆçš„éåŒæ­¥è¨ˆæ™‚ä»»å‹™(timer task) ->->-> `ä»¥effect çš„cleanupä¾†å¯¦ç¾ï¼Œå…¶identifieræœƒæ˜¯è¨˜éŒ„ä¸Šä¸€å€‹è™•ç†è€Œç”Ÿæˆçš„è¨ˆæ™‚ä»»å‹™IDã€‚å®šç¾©effectçš„cleanupä»»å‹™ï¼Œå…§å®¹ç‚ºreturn () => { clearTimeout(identifier); }`

#ğŸ§  Reactï¼šåœ¨useEffectçš„debouncing å¯¦ç¾ä¸­ï¼Œ æ˜¯å¦‚ä½•å¯¦ç¾ç‚ºç•¶å‰effectè§¸ç™¼è™•ç†è€Œç”Ÿæˆä¸€å€‹éåŒæ­¥è¨ˆæ™‚ä»»å‹™->->-> `ä»¥setTimeout(callback,500)ä¾†ç”ŸæˆéåŒæ­¥ä»»å‹™ï¼Œä¸¦å›å‚³å…¶ä»»å‹™IDä½œç‚ºcleanupçš„ä¾æ“š const identifier = setTimeout(() => { // do something setState(....); }, 500);`


#ğŸ§  Reactï¼šè«‹ç”¨setTimeout + cleanup ç¨‹å¼ç¢¼ä¾†å¯¦ç¾effectçš„debouncingæ¦‚å¿µ ->->-> `![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1663348476/blog/react/effect/setTimeout_cleanup_debouncing_vgcmnr.png)`

---
Status: #ğŸŒ± #ğŸ““ 
Tags:
[[React]]
Links:
[[Reactï¼šuseEffect & Dependencies ä¹‹é–“é—œä¿‚å°±åœ¨æ–¼æ¯ä¸€æ¬¡effectè¢«è§¸ç™¼æ™‚æœƒæª¢æŸ¥æ˜¯å¦æœ‰ä»»ä¸€dependencyæœ‰æ”¹è®Šè€ŒåŸ·è¡Œå°æ‡‰çš„callback]]
[[Reactï¼šuseEffect ä½¿ç”¨æ–¹å¼æ˜¯æ›¿ç•¶å‰å…ƒä»¶è¨»å†Šeffecté€™å€‹hookä¸¦æ–¼æ¯å€‹æ¸²æŸ“éšæ®µä¸‹ä¾†åˆ¤å®šæ˜¯å¦èƒ½åŸ·è¡Œå°æ‡‰çš„callback]]
[[Reactï¼šeffect æ˜¯æŒ‡é™¤äº†å…ƒä»¶æœ¬èº«æ‰€è¦åšçš„ä¸»è¦åŠŸèƒ½-æ¸²æŸ“å…ƒä»¶ã€èˆ‡ä½¿ç”¨è€…äº’å‹•ä¾†ç®¡ç†ç‹€æ…‹ä»¥å¤–çš„é¡å¤–æ•ˆæœï¼Œé¡å¤–æ•ˆæœæœƒæ˜¯æŒ‡è„«é›¢æ¸²æŸ“é€±æœŸçš„ä»»æ„åŠŸèƒ½]]
[[Reactï¼šuseEffect cleanup æŠ€è¡“ä¸»è¦æ˜¯åœæ­¢ç•¶å‰side effectæ‰€ç”¢ç”Ÿçš„éåŒæ­¥ä»»å‹™]]
[[debouncing åœ¨é›»è…¦é–‹ç™¼å¯¦è¸çš„æ‰‹æ®µï¼Œåœ¨é€£çºŒç™¼é€äº‹ä»¶è§¸ç™¼çš„å ´æ™¯ä¸‹ï¼Œä»¥ç¢ºä¿èƒ½å–å¾—æœ€å¾Œçš„äº‹ä»¶è§¸ç™¼è³‡è¨Šçš„å½¢å¼ä¾†é™ä½è«‹æ±‚æ–¹å’Œè™•ç†æ–¹ä¹‹é–“çš„å›æ‡‰é€Ÿåº¦ã€‚]]
References:
[[@mdnClearTimeoutWebAPIs]]
[[@pomingleeDrLeeBlog2013]]
[[@geeksforgeeksDebouncingJavaScript2018]]