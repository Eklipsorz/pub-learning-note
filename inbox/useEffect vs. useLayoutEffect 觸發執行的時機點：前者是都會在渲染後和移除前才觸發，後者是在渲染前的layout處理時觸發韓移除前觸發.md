## æè¿°
[[@ithomeDay26ReactJinJie]]
é€™æ˜¯å› ç‚ºæˆ‘å€‘å…ˆå‰èªªéï¼Œ`useEffect`çš„åŸ·è¡Œæ™‚é–“é»æ˜¯é€™æ¨£:
```
1.  å»ºç«‹ã€å‘¼å«function component
2.  çœŸæ­£æ›´æ–°DOM
3.  æ¸²æŸ“ç•«é¢
4.  **å‘¼å«useEffect**
5.  ã€ŒæŸå€‹æ™‚é–“é»ã€ï¼Œåµæ¸¬åˆ°stateã€propsè¢«æ”¹è®Š
6.  é‡æ–°å‘¼å«function component
7.  åœ¨virtual DOMæ¯”è¼ƒæ‰€æœ‰å’ŒåŸå§‹DOMä¸ä¸€æ¨£çš„åœ°æ–¹
8.  çœŸæ­£æ›´æ–°DOM
9.  æ¸²æŸ“ç•«é¢
10.  **å‘¼å«useEffect**
11.  ã€ŒæŸå€‹æ™‚é–“é»ã€ï¼Œå…ƒä»¶è¢«ç§»é™¤
12.  **å‘¼å«useEffect**
```


[[@ithomeDay26ReactJinJie]]
`useLayoutEffect`çš„åŸ·è¡Œæ™‚é–“é»æ˜¯é€™æ¨£:
```
1.  å»ºç«‹ã€å‘¼å«function component
2.  çœŸæ­£æ›´æ–°DOM
3.  **å‘¼å«useLayoutEffect**
4.  æ¸²æŸ“ç•«é¢
5.  ã€ŒæŸå€‹æ™‚é–“é»ã€ï¼Œåµæ¸¬åˆ°stateã€propsè¢«æ”¹è®Š
6.  é‡æ–°å‘¼å«function component
7.  åœ¨virtual DOMæ¯”è¼ƒæ‰€æœ‰å’ŒåŸå§‹DOMä¸ä¸€æ¨£çš„åœ°æ–¹
8.  çœŸæ­£æ›´æ–°DOM
9.  **å‘¼å«useLayoutEffect**
10.  æ¸²æŸ“ç•«é¢
11.  ã€ŒæŸå€‹æ™‚é–“é»ã€ï¼Œå…ƒä»¶è¢«ç§»é™¤
12.  **å‘¼å«useLayoutEffect**
```

> ## åŒæ­¥ã€ç•«é¢æ¸²æŸ“å‰åŸ·è¡Œçš„useLayoutEffect

> é›–ç„¶é€™ç¨®éœ€æ±‚å¾ˆå°‘ï¼Œä½†Reactæä¾›äº†ä¸€å€‹è§£æ±ºä¸Šè¿°å•é¡Œçš„hook-`useLayoutEffect`ã€‚å®ƒå’Œ`useEffect`çš„èªæ³•ã€ä½¿ç”¨ä¸Šä¸€æ¨¡ä¸€æ¨£ã€‚å”¯ä¸€çš„å·®åˆ¥æ˜¯`useLayoutEffect`è¢«æå‡åˆ°äº†æ¸²æŸ“ç•«é¢å‰ã€æ›´æ–°DOMå¾ŒåŸ·è¡Œã€‚

é‡é»ï¼š
- useEffect åœ¨class-based componentä¸­å°æ‡‰è§¸ç™¼åŸ·è¡Œçš„æ™‚æ©Ÿé»ç‚ºï¼š
	- mounting éšæ®µä¸‹çš„componentDidMount
	- updating éšæ®µä¸‹çš„componentDidUpdate
	- unmounting éšæ®µä¸‹çš„componentWillUnmount

- useLayoutEffect åœ¨class-based componentä¸­ï¼Œæœ¬èº«æ˜¯è² è²¬å®šç¾©åœ¨å¯¦éš›DOMç¯€é»é€²è¡Œæ¸²æŸ“éç¨‹ä¸­çš„Layoutéšæ®µæ‰€è§¸ç™¼çš„è™•ç†ï¼Œæ‰€ä»¥éƒ½æœƒåœ¨éƒ½æœƒåœ¨æ¸²æŸ“ç•«é¢å‰è§¸ç™¼ï¼š
	- mounting éšæ®µä¸‹çš„React Update DOM & refs(åœ¨å¯¦éš›DOMç¯€é»é€²è¡Œæ¸²æŸ“éç¨‹ä¸­çš„Layoutéšæ®µ)
	- updating éšæ®µä¸‹çš„React Update DOM & refs(åœ¨å¯¦éš›DOMç¯€é»é€²è¡Œæ¸²æŸ“éç¨‹ä¸­çš„Layoutéšæ®µ)
	- unmount éšæ®µä¸‹çš„componentWillUnmount


### ç”¢å‡ºVirtaul DOM çš„ render è‡³ä»¥Real DOMæ¸²æŸ“ç•«é¢çš„æµç¨‹ï¼š

1. å‘¼å«function component 
2. åœ¨virtual DOMæ¯”è¼ƒæ‰€æœ‰å’ŒåŸå§‹DOMä¸ä¸€æ¨£çš„åœ°æ–¹
3. çœŸæ­£æ›´æ–°DOM 
4. ç€è¦½å™¨æ ¹æ“šæœ€æ–°çš„DOMå…§å®¹è€Œæ¸²æŸ“ç•«é¢ (layoutã€paint)

#### layout æœƒæ˜¯ä»€éº¼

åˆ©ç”¨ç¾åœ¨çš„æ¨¹ç‹€çµæ§‹ä¾†è¨ˆç®—ç¶²é å…ƒä»¶å¯¦éš›æœƒåœ¨é é¢ä¸Šæ“ºæ”¾çš„ä½ç½®ã€å¤§å°ä»¥åŠå¦‚ä½•æ“ºæ”¾

#### paint
ç¹ªè£½éç¨‹æœƒé–‹å§‹ä¾æ“šæ¸²æŸ“æ¨¹æŒ‡å®šçš„æ¨£å¼ä¾†å°é é¢ä¸Šçš„pixelä¾†å‘ˆç¾æ¯å€‹å…ƒä»¶çš„çœŸå¯¦é¢è²Œ


### ä»¥functional componentçš„ç”¢å‡ºVirtaul DOM çš„ render è‡³ä»¥Real DOMæ¸²æŸ“ç•«é¢çš„æµç¨‹ä¾†èªª

[[@ithomeDay21UseEffect]]
> åœ¨é è¨­çš„æƒ…æ³ä¸‹ï¼Œ**effects å…¶å¯¦æœƒåœ¨æ¯æ¬¡ render å¾Œéƒ½è¢«åŸ·è¡Œ**

> åœ¨ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œ `useEffect` æœƒåœ¨æ¯æ¬¡ component render ä¸”ç€è¦½å™¨å®Œæˆ DOM çš„æ›´æ–° & ç¹ªè£½ç•«é¢**ä¹‹å¾Œ**æ‰åŸ·è¡Œï¼Œä»¥é¿å…é˜»å¡ component render çš„éç¨‹ & ç€è¦½å™¨ç¹ªè£½ç•«é¢çš„éç¨‹

ç†è«–ä¸ŠuseEffect ç”¢ç”Ÿå‡ºçš„side effect æ˜¯åœ¨ç”¢ç”Ÿå‡ºVirtual DOMçš„renderä¹‹å¾Œæ‰åŸ·è¡Œï¼Œä½†æ²’æœ‰æ˜ç¢ºèªªä¹‹å¾Œæ˜¯å¤šä¹…çš„äº‹æƒ…ï¼Œå…·é«”æœƒæ˜¯åœ¨
- ç€è¦½å™¨æ ¹æ“šDOMæ›´æ–°å…§å®¹è€Œæ¸²æŸ“ç•«é¢ (layoutã€paint)ä¹‹å¾Œæ‰åŸ·è¡Œ

è€ŒuseLayoutEffect å…·é«”å‰‡æ˜¯æœƒåœ¨
- ç€è¦½å™¨æ ¹æ“šDOMæ›´æ–°å…§å®¹è€Œæ¸²æŸ“ç•«é¢ (layoutã€paint)ä¸­çš„layoutéšæ®µæ‰åŸ·è¡Œ

#### useEffect vs. useLayoutEffect æ™‚æ©Ÿé»çš„å·®ç•°
1. useEffect åœ¨ç€è¦½å™¨å®Œæˆç•«é¢æ¸²æŸ“æ‰åŸ·è¡Œ
2. useLayoutEffect åœ¨ç€è¦½å™¨å®Œæˆç•«é¢æ¸²æŸ“å‰çš„layoutéšæ®µæ‰åŸ·è¡Œ


## è¤‡ç¿’


#ğŸ§  Reactä¸‹çš„ç”¢å‡ºVirtaul DOM çš„ render è‡³ä»¥Real DOMæ¸²æŸ“ç•«é¢çš„æµç¨‹ æœƒæ˜¯ä»€éº¼ï¼Ÿ->->-> `åŸ·è¡Œå°æ‡‰å…ƒä»¶render functionã€æ¯”å°virtual domä¹‹é–“å·®ç•°ã€ä»¥å·®ç•°ä¾†è½‰æ›æˆreal domä¸¦æ›´æ–°ç¾åœ¨çš„real dom treeã€ç€è¦½å™¨æ ¹æ“šæœ€æ–°çš„DOMå…§å®¹è€Œæ¸²æŸ“ç•«é¢ (layoutã€paint)`
<!--SR:!2023-03-28,86,248-->

#ğŸ§  Reactä¸‹çš„ç”¢å‡ºVirtaul DOM çš„ render è‡³ä»¥Real DOMæ¸²æŸ“ç•«é¢çš„æµç¨‹ æœƒæ˜¯åŸ·è¡Œå°æ‡‰å…ƒä»¶render functionã€æ¯”å°virtual domä¹‹é–“å·®ç•°ã€ä»¥å·®ç•°ä¾†è½‰æ›æˆreal domä¸¦æ›´æ–°ç¾åœ¨çš„real dom treeã€ç€è¦½å™¨æ ¹æ“šæœ€æ–°çš„DOMå…§å®¹è€Œæ¸²æŸ“ç•«é¢ (layoutã€paint)ï¼Œå…¶ä¸­layoutã€paintæœƒæ˜¯ä»€éº¼ï¼Ÿ ->->-> `åˆ©ç”¨ç¾åœ¨çš„æ¨¹ç‹€çµæ§‹ä¾†è¨ˆç®—ç¶²é å…ƒä»¶å¯¦éš›æœƒåœ¨é é¢ä¸Šæ“ºæ”¾çš„ä½ç½®ã€å¤§å°ä»¥åŠå¦‚ä½•æ“ºæ”¾ã€ç¹ªè£½éç¨‹æœƒé–‹å§‹ä¾æ“šæ¸²æŸ“æ¨¹æŒ‡å®šçš„æ¨£å¼ä¾†å°é é¢ä¸Šçš„pixelä¾†å‘ˆç¾æ¯å€‹å…ƒä»¶çš„çœŸå¯¦é¢è²Œ`
<!--SR:!2023-03-27,80,230-->


#ğŸ§  Reactä¸‹çš„ç”¢å‡ºVirtaul DOM çš„ render è‡³ä»¥Real DOMæ¸²æŸ“ç•«é¢çš„æµç¨‹ æœƒæ˜¯åŸ·è¡Œå°æ‡‰å…ƒä»¶render functionã€æ¯”å°virtual domä¹‹é–“å·®ç•°ã€ä»¥å·®ç•°ä¾†è½‰æ›æˆreal domä¸¦æ›´æ–°ç¾åœ¨çš„real dom treeã€ç€è¦½å™¨æ ¹æ“šæœ€æ–°çš„DOMå…§å®¹è€Œæ¸²æŸ“ç•«é¢ï¼Œå…¶ä¸­çš„æ ¹æ“šæœ€æ–°DOMå…§å®¹è€Œæ¸²æŸ“ç•«é¢æœƒåŒ…å«ä»€éº¼å‹•ä½œ ->->-> `layoutã€paint`
<!--SR:!2023-04-12,95,248-->

#ğŸ§  Reactï¼šuseEffectç”¢ç”Ÿå‡ºçš„side effectè¢«å®šèª¿ç‚ºrenderä¹‹å¾Œæ‰åŸ·è¡Œï¼Œè«‹å•renderæœƒæ˜¯ä»€éº¼ï¼Ÿ->->-> `ç”¢ç”Ÿå‡ºå°æ‡‰å…ƒä»¶çš„virtual domä¹‹render function`
<!--SR:!2023-09-15,190,248-->


#ğŸ§  Reactï¼šç†è«–ä¸ŠuseEffect ç”¢ç”Ÿå‡ºçš„side effect æ˜¯åœ¨ç”¢ç”Ÿå‡ºVirtual DOMçš„renderä¹‹å¾Œæ‰åŸ·è¡Œï¼Œä½†æ²’æœ‰æ˜ç¢ºèªªä¹‹å¾Œæ˜¯å¤šä¹…çš„äº‹æƒ…ï¼Œå…·é«”æœƒæ˜¯åœ¨ä»€éº¼æ™‚å€™åŸ·è¡Œï¼Ÿ ->->-> `ç€è¦½å™¨æ ¹æ“šæœ€æ–°çš„DOMå…§å®¹è€Œæ¸²æŸ“ç•«é¢ (layoutã€paint)ä¹‹å¾ŒåŸ·è¡Œ`
<!--SR:!2023-03-29,87,248-->

#ğŸ§  Reactï¼šuseLayoutEffect å…·é«”å‰‡æ˜¯æœƒåœ¨ä»€éº¼æ™‚å€™åŸ·è¡Œ->->-> `ç€è¦½å™¨æ ¹æ“šæœ€æ–°DOMå…§å®¹è€Œæ¸²æŸ“ç•«é¢ (layoutã€paint)ä¸­çš„layoutéšæ®µæ‰åŸ·è¡Œ`
<!--SR:!2023-03-26,82,247-->
<!--SR:!2022-11-22,10,250-->

#ğŸ§  Reactï¼šuseLayoutEffect å…·é«”å‰‡æ˜¯æœƒåœ¨ä»€éº¼æ™‚å€™åŸ·è¡Œ->->-> `ç€è¦½å™¨æ ¹æ“šæœ€æ–°DOMå…§å®¹è€Œæ¸²æŸ“ç•«é¢ (layoutã€paint)ä¸­çš„layoutéšæ®µæ‰åŸ·è¡Œ`
<!--SR:!2023-03-26,82,247-->


#ğŸ§  Reactï¼šuseEffect vs. useLayoutEffect ä¹‹é–“çš„æ™‚æ©Ÿé»å·®ç•°æ˜¯ä»€éº¼->->-> `1. useEffect åœ¨ç€è¦½å™¨å®Œæˆç•«é¢æ¸²æŸ“æ‰åŸ·è¡Œ 2. useLayoutEffect åœ¨ç€è¦½å™¨å®Œæˆç•«é¢æ¸²æŸ“å‰çš„layoutéšæ®µæ‰åŸ·è¡Œ`
<!--SR:!2023-07-20,155,250-->

#ğŸ§  useEffect åœ¨class-based componentä¸­è§¸ç™¼åŸ·è¡Œçš„æ™‚æ©Ÿé»ç‚º ->->-> `	- mounting éšæ®µä¸‹çš„componentDidMount - updating éšæ®µä¸‹çš„componentDidUpdate - unmounting éšæ®µä¸‹çš„componentWillUnmount`
<!--SR:!2023-10-09,204,248-->


#ğŸ§  useLayoutEffect åœ¨class-based componentä¸­è§¸ç™¼åŸ·è¡Œçš„æ™‚æ©Ÿé»ç‚ºï¼Ÿ ->->-> `åœ¨å¯¦éš›DOMç¯€é»é€²è¡Œæ¸²æŸ“éç¨‹ä¸­çš„Layoutéšæ®µ`
<!--SR:!2023-07-30,163,250-->


#ğŸ§  useLayoutEffect åœ¨class-based componentä¸­è§¸ç™¼åŸ·è¡Œçš„æ™‚æ©Ÿé»æ˜¯åœ¨å¯¦éš›DOMç¯€é»é€²è¡Œæ¸²æŸ“éç¨‹ä¸­çš„Layoutéšæ®µï¼Œå…·é«”æ˜¯ä»€éº¼ï¼Ÿä»¥ç”Ÿå‘½é€±æœŸä¾†èªª ->->-> `	- mounting éšæ®µä¸‹çš„React Update DOM & refs(åœ¨å¯¦éš›DOMç¯€é»é€²è¡Œæ¸²æŸ“éç¨‹ä¸­çš„Layoutéšæ®µ) - updating éšæ®µä¸‹çš„React Update DOM & refs(åœ¨å¯¦éš›DOMç¯€é»é€²è¡Œæ¸²æŸ“éç¨‹ä¸­çš„Layoutéšæ®µ) - unmount éšæ®µä¸‹çš„componentWillUnmount`
<!--SR:!2023-04-03,83,230-->





---
Status: #ğŸŒ± 
Tags:
[[React]] - [[useEffect]]
Links:
[[side effect æ˜¯æŒ‡èª¿ç”¨è€…åŸ·è¡Œç‰¹å®šæ“ä½œæˆ–è¡¨é”å¼æˆ–å‡½å¼è€Œå¾—åˆ°é™¤äº†å›å‚³å€¼çµ¦èª¿ç”¨è€…é€™å€‹ä¸»è¦æ•ˆæœä»¥å¤–çš„é¡å¤–æ•ˆæœï¼Œside effect é€šå¸¸æœƒæ˜¯å½±éŸ¿ä¸»èª¿ç”¨è€…æ‰€ä½¿ç”¨çš„å…±äº«è³‡æºä¹‹æ•ˆæœ]]
[[Reactï¼šEffect ç­‰åŒæ–¼ Side Effectï¼Œeffect æœ¬èº«æ˜¯æŒ‡åŸ·è¡Œä¸»è¦è™•ç†(çµæœ)æ‰€å¸¶ä¾†çš„ä»»æ„é¡å¤–è™•ç†(çµæœ)ï¼Œä¸»è¦è™•ç†(çµæœ)æœƒæ˜¯æŒ‡å…ƒä»¶æ¸²æŸ“(render)ä»»å‹™ã€‚ä»»æ„é¡å¤–è™•ç†(çµæœ)æŒ‡useEffectæ‰€å®šç¾©çš„åŸ·è¡Œè™•ç†]]
References:
[[@ithomeDay26ReactJinJie]]
[[@ithomeDay21UseEffect]]