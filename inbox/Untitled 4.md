## æè¿°


> ES6 çš„ç®­é ­å‡½æ•¸æ˜¯å¦é¡çš„å­˜åœ¨ï¼Œçˆ²ä»€éº¼è¦å–®ç¨èªªå‘¢ï¼Œé€™æ˜¯å› çˆ²ç®­é ­å‡½æ•¸ä¸­çš„ this ä¸é©ç”¨ä¸Šé¢ä»‹ç´¹çš„å››ç¨®ç¶å®šè¦å‰‡ã€‚

> æº–ç¢ºä¾†èªªï¼Œç®­é ­å‡½æ•¸ä¸­æ²’æœ‰ thisï¼Œç®­é ­å‡½æ•¸çš„ this æŒ‡å‘å–æ±ºæ–¼å¤–å±¤ä½œç”¨åŸŸä¸­çš„ thisï¼Œå¤–å±¤ä½œç”¨åŸŸæˆ–å‡½æ•¸çš„ this æŒ‡å‘èª°ï¼Œç®­é ­å‡½æ•¸ä¸­çš„ this ä¾¿æŒ‡å‘èª°ã€‚

> æœ‰é»å–«è»Ÿé£¯çš„å«Œç–‘ï¼Œä¸€é»éƒ½ä¸ç¡¬æœ—ï¼Œæˆ‘å€‘ä¾†çœ‹å€‹ä¾‹å­ï¼š
```
function fn() {
    return () => {
        console.log(this.name);
    };
}
let obj1 = {
    name: 'è½é¢¨æ˜¯é¢¨'
};
let obj2 = {
    name: 'æ™‚é–“è·³èº'
};
let bar = fn.call(obj1); // fn thisæŒ‡å‘obj1
bar.call(obj2); //è½é¢¨æ˜¯é¢¨
```

> ç®­é ­å‡½å¼çš„this binding å–è‡ªåŒ…å«å®ƒçš„ç¯„ç–‡(enclosing scopeï¼Œå‡½å¼æˆ–è€…å…¨åŸŸ)
> è®“æˆ‘å€‘ä»¥ç¯„ä¾‹èªªæ˜ç®­é ­å‡½å¼çš„èªå½™ç¯„ç–‡(lexical scope)

```
function foo() {
	// å›å‚³ä¸€å€‹ç®­é ­å‡½å¼
	retrun (a) => {
		// åœ¨æ­¤ï¼Œthisæ˜¯å¾èªå½™ä¸Šç¹¼æ‰¿è‡ªfoo
		console.log(this.a)
	}
}

var obj1 = {
	a: 2
}

var obj1 = {
	a: 3
}

var bar = foo.call(obj1)
bar.call(obj2) // 2
```

> åœ¨foo()ä¸­å»ºç«‹çš„ç®­é ­å‡½å¼è¢«å‘¼å«æ™‚æœƒå¾èªå½™ä¸Š(lexically) æ•æ‰ foo() çš„this (ä¸ç®¡é‚£æ˜¯ä»€éº¼)ï¼Œæ—¢ç„¶foo()çš„this ç¶å®šåˆ°obj1ï¼Œbar(å°æ‰€å›å‚³çš„ç®­é ­å‡½å¼çš„ä¸€å€‹åƒè€ƒ)çš„thisä¹Ÿæœƒç¶å®šåˆ°obj1ã€‚ç®­é ­å‡½å¼çš„é€™ç¨®èªå½™ç¶å®š(lexical binding)ç„¡æ³•è¢«è¦†å¯«(å³ä¾¿ä½¿ç”¨newä¹Ÿä¸€æ¨£)ã€‚

> æœ€å¸¸è¦‹çš„ä½¿ç”¨æƒ…æ³ä¸‹å¾ˆå¯èƒ½æ˜¯ç”¨æ–¼callbackï¼Œæ¯”å¦‚äº‹ä»¶è™•ç†å™¨(event handlers) æˆ–è€… è¨ˆæ™‚å™¨(timers)ï¼š

```
function foo() {
	setTimeout(()=>{
		// é€™è£¡thisåœ¨èªå½™ä¸Šç¹¼æ‰¿è‡ªfoo
		console.log(this.a)
	}, 100)
}


var obj = {
	a: 2
}

foo.call(obj) // 2
```

> é›–ç„¶ç®­é ­å‡½å¼æä¾›ä¸€ç¨®æ›¿ä»£æ–¹å¼ï¼Œè®“æˆ‘å€‘ä¸å¿…åœ¨ä¸€å€‹å‡½å¼ä¸Šä½¿ç”¨bind(...)ä¾†ç¢ºä¿thiså€¼ï¼Œé€™çœ‹èµ·ä¾†å¾ˆå¸å¼•äººï¼Œä½†è¦æ³¨æ„çš„é‡é»æ˜¯ï¼Œä»–å€‘åŸºæœ¬ä¸Šä½¿å¾—å‚³çµ±çš„thisæ©Ÿåˆ¶å¤±æ•ˆäº†ï¼Œè€Œæ”¹ç”¨è¼ƒå»£æ³›è¢«ç†è§£çš„èªå½™ç¯„ç–‡(lexical scoping)ã€‚åœ¨ES6 ä¹‹å‰ï¼Œæˆ‘å€‘å·²ç¶“æœ‰ä¸€ç¨®ç›¸ç•¶å¸¸è¦‹çš„æ¨¡å¼ä¾†é”æˆé€™æ¨£çš„æ•ˆæœï¼Œå®ƒåŸºæœ¬ä¸Šèˆ‡ES6ç®­é ­å‡½å¼çš„ç²¾ç¥ç„¡ç•°ï¼š

```
function foo() {
	var self = this // èªå½™ä¸Šæ•æ‰äº† this
	setTimeout(function () {
		console.log(self.a)
	}, 100)
}

var obj = {
	a: 2
}

foo.call(obj) // 2
```

> é›–ç„¶self = this èˆ‡ç®­é ­å‡½å¼å…©è€…çœ‹èµ·ä¾†éƒ½åƒæ˜¯ä¸æƒ³è¦ä½¿ç”¨bind(...)æ™‚çš„å¥½è§£æ³•ï¼Œä½†åŸºæœ¬ä¸Šä»–å€‘æ˜¯é€ƒé›¢äº†thisè€Œéç†è§£ä¸¦æ“æŠ±å®ƒã€‚


>å¦‚æœä½ ç™¼ç¾è‡ªå·±å¯«çš„æ˜¯thisé¢¨æ ¼çš„ç¨‹å¼ç¢¼ï¼Œä½†å¤§å¤šæ™‚å€™æˆ–ç¸½æ˜¯å¦‚æ­¤ï¼Œä½ éƒ½ä»¥èªå½™çš„self = this æˆ–è€…ç®­é ­å‡½å¼é€™äº›èŠ±æ‹›å¦¨ç¤™thisæ©Ÿåˆ¶ï¼Œé‚£éº¼ä½ æ‡‰è©²è€ƒæ…®ä»¥ä¸‹ä»»ä¸€ä½œæ³•ï¼š
> 1. åªä½¿ç”¨èªå½™ç¯„ç–‡ï¼Œå¿˜æ‰é‚£thisé¢¨æ ¼ç¨‹å¼ç¢¼çš„å‡è±¡
>2. å®Œå…¨æ“æŠ±thisé¢¨æ ¼çš„æ©Ÿåˆ¶ï¼ŒåŒ…æ‹¬äº†åœ¨å¿…è¦æ™‚ä½¿ç”¨bind(...)ï¼Œä¸¦è©¦è‘—é¿å…self=thisèˆ‡ç®­é ­å‡½å¼é€™ç¨®lexical thisçš„èŠ±æ‹›



é‡é»ï¼š
- ç®­é ­å‡½å¼çš„this bindingæ˜¯ä½¿ç”¨èªå½™ç¶å®š(lexical binding)ï¼Œå…·é«”æ˜¯é€éç®­é ­å‡½å¼å…§ECçš„outer referenceå¾€ä¸Šæ‰¾ä¸Šä¸€å€‹ECæ“æœ‰çš„thisä¾†è¨­å®šç®­é ­å‡½å¼æœ¬èº«çš„thisï¼Œä¸”ä¸€æ—¦è¨­å®šï¼Œå°±ç„¡æ³•è¢«è¦†å¯«
- ç®­é ­å‡½å¼æœ¬èº«ä¸¦ä¸æœƒä¾æ“šnew bindingã€implicit bindingã€explicit bindingä¾†æ±ºå®šthis binding
- ç®­é ­å‡½å¼é€šå¸¸ä½¿ç”¨å ´æ™¯ç‚ºï¼š
	- äº‹ä»¶è™•ç†å™¨
	- è¨ˆæ™‚å™¨


#### æ¡ˆä¾‹1

```
function foo() {
  const fn = () => {
    return console.log(this.a);
  };

  return fn;
}

var obj1 = {
  a: 2,
};

var obj2 = {
  a: 3,
};

var bar = foo.call(obj1)
bar.call(obj2) 
```

```
function foo() {
  // å›å‚³ä¸€å€‹ç®­é ­å‡½å¼
  const fn = () => {
	// åœ¨æ­¤ï¼Œthisæ˜¯å¾èªå½™ä¸Šç¹¼æ‰¿è‡ªfoo
    return console.log(this.a);
  };

  return fn;
}

var obj1 = {
  a: 2,
};

var obj2 = {
  a: 3,
};

var bar = foo.call(obj1)
bar.call(obj2) // 2
```

> åœ¨foo()ä¸­å»ºç«‹çš„ç®­é ­å‡½å¼è¢«å‘¼å«æ™‚æœƒå¾èªå½™ä¸Š(lexically) æ•æ‰ foo() çš„this (ä¸ç®¡é‚£æ˜¯ä»€éº¼)ï¼Œæ—¢ç„¶foo()çš„this ç¶å®šåˆ°obj1ï¼Œbar(å°æ‰€å›å‚³çš„ç®­é ­å‡½å¼çš„ä¸€å€‹åƒè€ƒ)çš„thisä¹Ÿæœƒç¶å®šåˆ°obj1ã€‚ç®­é ­å‡½å¼çš„é€™ç¨®èªå½™ç¶å®š(lexical binding)ç„¡æ³•è¢«è¦†å¯«(å³ä¾¿ä½¿ç”¨newä¹Ÿä¸€æ¨£)ã€‚

#### æ¡ˆä¾‹2
> çˆ²å•¥æˆ‘å€‘ç¬¬ä¸€æ¬¡ç¶å®š this ä¸¦è¿”å›ç®­é ­å‡½æ•¸å¾Œï¼Œå†æ¬¡æ”¹è®Š this æŒ‡å‘æ²’ç”Ÿæ•ˆå‘¢ï¼Ÿ
> 
> å‰é¢èªªäº†ï¼Œç®­é ­å‡½æ•¸çš„ this å–æ±ºæ–¼å¤–å±¤ä½œç”¨åŸŸçš„ thisï¼Œfn å‡½æ•¸åŸ·è¡Œæ™‚ this æŒ‡å‘äº† obj1ï¼Œæ‰€ä»¥ç®­é ­å‡½æ•¸çš„ this ä¹ŸæŒ‡å‘ obj1ã€‚
> 
> é™¤æ­¤ä¹‹å¤–ï¼Œç®­é ­å‡½æ•¸ this é‚„æœ‰ä¸€å€‹ç‰¹æ€§ï¼Œé‚£å°±æ˜¯ä¸€æ—¦ç®­é ­å‡½æ•¸çš„ this ç¶å®šæˆåŠŸï¼Œä¹Ÿç„¡æ³•è¢«å†æ¬¡ä¿®æ”¹ï¼Œæœ‰é»ç¡¬ç¶å®šçš„æ„æ€ã€‚
> 
> ç•¶ç„¶ï¼Œç®­é ­å‡½æ•¸çš„ this ä¹Ÿä¸æ˜¯çœŸçš„ç„¡æ³•ä¿®æ”¹ï¼Œæˆ‘å€‘çŸ¥é“ç®­é ­å‡½æ•¸çš„ this å°±åƒä½œç”¨åŸŸç¹¼æ‰¿ä¸€æ¨£å¾ä¸Šå±¤ä½œç”¨åŸŸæ‰¾ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥ä¿®æ”¹å¤–å±¤å‡½æ•¸ this æŒ‡å‘é”åˆ°é–“æ¥ä¿®æ”¹ç®­é ­å‡½æ•¸ this çš„ç›®çš„ã€‚
```
function fn() {
    return () => {
        console.log(this.name);
    };
};
let obj1 = {
    name: 'è½é¢¨æ˜¯é¢¨'
};
let obj2 = {
    name: 'æ™‚é–“è·³èº'
};
fn.call(obj1)(); // fn thisæŒ‡å‘obj1,ç®­é ­å‡½æ•¸thisä¹ŸæŒ‡å‘obj1
fn.call(obj2)(); //fn this æŒ‡å‘obj2,ç®­é ­å‡½æ•¸thisä¹ŸæŒ‡å‘obj2
```

#### æ¡ˆä¾‹3 

```
function foo() {
	setTimeout(()=>{
		// é€™è£¡thisåœ¨èªå½™ä¸Šç¹¼æ‰¿è‡ªfoo
		console.log(this.a)
	}, 100)
}


var obj = {
	a: 2
}

foo.call(obj) 
```

```
function foo() {
	setTimeout(()=>{
		// é€™è£¡thisåœ¨èªå½™ä¸Šç¹¼æ‰¿è‡ªfoo
		console.log(this.a)
	}, 100)
}


var obj = {
	a: 2
}

foo.call(obj) // 2
```

## è¤‡ç¿’

#ğŸ§  ç®­é ­å‡½å¼çš„this binding ä¾æ“šè‘—new bindingã€implicit bindingã€explicit bindingä¾†æ±ºå®šthis bindingï¼Œé€™å¥è©±æ˜¯å°çš„å—->->-> `ä¸æ˜¯`

#ğŸ§  ç®­é ­å‡½å¼çš„this binding å’Œ å…¶ä»–ä¸€èˆ¬å‡½å¼å‘¼å«çš„this bindingæœ‰ä½•ä¸ä¸€æ¨£ï¼Ÿ ->->-> `ç®­é ­å‡½å¼æ˜¯æ¡ç”¨èªå½™ç¶å®šã€‚ä¸€èˆ¬å‡½å¼å‘¼å«çš„this bindingæœƒæ˜¯ä¾æ“šè‘—`



#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``



#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

---
Status: #ğŸŒ± 
Tags:
[[React]]
Links:
[[JSï¼šexplicit binding æ˜¯ç›¸è¼ƒæ–¼implicit bindingè€Œè¨€ï¼Œè¼ƒç‚ºç›´æ¥ä¸”æ˜ç¢ºå‘ŠçŸ¥thisæ˜¯è¨­å®šä»€éº¼]]
[[new binding æ˜¯ç”±new operator ä¸»å°ä¾†å»ºç«‹ä¸€å€‹ç‰©ä»¶ä¸¦ä»¥æ­¤ç‰©ä»¶ä½œç‚ºç‰¹å®šå‡½å¼å‘¼å«çš„this]]
[[JSï¼šimplicit bindingï¼šä»¥æš—ç¤ºçš„æ–¹å¼ä¾†è¡¨é”this è¨­å®šæˆä»€éº¼ï¼Œlosing implicit binding æ˜¯æŒ‡åŸæœ¬æœƒè¢«åˆ¤å®šæˆimplicit bindingçš„bindingå› ç‚ºç‰¹å®šå› ç´ è€Œéºå¤±binding]]
References:
[[@readfogZhongJavaScriptDeBangDing]]