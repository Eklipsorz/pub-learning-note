å¼•ç”¨æ–¼[[@masterforkerCanMultipleThreads2016]]æ‰€æçš„å•é¡Œï¼š
> Two threads can reach lock.acquire() at the exact same time. What happens then?

å…¶ä¸­è¨è«–ä¸²çš„David Schwartz å›ç­”ä»¥ä¸‹å•é¡Œ
> One of them gets the lock first and the other must wait until the first one releases the lock. If they reach acquire at the exact same time, the mechanism that decides which one gets the lock is heavily hardware dependent.

å¼•ç”¨æ–¼[[@CunBuCunZaiYiZhongQingKuang2GeXianChengHuoDuoGeXianChengTongShiQingQiuYiGeSuoZhiHu]] ç›¸é—œå›ç­”ï¼š

> ç³»ç»Ÿè®©è°è·å¾—è¯¥é”å’Œå…·ä½“çš„è°ƒåº¦ç®—æ³•æœ‰å…³ç³»ã€‚æœ¬è´¨ä¸Šè¿™ä¸ªé¡ºåºå…¶å®æ˜¯æ— æ³•é¢„ä¼°çš„ã€‚è€Œä¸”ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ç”¨æˆ·å±‚çº§çš„é”ï¼Œæ¯”å¦‚SpinLockï¼Œç³»ç»Ÿæ‰ä¸çŸ¥é“ã€‚å¹¶å‘ä¸‹éƒ½æ˜¯ä¸ç¡®å®šçš„ã€‚åœ¨å¤šæ ¸æˆ–è€…å¤šCPUä¸‹ï¼Œä¼šå‡ºç°å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€ä¸ªé”ã€‚å•æ ¸ä¸‹ä¸ä¼šã€‚å•æ ¸ä¸‹å¤§å®¶è¦è½®æµç€æ¥ä½¿ç”¨CPUã€‚
> å°±è¯´æœ€åº•éƒ¨çš„CPUå§ï¼Œå†…éƒ¨è¿˜åŒ…å«äº†ä¸€å †çš„æœºåˆ¶æ¥ç¡®ä¿å¯¹é”çš„æ”¯æŒï¼ˆæ¯”å¦‚lockå‰ç¼€ï¼‰ï¼Œæˆ–è€…å…ˆåé¡ºåºçš„æ”¯æŒ(æ¯”å¦‚å†…å­˜æ …æ )ï¼Œä½†æ˜¯ä¹Ÿæ²¡è¯´åˆ°åº•æ˜¯æ€ä¹ˆå†³å®šè°æ‹¿åˆ°é”ã€‚
> å¤§å®¶åœ¨è§£å†³ç«äº‰é—®é¢˜æ—¶ï¼Œå¤§å¤šæ•°ä¸å…³å¿ƒè°å…ˆè°åï¼Œå› ä¸ºç›®æ ‡æ˜¯ç¡®ä¿æ•°æ®æœ¬èº«æ˜¯å¯é çš„æˆ–è€…è¯´æ˜¯å¯ç”¨çš„ã€‚

é‡é»ï¼š
- ç†è«–ä¸Šï¼Œæ¯å€‹åŸ·è¡Œç·’çš„åŸ·è¡Œé †åºæ˜¯ç„¡æ³•è¢«ä¼°è¨ˆçš„ï¼Œç³»çµ±ã€ä½¿ç”¨è€…ä¸­å¾ˆæœ‰å¯èƒ½éƒ½æ²’è¾¦æ³•çŸ¥é“
- ä½†å¯¦éš›ä¸Šä»ç¢ºå¯¦æœƒæœ‰å¤šå€‹åŸ·è¡Œç·’æœƒåŒæ™‚å°è³‡æºæˆ–è€…ç¨‹å¼ç¢¼é€²è¡Œä¸Šé–çš„è¡Œç‚ºï¼Œé€™æ™‚åº•å±¤æˆ–è€…CPUæœƒå¾ä¸­æŒ‘é¸ä¸€å€‹åŸ·è¡Œç·’ä¾†åŸ·è¡Œï¼Œå‰©ä¸‹å°±å¾€å¾Œç­‰ä¾†æ”¯æŒç†è«–
  

> I should point out though that there is no such thing as "at the exact same time". To have two things that occur in different threads happen at the exact same time would require there to be some global notion of time in which operations are ordered. There is no such thing.

é‡é»ï¼š
- æ²’æœ‰ä»»ä½•æ±è¥¿æœƒ
- ç‚ºäº†è®“é‚£å…©å€‹åŸ·è¡Œç·’ä¸ŠåŒæ™‚èƒ½å¤ ä¸Šé–ï¼Œå°±å¿…é ˆç‚ºäº†åœ¨ç¢ºä¿å…©å€‹åŸ·è¡Œç·’çš„åŸ·è¡Œä¸‹é€²è¡Œæœ‰åºåŸ·è¡Œï¼Œä½†æœ‰åŸ·è¡Œç·’é ‚å¤šæœƒè®“åŸ·è¡Œç·’åˆ°é”å“ªå€‹æŒ‡ä»¤ä¾†åŸ·è¡Œï¼Œå¯¦éš›ä¸Šè¦è®“åŸ·è¡Œç·’å€‘å¯¦éš›åŸ·è¡Œé‚„æ˜¯å¾—

> Also, the concept of when a thread will "reach" an operation also isn't well defined. Operations don't take place instantaneously and operations can overlap with other operations.

åŸ·è¡Œç·’ä½•æ™‚åˆ°é”(reach)è©²æŒ‡ä»¤(operation)ä¾†åŸ·è¡Œä¹Ÿæ²’å¾ˆå¥½åœ°å®šç¾©ï¼Œé€™äº›æŒ‡ä»¤ä¸æœƒç«‹å³è¢«åŸ·è¡Œä»¥åŠæœƒèˆ‡å…¶ä»–æŒ‡ä»¤é‡ç–Šè‘—åŸ·è¡Œ

é‡é»ï¼š
- é€™äº›æŒ‡ä»¤çš„åŸ·è¡Œé †åºæ˜¯ç„¡æ³•è¢«ç¢ºå®šçš„

---
Status: #ğŸ“¥ 
Tags:
[[Operating System]]
Links:
References:
[[@masterforkerCanMultipleThreads2016]]
[[@CunBuCunZaiYiZhongQingKuang2GeXianChengHuoDuoGeXianChengTongShiQingQiuYiGeSuoZhiHu]]