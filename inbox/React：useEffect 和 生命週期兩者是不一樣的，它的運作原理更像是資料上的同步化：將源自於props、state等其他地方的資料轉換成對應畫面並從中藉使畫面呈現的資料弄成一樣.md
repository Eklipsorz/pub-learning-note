## æè¿°

### React æ–‡ç»ï¼šuseEffect å’Œç”Ÿå‘½é€±æœŸä¹‹é–“
[[@ithomeDay21UseEffect]]

> è€Œ `useEffect` å®ƒä¸¦ä¸é—œå¿ƒé€™å€‹ effect æµç¨‹æ˜¯åœ¨ mount æ™‚é‚„æ˜¯ update æ™‚åŸ·è¡Œï¼Œä¹Ÿä¸é—œå¿ƒè¢«é‡è¤‡åŸ·è¡Œäº†å¹¾æ¬¡ï¼Œåªè¦æœ€å¾Œå¾åŸå§‹è³‡æ–™åŒæ­¥åˆ° effect çš„çµæœæ˜¯æ­£ç¢ºçš„å°±å¯ä»¥äº†ã€‚

> å› æ­¤åš´æ ¼ä¾†èªªï¼Œ `useEffect` å…¶å¯¦ä¸¦ä¸æ˜¯ä¸€ç¨® function component ç”Ÿå‘½é€±æœŸçš„ APIã€‚é›–ç„¶èªªå®ƒçš„åŸ·è¡Œæ™‚æ©Ÿç¢ºå¯¦èˆ‡ `componentDidMount` ä»¥åŠ `componentDidUpdate` é¡ä¼¼ï¼ˆä¸éå…¶å¯¦æœ‰äº›å¾®å€åˆ¥ï¼‰ï¼Œä½†å®ƒè¢«è¨­è¨ˆçš„ç”¨é€”ä¸¦ä¸æ˜¯è®“ä½ åœ¨ React é‹ä½œçš„ç‰¹å®šæ™‚æ©Ÿä¾†åŸ·è¡Œä¸€å€‹è‡ªå®šç¾©çš„ callback ï¼Œè€Œæ˜¯æœ‰ä¸€ç¨®æ˜ç¢ºçš„æŒ‡å®šç”¨é€” â€” **ç”¨ä¾†å°‡åŸå§‹è³‡æ–™åŒæ­¥åˆ° React elements ä»¥å¤–çš„æ±è¥¿ä¸Š**ã€‚ä¸¦ä¸”åœ¨ç†æƒ³ä¸Š**é€™å€‹ effect ç„¡è«–éš¨è‘— render é‡è¤‡åŸ·è¡Œäº†å¤šå°‘æ¬¡ï¼Œä½ çš„ç¨‹å¼éƒ½æ‡‰è©²ä¿æŒåŒæ­¥ä¸”æ­£å¸¸é‹ä½œã€‚**

> é€™ç¢ºå¯¦æ˜¯æœ‰é»ä¸åŒæ–¼å¤§å¤šæ•¸æœ‰ class component ç¶“é©—é–‹ç™¼è€…æ‰€ç†Ÿæ‚‰çš„ mount / update / unmount æ€è€ƒæ¨¡å‹ã€‚å› æ­¤å¦‚æœä½ å˜—è©¦æŠŠ effect å¯«æˆæ˜¯å¦åœ¨ component ç¬¬ä¸€æ¬¡çš„ render è€Œæœ‰æ‰€è¡Œç‚ºä¸åŒçš„è©±ï¼Œå…¶å¯¦æ˜¯é•åäº† `useEffect` æœ¬èº«é æœŸçš„è¨­è¨ˆæ€ç¶­ã€‚å¦‚æœæˆ‘å€‘çš„åŸ·è¡Œçµæœæ˜¯ä¾è³´æ–¼ã€Œéç¨‹ã€è€Œä¸æ˜¯ã€Œç›®çš„åœ°ã€çš„è©±ï¼Œæˆ‘å€‘å¾ˆå®¹æ˜“å¯«å‡ºåŒæ­¥å‹•ä½œæœ‰å•é¡Œçš„ç¨‹å¼ç¢¼ã€‚


> # **useEffect çš„æ ¸å¿ƒæ€è€ƒæ¨¡å‹æ•´ç†**

> æˆ‘å€‘ä¾†å°‡ç›®å‰ç‚ºæ­¢æåŠçš„å„ç¨®é—œæ–¼ `useEffect` çš„è§€å¿µåšä¸€å€‹æ•´ç†ï¼š

> -   Function component ä¸¦æ²’æœ‰æä¾›ç”Ÿå‘½é€±æœŸçš„ APIï¼Œåªæœ‰ `useEffect` æä¾›ã€ŒåŒæ­¥è³‡æ–™åˆ° effectã€çš„ç”¨é€”
> -   `useEffect` è®“ä½ æ ¹æ“šç›®å‰çš„è³‡æ–™ä¾†åŒæ­¥ React elementsï¼ˆç•«é¢ï¼‰ä»¥å¤–çš„ä»»ä½•äº‹ç‰©èˆ‡å‰¯ä½œç”¨
>-   åœ¨ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œ `useEffect` æœƒåœ¨æ¯æ¬¡ component render ä¸”ç€è¦½å™¨å®Œæˆ DOM çš„æ›´æ–° & ç¹ªè£½ç•«é¢**ä¹‹å¾Œ**æ‰åŸ·è¡Œï¼Œä»¥é¿å…é˜»å¡ component render çš„éç¨‹ & ç€è¦½å™¨ç¹ªè£½ç•«é¢çš„éç¨‹
    -   ä¾‹å¤–æƒ…æ³ï¼šåœ¨ React 18 ä¸­ï¼Œå¦‚æœæŸæ¬¡ render æ˜¯è¢« `flushSync` åŒ…è‘—çš„ `setState` æ‰€è§¸ç™¼ï¼Œå‰‡è©²æ¬¡ render çš„ effect å°‡ææ—©åœ¨ç€è¦½å™¨ç•«é¢æ’ç‰ˆèˆ‡ç¹ªè£½ã€Œ**ä¹‹å‰**ã€å°±é€²è¡Œè§¸ç™¼
> -   `useEffect` åœ¨æ¦‚å¿µä¸Šä¸¦ä¸å€åˆ† mount èˆ‡ update çš„æƒ…æ³ï¼Œå®ƒå€‘è¢«è¦–ç‚ºæ˜¯åŒä¸€ç¨®æƒ…å¢ƒ
> -   é è¨­æƒ…æ³ä¸‹ï¼Œæ¯ä¸€æ¬¡ render å¾Œéƒ½æ‡‰è©²åŸ·è¡Œå±¬æ–¼è©² render çš„ `useEffect`ï¼Œä¾†ç¢ºä¿åŒæ­¥çš„æ­£ç¢ºæ€§èˆ‡å®Œæ•´æ€§
> -   ç†æƒ³ä¸ŠåŒä¸€å€‹ effect ç„¡è«–éš¨è‘— render é‡è¤‡è¢«åŸ·è¡Œäº†å¤šå°‘æ¬¡ï¼Œä½ çš„ç¨‹å¼éƒ½æ‡‰è©²ä¿æŒåŒæ­¥ä¸”æ­£å¸¸é‹ä½œ
> -   `useEffect` çš„ dependencies æ˜¯ä¸€ç¨®ã€Œå¿½ç•¥æŸäº›ä¸å¿…è¦çš„åŸ·è¡Œã€çš„æ•ˆèƒ½æœ€ä½³åŒ–æ‰‹æ®µï¼Œè€Œä¸æ˜¯ç”¨ä¾†æ§åˆ¶ effect ç™¼ç”Ÿåœ¨ç‰¹å®šçš„ component ç”Ÿå‘½é€±æœŸï¼Œæˆ–ç‰¹å®šçš„å•†æ¥­é‚è¼¯æ™‚æ©Ÿ



é‡é»ï¼š
- useEffect æœ¬èº«ä¸¦ä¸æ˜¯class based componenä¸Šçš„ç”Ÿå‘½é€±æœŸä¸Šä¹‹APIï¼Œæ›´åˆ¥èªªæ˜¯ä¸æ˜¯èªæ³•ç³–
- useEffect å’Œ ç”Ÿå‘½é€±æœŸå…©è€…æ˜¯ä¸ä¸€æ¨£çš„ï¼Œåªæ˜¯useEffect éƒ¨åˆ†ç‰¹æ€§èˆ‡ç”Ÿå‘½é€±æœŸé‡ç–Š
- é–‹ç™¼ç­–ç•¥ä¹Ÿä¸åŒï¼ŒuseEffect æ˜¯ä»¥ç›®æ¨™ç‚ºå°å‘ï¼Œå®šç¾©ä¸€å€‹callbackã€depsã€æœƒç”¨åˆ°çš„è³‡æ–™ä¾†å‘ŠçŸ¥Reactçš„renderå®Œç•¢ä¹‹å¾Œè¦åšäº›ä»€éº¼ï¼›å¾Œè€…å‰‡æ˜¯ä»¥éç¨‹ç‚ºå°å‘ä¾†æŒ‡å®šæ¯å€‹éšæ®µè¦åšä»€éº¼ã€‚


### React å®˜æ–¹æ–‡ç»ï¼šuseEffect å’Œç”Ÿå‘½é€±æœŸä¹‹é–“

[[@danabramovCompleteGuideUseEffect]]
> While you can `useEffect(fn, [])`, itâ€™s not an exact equivalent. Unlike `componentDidMount`, it will _capture_ props and state. So even inside the callbacks, youâ€™ll see the initial props and state. If you want to see â€œlatestâ€ something, you can write it to a ref. But thereâ€™s usually a simpler way to structure the code so that you donâ€™t have to. Keep in mind that the mental model for effects is different from `componentDidMount` and other lifecycles, and trying to find their exact equivalents may confuse you more than help. To get productive, you need to â€œthink in effectsâ€, and their mental model is closer to implementing synchronization than to responding to lifecycle events.


> **React synchronizes the DOM according to our current props and state.** There is no distinction between a â€œmountâ€ or an â€œupdateâ€ when rendering.


é‡é»ï¼š
- useEffect çš„ é‹ä½œåŸç† å’Œ ç”Ÿå‘½é€±æœŸå‡½å¼(componentDidMountã€componentDidUpdateã€componentWillUnmount)çš„é‹ä½œåŸç†æ˜¯ä¸ä¸€æ¨£çš„
- useEffect çš„é‹ä½œåŸç†æ›´åƒæ˜¯è³‡æ–™ä¸Šçš„åŒæ­¥åŒ–(Data Synchronization / Data Synchronize)ï¼Œä½†ä¸æ˜¯çµ•å°ä¸€æ¨£ã€‚

- Data Synchronization æ˜¯å°‡æºè‡ªæ–¼propsã€stateç­‰å…¶ä»–åœ°æ–¹çš„è³‡æ–™å’Œç•«é¢ä¸Šçš„è³‡æ–™å¼„æˆå¼„æˆä¸€æ¨£çš„éç¨‹ï¼Œæ›è¨€ä¹‹
	- Data Synchronization å°‡æºè‡ªæ–¼propsã€stateç­‰å…¶ä»–åœ°æ–¹çš„è³‡æ–™è½‰æ›æˆå°æ‡‰ç•«é¢ï¼Œä½¿ç•«é¢å‘ˆç¾çš„è³‡æ–™å¼„æˆä¸€æ¨£çš„éç¨‹
	- Synchronize ï¼šå°‡æºè‡ªæ–¼propsã€stateç­‰å…¶ä»–åœ°æ–¹çš„è³‡æ–™è½‰æ›æˆå°æ‡‰ç•«é¢ä¸¦å¾ä¸­è—‰ä½¿ç•«é¢å‘ˆç¾çš„è³‡æ–™å¼„æˆä¸€æ¨£




## è¤‡ç¿’

#ğŸ§  useEffect çš„é‹ä½œåŸç†å’Œç”Ÿå‘½é€±æœŸå‡½å¼ä¹‹é–“çš„å·®åˆ¥æ˜¯ï¼Ÿ ->->-> `å…©è€…é–“çš„é‹ä½œåŸç†æ˜¯ä¸ä¸€æ¨£çš„ï¼›é–‹ç™¼ç­–ç•¥ï¼šå‰è€…æ˜¯ä»¥å®šç¾©ä¸€å€‹callbackã€depsã€æœƒç”¨åˆ°çš„è³‡æ–™ä¾†å‘ŠçŸ¥Reactçš„renderå®Œç•¢ä¹‹å¾Œè¦åšäº›ä»€éº¼ï¼Œå¾Œè€…å‰‡æ˜¯ä»¥éç¨‹ç‚ºå°å‘ä¾†æŒ‡å®šæ¯å€‹éšæ®µè¦åšä»€éº¼`

#ğŸ§  useEffect çš„é‹ä½œåŸç†æ›´åƒæ˜¯synchronizationï¼Œå…·é«”èªªæ˜ ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Data synchronization æ˜¯ä»€éº¼ï¼Ÿ->->-> `è³‡æ–™åŒæ­¥ï¼šæ˜¯æŒ‡å¤šå€‹å„²å­˜è³‡æ–™çš„å„²å­˜ç©ºé–“é–“é”æˆ **è³‡æ–™æœƒæ˜¯ä¸€æ¨£å…§å®¹é€™ç›®æ¨™** ä»¥åŠ **è³‡æ–™éƒ½æœƒæ˜¯æ»¿è¶³å„²å­˜ç©ºé–“å°æ–¼è³‡æ–™çš„è¦å‰‡** é€™éç¨‹`

#ğŸ§  è³‡æ–™åŒæ­¥ï¼šæ˜¯æŒ‡å¤šå€‹å„²å­˜è³‡æ–™çš„å„²å­˜ç©ºé–“é–“é”æˆ **è³‡æ–™æœƒæ˜¯ä¸€æ¨£å…§å®¹é€™ç›®æ¨™** ä»¥åŠ **è³‡æ–™éƒ½æœƒæ˜¯æ»¿è¶³å„²å­˜ç©ºé–“å°æ–¼è³‡æ–™çš„è¦å‰‡** é€™éç¨‹ï¼Œå¤šå€‹å„²å­˜è³‡æ–™çš„ç©ºé–“æœƒæ˜¯æŒ‡ä»€éº¼ï¼Ÿ->->-> `å¤šå€‹å„²å­˜ç©ºé–“æœƒæ˜¯ä»¥ä¾†æºè™•å’Œç›®æ¨™è™•ï¼Œä¾†æºè™•æœƒæ˜¯æŒ‡è³‡æ–™æœ€ä¸€é–‹å§‹å­˜åœ¨çš„åœ°æ–¹ï¼Œè€Œç›®æ¨™è™•å‰‡æ˜¯ç¶“éè™•ç†è€Œå­˜æ”¾çš„åœ°æ–¹`

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

#ğŸ§  Question :: ->->-> ``

---
Status: #ğŸŒ± 
Tags:
[[React]]
Links:
[[side effect æ˜¯æŒ‡èª¿ç”¨è€…åŸ·è¡Œç‰¹å®šæ“ä½œæˆ–è¡¨é”å¼æˆ–å‡½å¼è€Œå¾—åˆ°é™¤äº†å›å‚³å€¼çµ¦èª¿ç”¨è€…é€™å€‹ä¸»è¦æ•ˆæœä»¥å¤–çš„é¡å¤–æ•ˆæœï¼Œside effect é€šå¸¸æœƒæ˜¯å½±éŸ¿ä¸»èª¿ç”¨è€…æ‰€ä½¿ç”¨çš„å…±äº«è³‡æºä¹‹æ•ˆæœ]]
[[Reactï¼šEffect ç­‰åŒæ–¼ Side Effectï¼Œeffect æœ¬èº«æ˜¯æŒ‡åŸ·è¡Œä¸»è¦è™•ç†(çµæœ)æ‰€å¸¶ä¾†çš„ä»»æ„é¡å¤–è™•ç†(çµæœ)ï¼Œä¸»è¦è™•ç†(çµæœ)æœƒæ˜¯æŒ‡å…ƒä»¶æ¸²æŸ“(render)ä»»å‹™ã€‚ä»»æ„é¡å¤–è™•ç†(çµæœ)æŒ‡useEffectæ‰€å®šç¾©çš„åŸ·è¡Œè™•ç†]]
References:
[[@ithomeDay21UseEffect]]
[[@danabramovCompleteGuideUseEffect]]