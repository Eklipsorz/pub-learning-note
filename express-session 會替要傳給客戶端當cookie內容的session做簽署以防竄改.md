## æè¿°

ç•¶å®¢æˆ¶ç«¯çš„cookieç‰©ä»¶å…§å®¹ä¾†ä½¿ç”¨session id ä¾†å‘ŠçŸ¥ä¼ºæœå™¨å“ªä¸€å€‹ä¼ºæœå™¨çš„session ç‰©ä»¶å…§å®¹æ˜¯è¦æ‹¿ä¾†è™•ç†é€™æ¬¡çš„sessionæ™‚ï¼Œè‹¥session idè¢«ç¯¡æ”¹æˆå…¶ä»–å®¢æˆ¶ç«¯èˆ‡ä¼ºæœå™¨ä¹‹é–“çš„sessionç‰©ä»¶ï¼Œé‚£ä¼ºæœå™¨è©²å¦‚ä½•é˜²ç¯„ï¼Ÿ

åœ¨é€™è£¡çš„è§£æ³•æœƒæ˜¯ï¼Œç•¶æ¯æ¬¡å®¢æˆ¶ç«¯ç™¼å‡ºè«‹æ±‚è‡´ä½¿ä¼ºæœå™¨å»ºç«‹sessionæ™‚ï¼Œ

![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1650553317/blog/network/session/create-session-sign_mjqbsd.png)

  

åŸæœ¬ä¼ºæœå™¨æœƒè—‰ç”±Set-Cookieæ¨™é ­å°åŒ…ä¾†å‘ŠçŸ¥å®¢æˆ¶ç«¯å°æ‡‰çš„sessionIDæ˜¯ä»€éº¼(åœ–ä¸­æœƒæ˜¯1)ï¼Œä½†åœ¨é€™è£¡æœƒé¸æ“‡å°‡sessionIDå’Œä¼ºæœå™¨æ‰€å„²å­˜çš„å¯†é‘°(secret)ä¸€èµ·é€éé›œæ¹Šæ¼”ç®—æ³•ä¾†ç”¢ç”Ÿåç‚ºç°½å(signature)çš„é›œæ¹Šå€¼ï¼Œ

![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1650553443/blog/network/session/sign-generate_grxsdm.png)

  
ä¸¦å°‡å‚³éçµ¦å®¢æˆ¶ç«¯çš„å°åŒ…æ”¹æˆä»¥ä¸‹å½¢å¼çš„å­—ä¸²ï¼Œåœ¨é€™è£¡æœƒæ˜¯1.signature1ï¼Œå…¶ä¸­signature1æ˜¯é€ésessionID(=1)å’Œå¯†é‘°è€Œæ§‹æˆçš„ï¼Œè€Œç•¶å®¢æˆ¶ç«¯æ”¶åˆ°ä¹‹å¾Œï¼Œå°±ä¾¿å»ºç«‹cookieç‰©ä»¶ä¾†å­˜æ”¾sessionIDå’Œç°½ç½²æ‰€æ§‹æˆçš„å­—ä¸²ã€‚

```
Set-Cookie: sessionId=<session id>.<signature>
```

è€Œç•¶ä¸‹æ¬¡å®¢æˆ¶ç«¯å†æ¬¡å‘åŒå€‹ä¼ºæœå™¨ç™¼å‡ºè«‹æ±‚æ™‚ï¼Œä¾¿æœƒæŠŠå°æ‡‰çš„cookieå…§å®¹(æ­¤æ™‚æœƒæ˜¯1.signature1)é™„åŠ è‡³è«‹æ±‚å°åŒ…ï¼Œ

![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1650553317/blog/network/session/send-with-cookie-sign_n2hv2s.png)

  

è€Œä¼ºæœå™¨æ”¶åˆ°ä¹‹å¾Œå°±æœƒåˆ†åˆ¥å°sessionIDå’Œsignature1é€²è¡Œè™•ç†ï¼Œé¦–å…ˆæœƒå…ˆå°æ”¶åˆ°çš„sessionIDå’Œä¼ºæœå™¨çš„å¯†é‘°é€²è¡Œé›œæ¹Šæ¼”ç®—æ³•ç²å–å¦ä¸€å€‹ç°½å(signature')ï¼Œä¸¦ä¸”å°‡çµæœç°½åå€¼èˆ‡æ¥æ”¶éä¾†çš„signatureæ¯”è¼ƒæ˜¯å¦ç›¸åŒï¼Œè‹¥ç›¸åŒå°±ä»£è¡¨è‘—æ¥æ”¶åˆ°çš„å°åŒ…å…§å®¹æ˜¯æœªè¢«ç«„æ”¹ï¼Œæœªè¢«ç«„æ”¹æ‰æœƒå…è¨±ä¼ºæœå™¨å»æ‰¾å°‹å°æ‡‰çš„sessionï¼Œå¦å‰‡å°±é§å›

![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1650553936/blog/network/session/sign-compare_hfxe4p.png)

  

åœ¨é€™è£¡é™¤éæ¥æ”¶å°åŒ…å…§çš„sessionIDå’Œsignatureéƒ½è¢«æ”¹æˆç›¸å°æ‡‰çš„çµ„åˆ(PS. sessionIDé€éåŒå€‹ç®—æ³•å’Œå¯†é‘°èƒ½å¤ å¾—åˆ°åŒæ¨£çš„signature)ä»¥å¤–ï¼Œå¦å‰‡åªè¦ä»»ä¸€æ”¹è®Šå°±æœƒè¢«èªå®šè¢«æƒ¡æ„ç«„æ”¹è€Œæ‹’çµ•ã€‚æ­¤å¤–ï¼Œäº‹å¯¦ä¸Šé€™æ–¹æ³•ä¹Ÿè—‰ç”±è®“å®¢æˆ¶ç«¯å„²å­˜è¦æ¯”è¼ƒçš„çµæœç°½åå€¼ä¾†æ¸›å°‘ä¼ºæœå™¨å°ç©ºé–“éœ€æ±‚ã€‚


---
Status: #ğŸŒ± 
Tags:
[[Express]] - [[Session]]
Links: 
[[Express-Session è®“Express ä¼ºæœå™¨èƒ½ç”¢ç”Ÿå’Œç®¡ç†å°æ‡‰çš„cookieå’Œsession]]
References: